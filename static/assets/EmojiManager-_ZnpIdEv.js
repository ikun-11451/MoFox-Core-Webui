import{a2 as U,an as te,d as G,c as L,l as c,y as r,B as R,q as e,p as z,m as C,v as p,F as K,D as O,r as P,_ as H,z as w,w as X,f as W,j as N,T as Y,k as ee,O as Q,P as A,R as oe,Z as le,x as se,C as ae,aG as ie,o as ne,u as D}from"./index-2cLGT6AP.js";async function re(s={}){return(await U.get("/emoji/list",{params:s})).data}async function de(s){return(await U.get(`/emoji/${s}`)).data}async function ue(s){const o=new FormData;s.forEach(E=>o.append("files",E));const v=await U.post("/emoji/upload",o);if(!v.success){const E=v.error||"上传失败";throw new Error(E)}return v.data}async function ce(s){return(await U.delete(`/emoji/${s}`)).data}async function me(s,o){return(await U.patch(`/emoji/${s}`,o)).data}async function J(s,o){return(await U.post("/emoji/batch",{action:s,emoji_hashes:o})).data}async function ve(){return(await U.get("/emoji/stats")).data}const Z=te("emoji",{state:()=>({items:[],total:0,page:1,pageSize:50,totalPages:0,loading:!1,selectedItems:new Set,searchQuery:"",sortBy:"record_time",sortOrder:"desc",isRegisteredFilter:null,isBannedFilter:null}),getters:{hasSelection:s=>s.selectedItems.size>0,selectionCount:s=>s.selectedItems.size,isAllSelected:s=>s.items.length===0?!1:s.items.every(o=>s.selectedItems.has(o.hash)),currentParams:s=>({page:s.page,page_size:s.pageSize,search:s.searchQuery||void 0,sort_by:s.sortBy,sort_order:s.sortOrder,is_registered:s.isRegisteredFilter??void 0,is_banned:s.isBannedFilter??void 0})},actions:{async fetchEmojiList(){this.loading=!0,console.log("[EmojiStore] 准备请求列表, searchQuery:",this.searchQuery),console.log("[EmojiStore] 请求参数:",this.currentParams);try{const s=await re(this.currentParams);if(s!=null&&s.success){const{items:o,total:v,page:E,page_size:$,total_pages:n}=s.data;this.items=o,this.total=v,this.page=E,this.pageSize=$,this.totalPages=n}}catch(s){throw console.error("获取表情包列表失败:",s),s}finally{this.loading=!1}},async getEmojiDetail(s){try{const o=await de(s);return o!=null&&o.success?o.data:null}catch(o){throw console.error("获取表情包详情失败:",o),o}},async uploadEmojis(s){try{const o=await ue(s);if(o!=null&&o.success)return await this.fetchEmojiList(),o.data;throw new Error("上传失败")}catch(o){throw console.error("上传表情包失败:",o),o}},async deleteEmoji(s){try{const o=await ce(s);return o!=null&&o.success?(await this.fetchEmojiList(),this.selectedItems.delete(s),!0):!1}catch(o){throw console.error("删除表情包失败:",o),o}},async updateEmoji(s,o){try{const v=await me(s,o);if(v!=null&&v.success)return await this.fetchEmojiList(),v.data;throw new Error("更新失败")}catch(v){throw console.error("更新表情包失败:",v),v}},async batchDelete(s){try{const o=await J("delete",s);if(o!=null&&o.success)return await this.fetchEmojiList(),s.forEach(v=>this.selectedItems.delete(v)),o.data;throw new Error("批量删除失败")}catch(o){throw console.error("批量删除失败:",o),o}},async batchBan(s){try{const o=await J("ban",s);if(o!=null&&o.success)return await this.fetchEmojiList(),o.data;throw new Error("批量禁用失败")}catch(o){throw console.error("批量禁用失败:",o),o}},async batchUnban(s){try{const o=await J("unban",s);if(o!=null&&o.success)return await this.fetchEmojiList(),o.data;throw new Error("批量启用失败")}catch(o){throw console.error("批量启用失败:",o),o}},async getStats(){try{const s=await ve();return s!=null&&s.success?s.data:null}catch(s){return console.error("获取统计信息失败:",s),null}},toggleSelection(s){this.selectedItems.has(s)?this.selectedItems.delete(s):this.selectedItems.add(s)},toggleSelectAll(){this.isAllSelected?this.clearSelection():this.items.forEach(s=>this.selectedItems.add(s.hash))},clearSelection(){this.selectedItems.clear()},setSearchQuery(s){console.log("[EmojiStore] setSearchQuery 被调用, 参数:",s),this.searchQuery=s,this.page=1,console.log("[EmojiStore] searchQuery 已设置为:",this.searchQuery)},setSorting(s,o){this.sortBy=s,this.sortOrder=o,this.page=1},setPage(s){this.page=s},setPageSize(s){this.pageSize=s,this.page=1},resetFilters(){this.searchQuery="",this.isRegisteredFilter=null,this.isBannedFilter=null,this.sortBy="record_time",this.sortOrder="desc",this.page=1}}}),pe={class:"emoji-image-container"},fe=["src"],ge={key:1,class:"placeholder"},he={key:2,class:"banned-badge"},ye={class:"hover-actions"},be={class:"emoji-info"},_e=["title"],we={key:0,class:"emotion-tags"},$e={class:"stats"},je={class:"stat-item",title:"查询次数"},ke={class:"stat-item",title:"使用次数"},Ee=G({__name:"EmojiCard",props:{emoji:{},selected:{type:Boolean}},emits:["select","view-detail","delete"],setup(s,{emit:o}){const v=s,E=o,$=y=>{const d=y.match(/Keywords:\s*\[(.*?)\]/),b=y.match(/^(.*?)\s*Keywords:/);return{refined:b?b[1].trim():y,keywords:d?d[1].split(",").map(V=>V.trim()).filter(Boolean):[]}},n=L(()=>$(v.emoji.description).refined||v.emoji.description),g=L(()=>v.emoji.description),j=L(()=>{const y=$(v.emoji.description);return y.keywords.length>0?y.keywords:v.emoji.emotions}),_=()=>{confirm(`确定要删除表情包"${n.value}"吗？`)&&E("delete")};return(y,d)=>(r(),c("div",{class:R(["emoji-card",{selected:s.selected,banned:s.emoji.is_banned}]),onClick:d[2]||(d[2]=b=>y.$emit("view-detail"))},[e("div",{class:R(["select-checkbox",{checked:s.selected}]),onClick:d[0]||(d[0]=z(b=>y.$emit("select"),["stop"]))},[...d[3]||(d[3]=[e("span",{class:"material-symbols-rounded check-icon"},"check",-1)])],2),e("div",pe,[s.emoji.thumbnail?(r(),c("img",{key:0,src:s.emoji.thumbnail,alt:"表情包缩略图",class:"emoji-image",loading:"lazy"},null,8,fe)):(r(),c("div",ge,[...d[4]||(d[4]=[e("span",{class:"material-symbols-rounded"},"broken_image",-1)])])),s.emoji.is_banned?(r(),c("div",he,[...d[5]||(d[5]=[e("span",{class:"material-symbols-rounded"},"block",-1)])])):C("",!0),e("div",ye,[e("button",{class:"action-button view",title:"查看详情",onClick:d[1]||(d[1]=z(b=>y.$emit("view-detail"),["stop"]))},[...d[6]||(d[6]=[e("span",{class:"material-symbols-rounded"},"visibility",-1)])]),e("button",{class:"action-button delete",title:"删除",onClick:z(_,["stop"])},[...d[7]||(d[7]=[e("span",{class:"material-symbols-rounded"},"delete",-1)])])])]),e("div",be,[e("div",{class:"emoji-description",title:g.value},p(n.value),9,_e),j.value&&j.value.length>0?(r(),c("div",we,[(r(!0),c(K,null,O(j.value.slice(0,3),b=>(r(),c("span",{key:b,class:"emotion-tag"},p(b),1))),128))])):C("",!0),e("div",$e,[e("span",je,[d[8]||(d[8]=e("span",{class:"material-symbols-rounded"},"visibility",-1)),P(" "+p(s.emoji.query_count),1)]),e("span",ke,[d[9]||(d[9]=e("span",{class:"material-symbols-rounded"},"emoji_emotions",-1)),P(" "+p(s.emoji.usage_count),1)])])])],2))}}),De=H(Ee,[["__scopeId","data-v-9e673d04"]]),Se={class:"dialog-content"},Ce={class:"full-image-container"},Ie=["src"],Ve={class:"detail-section"},xe={class:"info-grid"},Be={class:"info-item"},ze={class:"value"},Fe={class:"info-item"},Me={class:"value"},Ue={class:"info-item"},Le=["title"],Pe={class:"detail-section"},Te={class:"detail-section"},Qe={class:"detail-section"},Re={class:"emotion-editor"},Ke={class:"emotion-chips"},Oe=["onClick"],Ae={class:"add-emotion"},Ne={class:"detail-section"},Ge={class:"stats-grid"},He={class:"stat-card"},qe={class:"stat-value"},Je={class:"stat-card"},We={class:"stat-value"},Ze={class:"detail-section"},Xe={class:"info-grid"},Ye={class:"info-item"},es={class:"value"},ss={class:"info-item"},ts={class:"value"},os={class:"info-item"},ls={class:"value"},as={class:"detail-section"},is={class:"status-controls"},ns={class:"switch"},rs={class:"dialog-footer"},ds=["disabled"],us=G({__name:"EmojiDetailDialog",props:{modelValue:{type:Boolean},emojiHash:{}},emits:["update:modelValue","updated","deleted"],setup(s,{emit:o}){const v=s,E=o,$=Z(),n=w(null),g=w(""),j=w(""),_=w([]),y=w(!1),d=w(""),b=w(""),V=w(""),I=w([]),F=w(!1),T=h=>{const t=h.match(/Keywords:\s*\[(.*?)\]/),l=h.match(/Desc:\s*(.*)/),u=h.match(/^(.*?)\s*Keywords:/);return{refined:u?u[1].trim():"",keywords:t?t[1].split(",").map(x=>x.trim()).filter(Boolean):[],detailed:l?l[1].trim():h}},M=()=>{const h=_.value.join(",");return`${g.value.trim()} Keywords: [${h}] Desc: ${j.value.trim()}`},B=L(()=>{if(g.value.trim()!==b.value.trim()||j.value.trim()!==V.value.trim()||y.value!==F.value||_.value.length!==I.value.length)return!0;const h=[..._.value].sort(),t=[...I.value].sort();return!h.every((l,u)=>l===t[u])});X(()=>[v.modelValue,v.emojiHash],async([h,t])=>{if(h&&t)try{if(n.value=await $.getEmojiDetail(t),n.value){const l=T(n.value.description);g.value=l.refined,j.value=l.detailed,_.value=l.keywords.length>0?l.keywords:[...n.value.emotions],y.value=n.value.is_banned,b.value=l.refined,V.value=l.detailed,I.value=l.keywords.length>0?[...l.keywords]:[...n.value.emotions],F.value=n.value.is_banned}}catch(l){console.error("加载表情包详情失败:",l),i()}},{immediate:!0});const i=()=>{E("update:modelValue",!1),n.value=null},a=()=>{d.value.trim()&&(_.value.push(d.value.trim()),d.value="")},f=h=>{_.value.splice(h,1)},m=async()=>{if(n.value)try{const h=M();await $.updateEmoji(n.value.hash,{description:h,emotions:_.value,is_banned:y.value}),E("updated"),i()}catch(h){console.error("保存失败:",h),alert("保存失败，请重试")}},k=async()=>{if(n.value&&confirm(`确定要删除表情包"${n.value.description}"吗？`))try{await $.deleteEmoji(n.value.hash),E("deleted"),i()}catch(h){console.error("删除失败:",h),alert("删除失败，请重试")}},S=h=>h?new Date(h*1e3).toLocaleString("zh-CN"):"未记录";return(h,t)=>(r(),W(se,{to:"body"},[N(Y,{name:"dialog"},{default:ee(()=>[s.modelValue&&n.value?(r(),c("div",{key:0,class:"dialog-overlay",onClick:i},[e("div",{class:"dialog-container",onClick:t[4]||(t[4]=z(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[t[6]||(t[6]=e("h2",null,"表情包详情",-1)),e("button",{class:"close-button",onClick:i},[...t[5]||(t[5]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])]),e("div",Se,[e("div",Ce,[n.value.full_image?(r(),c("img",{key:0,src:n.value.full_image,alt:"表情包图片",class:"full-image"},null,8,Ie)):C("",!0)]),e("div",Ve,[t[10]||(t[10]=e("h3",null,"基本信息",-1)),e("div",xe,[e("div",Be,[t[7]||(t[7]=e("label",null,"哈希值",-1)),e("div",ze,p(n.value.hash),1)]),e("div",Fe,[t[8]||(t[8]=e("label",null,"格式",-1)),e("div",Me,p(n.value.format.toUpperCase()),1)]),e("div",Ue,[t[9]||(t[9]=e("label",null,"文件路径",-1)),e("div",{class:"value truncate",title:n.value.full_path},p(n.value.full_path),9,Le)])])]),e("div",Pe,[t[11]||(t[11]=e("h3",null,"精炼描述",-1)),Q(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>g.value=l),class:"description-input",rows:"2",placeholder:"输入精炼的自然语言描述..."},null,512),[[A,g.value]])]),e("div",Te,[t[12]||(t[12]=e("h3",null,"详细描述",-1)),Q(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>j.value=l),class:"description-input",rows:"4",placeholder:"输入详细描述（不超过250字）..."},null,512),[[A,j.value]])]),e("div",Qe,[t[15]||(t[15]=e("h3",null,"情感标签",-1)),e("div",Re,[e("div",Ke,[(r(!0),c(K,null,O(_.value,(l,u)=>(r(),c("span",{key:u,class:"emotion-chip"},[P(p(l)+" ",1),e("button",{onClick:x=>f(u)},[...t[13]||(t[13]=[e("span",{class:"material-symbols-rounded"},"close",-1)])],8,Oe)]))),128))]),e("div",Ae,[Q(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.value=l),type:"text",placeholder:"添加情感标签...",onKeyup:oe(a,["enter"])},null,544),[[A,d.value]]),e("button",{onClick:a},[...t[14]||(t[14]=[e("span",{class:"material-symbols-rounded"},"add",-1)])])])])]),e("div",Ne,[t[20]||(t[20]=e("h3",null,"统计信息",-1)),e("div",Ge,[e("div",He,[t[17]||(t[17]=e("span",{class:"material-symbols-rounded"},"visibility",-1)),e("div",null,[e("div",qe,p(n.value.query_count),1),t[16]||(t[16]=e("div",{class:"stat-label"},"查询次数",-1))])]),e("div",Je,[t[19]||(t[19]=e("span",{class:"material-symbols-rounded"},"emoji_emotions",-1)),e("div",null,[e("div",We,p(n.value.usage_count),1),t[18]||(t[18]=e("div",{class:"stat-label"},"使用次数",-1))])])])]),e("div",Ze,[t[24]||(t[24]=e("h3",null,"时间信息",-1)),e("div",Xe,[e("div",Ye,[t[21]||(t[21]=e("label",null,"记录时间",-1)),e("div",es,p(S(n.value.record_time)),1)]),e("div",ss,[t[22]||(t[22]=e("label",null,"注册时间",-1)),e("div",ts,p(S(n.value.register_time)),1)]),e("div",os,[t[23]||(t[23]=e("label",null,"最后使用",-1)),e("div",ls,p(S(n.value.last_used_time)),1)])])]),e("div",as,[t[27]||(t[27]=e("h3",null,"状态控制",-1)),e("div",is,[e("label",ns,[Q(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>y.value=l),type:"checkbox"},null,512),[[le,y.value]]),t[25]||(t[25]=e("span",{class:"slider"},null,-1)),t[26]||(t[26]=e("span",{class:"label"},"禁用表情包",-1))])])])]),e("div",rs,[e("button",{class:"secondary-button",onClick:i}," 取消 "),e("button",{class:"danger-button",onClick:k}," 删除 "),e("button",{class:"primary-button",onClick:m,disabled:!B.value}," 保存更改 ",8,ds)])])])):C("",!0)]),_:1})]))}}),cs=H(us,[["__scopeId","data-v-c6454860"]]),ms={class:"dialog-content"},vs={key:0,class:"file-list"},ps={class:"file-grid"},fs={class:"file-preview"},gs=["src","alt"],hs={key:1,class:"preview-placeholder"},ys={class:"file-info"},bs=["title"],_s={class:"file-size"},ws={key:0,class:"file-error"},$s={key:1,class:"file-progress"},js={class:"progress-bar"},ks={class:"progress-text"},Es={key:2,class:"file-success"},Ds=["disabled","onClick"],Ss={key:1,class:"upload-stats"},Cs={class:"stat-item"},Is={class:"stat-item success"},Vs={class:"stat-item error"},xs={class:"dialog-footer"},Bs=["disabled"],zs=["disabled"],Fs={key:0},Ms={key:1},Us=G({__name:"EmojiUploadDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","uploaded"],setup(s,{emit:o}){const v=s,E=o,$=Z(),n=w(null),g=w([]),j=w(!1),_=w(!1),y=L(()=>({total:g.value.length,success:g.value.filter(i=>i.success).length,failed:g.value.filter(i=>i.error).length}));X(()=>v.modelValue,i=>{i||(g.value=[],_.value=!1)});const d=()=>{var i;(i=n.value)==null||i.click()},b=i=>{const a=i.target;a.files&&I(Array.from(a.files))},V=i=>{var a;j.value=!1,(a=i.dataTransfer)!=null&&a.files&&I(Array.from(i.dataTransfer.files))},I=i=>{const a=["image/png","image/jpeg","image/gif","image/webp"];for(const m of i){if(!a.includes(m.type)){alert(`文件 ${m.name} 格式不支持`);continue}if(m.size>10485760){alert(`文件 ${m.name} 超过大小限制（10MB）`);continue}if(g.value.some(h=>h.name===m.name&&h.size===m.size))continue;const k=new FileReader,S={name:m.name,size:m.size,file:m,preview:null,uploading:!1,success:!1,error:null,progress:0};k.onload=h=>{var t;S.preview=(t=h.target)==null?void 0:t.result},k.readAsDataURL(m),g.value.push(S)}},F=i=>{g.value.splice(i,1)},T=async()=>{if(g.value.length===0)return;_.value=!0;const i=[];for(const a of g.value)!a.success&&!a.error&&i.push(a.file);try{for(const m of g.value)!m.success&&!m.error&&(m.uploading=!0,m.progress=0);const a=setInterval(()=>{for(const m of g.value)m.uploading&&m.progress<90&&(m.progress=parseFloat((m.progress+Math.random()*10).toFixed(2)))},200),f=await $.uploadEmojis(i);clearInterval(a);for(const m of f.success||[]){const k=g.value.find(S=>S.name===m.filename);k&&(k.uploading=!1,k.success=!0,k.progress=100)}for(const m of f.failed||[]){const k=g.value.find(S=>S.name===m.filename);k&&(k.uploading=!1,k.error=m.error||"上传失败",k.progress=0)}f.failed.length===0&&setTimeout(()=>{E("uploaded"),B()},1500)}catch(a){console.error("上传失败:",a);for(const f of g.value)f.uploading&&(f.uploading=!1,f.error="上传失败，请重试")}finally{_.value=!1}},M=i=>i<1024?i+" B":i<1024*1024?(i/1024).toFixed(2)+" KB":(i/(1024*1024)).toFixed(2)+" MB",B=()=>{_.value&&!confirm("上传正在进行中，确定要关闭吗？")||E("update:modelValue",!1)};return(i,a)=>(r(),W(se,{to:"body"},[N(Y,{name:"dialog"},{default:ee(()=>[s.modelValue?(r(),c("div",{key:0,class:"dialog-overlay",onClick:B},[e("div",{class:"dialog-container",onClick:a[2]||(a[2]=z(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[a[4]||(a[4]=e("h2",null,"上传表情包",-1)),e("button",{class:"close-button",onClick:B},[...a[3]||(a[3]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])]),e("div",ms,[e("div",{class:R(["upload-area",{"drag-over":j.value}]),onDrop:z(V,["prevent"]),onDragover:a[0]||(a[0]=z(f=>j.value=!0,["prevent"])),onDragleave:a[1]||(a[1]=z(f=>j.value=!1,["prevent"])),onClick:d},[a[5]||(a[5]=e("span",{class:"material-symbols-rounded upload-icon"},"cloud_upload",-1)),a[6]||(a[6]=e("p",{class:"upload-text"},"拖拽文件到此处或点击选择",-1)),a[7]||(a[7]=e("p",{class:"upload-hint"},"支持 PNG, JPG, GIF, WEBP 格式",-1)),e("input",{ref_key:"fileInput",ref:n,type:"file",multiple:"",accept:"image/png,image/jpeg,image/gif,image/webp",style:{display:"none"},onChange:b},null,544)],34),g.value.length>0?(r(),c("div",vs,[e("h3",null,"待上传文件 ("+p(g.value.length)+")",1),e("div",ps,[(r(!0),c(K,null,O(g.value,(f,m)=>(r(),c("div",{key:m,class:R(["file-item",{"upload-error":f.error,"upload-success":f.success}])},[e("div",fs,[f.preview?(r(),c("img",{key:0,src:f.preview,alt:f.name},null,8,gs)):(r(),c("div",hs,[...a[8]||(a[8]=[e("span",{class:"material-symbols-rounded"},"image",-1)])]))]),e("div",ys,[e("div",{class:"file-name",title:f.name},p(f.name),9,bs),e("div",_s,p(M(f.size)),1),f.error?(r(),c("div",ws,p(f.error),1)):C("",!0),f.uploading?(r(),c("div",$s,[e("div",js,[e("div",{class:"progress-fill",style:ae({width:f.progress+"%"})},null,4)]),e("div",ks,p(f.progress.toFixed(2))+"%",1)])):C("",!0),f.success?(r(),c("div",Es,[...a[9]||(a[9]=[e("span",{class:"material-symbols-rounded"},"check_circle",-1),P(" 上传成功 ",-1)])])):C("",!0)]),e("button",{class:"remove-button",disabled:f.uploading,onClick:k=>F(m)},[...a[10]||(a[10]=[e("span",{class:"material-symbols-rounded"},"close",-1)])],8,Ds)],2))),128))])])):C("",!0),y.value.total>0?(r(),c("div",Ss,[e("div",Cs,[a[11]||(a[11]=e("span",{class:"material-symbols-rounded"},"folder",-1)),e("span",null,"总计: "+p(y.value.total),1)]),e("div",Is,[a[12]||(a[12]=e("span",{class:"material-symbols-rounded"},"check_circle",-1)),e("span",null,"成功: "+p(y.value.success),1)]),e("div",Vs,[a[13]||(a[13]=e("span",{class:"material-symbols-rounded"},"error",-1)),e("span",null,"失败: "+p(y.value.failed),1)])])):C("",!0)]),e("div",xs,[e("button",{class:"secondary-button",onClick:B,disabled:_.value}," 取消 ",8,Bs),e("button",{class:"primary-button",onClick:T,disabled:g.value.length===0||_.value},[_.value?(r(),c("span",Fs,"上传中...")):(r(),c("span",Ms,"开始上传 ("+p(g.value.length)+")",1))],8,zs)])])])):C("",!0)]),_:1})]))}}),Ls=H(Us,[["__scopeId","data-v-a0ec4381"]]),Ps={class:"emoji-manager"},Ts={class:"toolbar"},Qs={class:"toolbar-left"},Rs={class:"search-box"},Ks={class:"toolbar-right"},Os={key:0,class:"stats-card"},As={class:"stat-item"},Ns={class:"stat-content"},Gs={class:"stat-value"},Hs={class:"stat-item"},qs={class:"stat-content"},Js={class:"stat-value"},Ws={class:"stat-item"},Zs={class:"stat-content"},Xs={class:"stat-value"},Ys={class:"stat-item"},et={class:"stat-content"},st={class:"stat-value"},tt={class:"emoji-grid-container"},ot={key:0,class:"loading-container"},lt={key:1,class:"empty-state"},at={key:2,class:"grid"},it={key:1,class:"pagination"},nt=["disabled"],rt={class:"page-numbers"},dt=["onClick"],ut=["disabled"],ct={class:"page-info"},mt=G({__name:"EmojiManager",setup(s){const o=Z(),{items:v,total:E,page:$,totalPages:n,loading:g,selectedItems:j,hasSelection:_,selectionCount:y}=ie(o),d=w(""),b=w({total_count:0,registered_count:0,banned_count:0,avg_usage:0}),V=w(!1),I=w(!1),F=w(""),T=L(()=>{const t=[];let u=Math.max(1,$.value-Math.floor(3.5)),x=Math.min(n.value,u+7-1);x-u<6&&(u=Math.max(1,x-7+1));for(let q=u;q<=x;q++)t.push(q);return t});let M=null;const B=()=>{M&&clearTimeout(M),M=setTimeout(()=>{o.setSearchQuery(d.value),o.fetchEmojiList()},300)},i=async()=>{await o.fetchEmojiList();const t=await o.getStats();t&&(b.value=t)},a=t=>{o.toggleSelection(t)},f=t=>{F.value=t,V.value=!0},m=async t=>{if(confirm("确定要删除这个表情包吗？"))try{await o.deleteEmoji(t)}catch{alert("删除失败")}},k=async()=>{if(confirm(`确定要删除选中的 ${y.value} 个表情包吗？`))try{await o.batchDelete(Array.from(j.value)),o.clearSelection()}catch{alert("批量删除失败")}},S=t=>{o.setPage(t),o.fetchEmojiList()},h=async()=>{await i(),I.value=!1};return ne(async()=>{await o.fetchEmojiList();const t=await o.getStats();t&&(b.value=t)}),(t,l)=>(r(),c("div",Ps,[e("div",Ts,[e("div",Qs,[e("div",Rs,[l[6]||(l[6]=e("span",{class:"material-symbols-rounded"},"search",-1)),Q(e("input",{"onUpdate:modelValue":l[0]||(l[0]=u=>d.value=u),type:"text",placeholder:"搜索表情包描述...",onInput:B},null,544),[[A,d.value]])]),e("button",{class:"icon-button",title:"刷新",onClick:i},[...l[7]||(l[7]=[e("span",{class:"material-symbols-rounded"},"refresh",-1)])])]),e("div",Ks,[D(_)?(r(),c("button",{key:0,class:"batch-button delete",onClick:k},[l[8]||(l[8]=e("span",{class:"material-symbols-rounded"},"delete",-1)),P(" 删除选中 ("+p(D(y))+") ",1)])):C("",!0),e("button",{class:"upload-button",onClick:l[1]||(l[1]=u=>I.value=!0)},[...l[9]||(l[9]=[e("span",{class:"material-symbols-rounded"},"upload",-1),P(" 上传表情包 ",-1)])])])]),b.value?(r(),c("div",Os,[e("div",As,[l[11]||(l[11]=e("span",{class:"material-symbols-rounded icon"},"inventory_2",-1)),e("div",Ns,[e("div",Gs,p(b.value.total_count),1),l[10]||(l[10]=e("div",{class:"stat-label"},"总表情包数",-1))])]),e("div",Hs,[l[13]||(l[13]=e("span",{class:"material-symbols-rounded icon"},"check_circle",-1)),e("div",qs,[e("div",Js,p(b.value.registered_count),1),l[12]||(l[12]=e("div",{class:"stat-label"},"已注册",-1))])]),e("div",Ws,[l[15]||(l[15]=e("span",{class:"material-symbols-rounded icon"},"block",-1)),e("div",Zs,[e("div",Xs,p(b.value.banned_count),1),l[14]||(l[14]=e("div",{class:"stat-label"},"已禁用",-1))])]),e("div",Ys,[l[17]||(l[17]=e("span",{class:"material-symbols-rounded icon"},"trending_up",-1)),e("div",et,[e("div",st,p(b.value.total_usage),1),l[16]||(l[16]=e("div",{class:"stat-label"},"总使用次数",-1))])])])):C("",!0),e("div",tt,[D(g)?(r(),c("div",ot,[...l[18]||(l[18]=[e("div",{class:"spinner"},null,-1),e("p",null,"加载中...",-1)])])):D(v).length===0?(r(),c("div",lt,[...l[19]||(l[19]=[e("span",{class:"material-symbols-rounded"},"image_not_supported",-1),e("p",null,"暂无表情包",-1)])])):(r(),c("div",at,[(r(!0),c(K,null,O(D(v),u=>(r(),W(De,{key:u.hash,emoji:u,selected:D(j).has(u.hash),onSelect:x=>a(u.hash),onViewDetail:x=>f(u.hash),onDelete:x=>m(u.hash)},null,8,["emoji","selected","onSelect","onViewDetail","onDelete"]))),128))]))]),D(n)>1?(r(),c("div",it,[e("button",{class:"page-button",disabled:D($)===1,onClick:l[2]||(l[2]=u=>S(D($)-1))},[...l[20]||(l[20]=[e("span",{class:"material-symbols-rounded"},"chevron_left",-1)])],8,nt),e("div",rt,[(r(!0),c(K,null,O(T.value,u=>(r(),c("button",{key:u,class:R(["page-number",{active:u===D($)}]),onClick:x=>S(u)},p(u),11,dt))),128))]),e("button",{class:"page-button",disabled:D($)===D(n),onClick:l[3]||(l[3]=u=>S(D($)+1))},[...l[21]||(l[21]=[e("span",{class:"material-symbols-rounded"},"chevron_right",-1)])],8,ut),e("div",ct," 第 "+p(D($))+" / "+p(D(n))+" 页，共 "+p(D(E))+" 条 ",1)])):C("",!0),N(cs,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=u=>V.value=u),"emoji-hash":F.value,onUpdated:i,onDeleted:i},null,8,["modelValue","emoji-hash"]),N(Ls,{modelValue:I.value,"onUpdate:modelValue":l[5]||(l[5]=u=>I.value=u),onUploaded:h},null,8,["modelValue"])]))}}),pt=H(mt,[["__scopeId","data-v-36f3be1a"]]);export{pt as default};
