import{a2 as M,d as W,z as i,c as X,o as Y,l as a,ae as ee,q as e,B as d,m as c,F as C,D as h,j as N,O as z,P as I,R as se,v as n,k as R,T as B,r as le,Z as te,y as o,C as ae,_ as oe}from"./index-2cLGT6AP.js";function ne(){return M.get("log_viewer/files")}function ie(_){const v=new URLSearchParams;return Object.entries(_).forEach(([$,r])=>{r!=null&&r!==""&&v.append($,r.toString())}),M.get(`log_viewer/search?${v.toString()}`)}function re(_){return M.get(`log_viewer/loggers?filename=${encodeURIComponent(_)}`)}function de(_){return M.get(`log_viewer/stats?filename=${encodeURIComponent(_)}`)}const ue={class:"log-viewer-view"},ve={class:"content-wrapper"},ce={class:"log-container"},pe={class:"m3-card file-list-panel"},me={class:"panel-header"},ge=["disabled"],fe={class:"file-list"},be=["onClick"],ye={class:"material-symbols-rounded file-icon"},_e={class:"file-details"},ke={class:"file-name"},we={class:"file-meta"},Ce={key:0,class:"empty-state small"},he={class:"m3-card log-content-panel"},$e={class:"toolbar"},xe={class:"search-group"},Le={class:"search-input-wrapper"},Se=["disabled"],Ve={class:"filter-group"},Ue={key:0,class:"select-options m3-card"},Fe=["onClick"],Te={key:0,class:"select-options m3-card"},Pe=["onClick"],De={key:0,class:"advanced-filter"},Ee={class:"filter-row"},Ne={class:"filter-row"},ze={class:"filter-row checkbox-row"},Re={class:"m3-checkbox-label"},Be={key:0,class:"stats-bar"},Me={class:"stat-item"},Oe={class:"stat-value"},je={class:"stat-label"},Ie={class:"log-entries",ref:"logEntriesContainer"},qe={key:0,class:"loading-state"},Ke={key:1,class:"empty-state"},Ae={key:2,class:"empty-state"},Je={key:3,class:"entries-list"},Qe={class:"entry-header"},Ze={class:"entry-time"},Ge={class:"entry-line"},He={class:"entry-message"},We={key:0,class:"entry-extra"},Xe={key:1,class:"pagination"},Ye=["disabled"],es=["disabled"],ss={class:"pagination-info"},ls=["disabled"],ts=["disabled"],as={key:0,class:"select-options m3-card up"},os=["onClick"],ns=W({__name:"LogViewerView",setup(_){const v=i(!1),$=i([]),r=i(""),S=i([]),O=i([]),V=i(null),U=i(""),f=i(""),p=i(""),F=i(""),T=i(""),P=i(!1),D=i(!1),m=i(!1),g=i(!1),b=i(!1),u=i(1),k=i(100),j=i(0),x=X(()=>Math.ceil(j.value/k.value)),q=async()=>{v.value=!0;try{const t=await ne();t.success&&t.data?$.value=t.data.files:console.error("获取日志文件列表失败")}catch(t){console.error("加载日志文件失败:",t)}finally{v.value=!1}},A=async t=>{r.value=t,u.value=1,await J(),await Q(),await L()},J=async()=>{if(r.value)try{const t=await re(r.value);t.success&&t.data&&(O.value=t.data.loggers)}catch(t){console.error("加载 logger 列表失败:",t)}},Q=async()=>{if(r.value)try{const t=await de(r.value);t.success&&t.data&&(V.value=t.data)}catch(t){console.error("加载统计信息失败:",t)}},L=async()=>{if(r.value){v.value=!0;try{const t=(u.value-1)*k.value,s=await ie({filename:r.value,query:U.value,level:f.value,logger_name:p.value,start_time:F.value,end_time:T.value,limit:k.value,offset:t,regex:P.value});s.success&&s.data?(S.value=s.data.entries,j.value=s.data.total):console.error("搜索日志失败")}catch(t){console.error("搜索日志失败:",t)}finally{v.value=!1}}},w=()=>{u.value=1,L()},Z=()=>{U.value="",f.value="",p.value="",F.value="",T.value="",P.value=!1,u.value=1,L()},E=t=>{t<1||t>x.value||(u.value=t,L())},G=()=>{u.value=1,L()},H=t=>t?t.replace("T"," ").substring(0,19):"";return Y(()=>{q()}),(t,s)=>{var K;return o(),a("div",ue,[s[38]||(s[38]=ee('<header class="page-header" data-v-c13713b4><div class="header-content" data-v-c13713b4><div class="title-group" data-v-c13713b4><div class="header-icon-container" data-v-c13713b4><span class="material-symbols-rounded header-icon" data-v-c13713b4>description</span></div><div class="header-text" data-v-c13713b4><h1 class="page-title" data-v-c13713b4>日志查看器</h1><p class="page-description" data-v-c13713b4>查看、搜索和分析系统日志</p></div></div></div></header>',1)),e("div",ve,[e("div",ce,[e("div",pe,[e("div",me,[s[17]||(s[17]=e("h3",{class:"panel-title"},"日志文件",-1)),e("button",{class:"m3-icon-button",onClick:q,disabled:v.value,title:"刷新列表"},[e("span",{class:d(["material-symbols-rounded",{spinning:v.value}])},"refresh",2)],8,ge)]),e("div",fe,[(o(!0),a(C,null,h($.value,l=>(o(),a("div",{key:l.name,class:d(["file-item",{active:r.value===l.name}]),onClick:y=>A(l.name)},[e("span",ye,n(l.compressed?"folder_zip":"text_snippet"),1),e("div",_e,[e("div",ke,n(l.name),1),e("div",we,[e("span",null,n(l.size_human),1),e("span",null,n(l.mtime_human),1)])])],10,be))),128)),$.value.length===0&&!v.value?(o(),a("div",Ce,[...s[18]||(s[18]=[e("span",{class:"material-symbols-rounded empty-icon"},"inbox",-1),e("p",null,"暂无日志文件",-1)])])):c("",!0)])]),e("div",he,[e("div",$e,[e("div",xe,[e("div",Le,[s[19]||(s[19]=e("span",{class:"material-symbols-rounded search-icon"},"search",-1)),z(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>U.value=l),type:"text",placeholder:"搜索日志内容...",class:"m3-input search-input",onKeyup:se(w,["enter"])},null,544),[[I,U.value]])]),e("button",{class:"m3-button filled",onClick:w,disabled:!r.value||v.value}," 搜索 ",8,Se)]),e("div",Ve,[e("div",{class:d(["custom-select",{active:m.value}])},[e("div",{class:"select-trigger",onClick:s[1]||(s[1]=l=>{m.value=!m.value,g.value=!1})},[e("span",null,n(f.value?f.value.toUpperCase():"所有级别"),1),s[20]||(s[20]=e("span",{class:"material-symbols-rounded select-arrow"},"arrow_drop_down",-1))]),N(B,{name:"scale-y"},{default:R(()=>[m.value?(o(),a("div",Ue,[e("div",{class:d(["select-option",{selected:f.value===""}]),onClick:s[2]||(s[2]=l=>{f.value="",w(),m.value=!1})}," 所有级别 ",2),(o(),a(C,null,h(["debug","info","warning","error","critical"],l=>e("div",{key:l,class:d(["select-option",{selected:f.value===l}]),onClick:y=>{f.value=l,w(),m.value=!1}},n(l.toUpperCase()),11,Fe)),64))])):c("",!0)]),_:1}),m.value?(o(),a("div",{key:0,class:"dropdown-overlay",onClick:s[3]||(s[3]=l=>m.value=!1)})):c("",!0)],2),e("div",{class:d(["custom-select",{active:g.value}])},[e("div",{class:"select-trigger",onClick:s[4]||(s[4]=l=>{g.value=!g.value,m.value=!1})},[e("span",null,n(p.value?((K=O.value.find(l=>l.name===p.value))==null?void 0:K.alias)||p.value:"所有模块"),1),s[21]||(s[21]=e("span",{class:"material-symbols-rounded select-arrow"},"arrow_drop_down",-1))]),N(B,{name:"scale-y"},{default:R(()=>[g.value?(o(),a("div",Te,[e("div",{class:d(["select-option",{selected:p.value===""}]),onClick:s[5]||(s[5]=l=>{p.value="",w(),g.value=!1})}," 所有模块 ",2),(o(!0),a(C,null,h(O.value,l=>(o(),a("div",{key:l.name,class:d(["select-option",{selected:p.value===l.name}]),onClick:y=>{p.value=l.name,w(),g.value=!1}},n(l.alias||l.name),11,Pe))),128))])):c("",!0)]),_:1}),g.value?(o(),a("div",{key:0,class:"dropdown-overlay",onClick:s[6]||(s[6]=l=>g.value=!1)})):c("",!0)],2),e("button",{class:d(["m3-icon-button",{active:D.value}]),onClick:s[7]||(s[7]=l=>D.value=!D.value),title:"高级筛选"},[...s[22]||(s[22]=[e("span",{class:"material-symbols-rounded"},"filter_list",-1)])],2),e("button",{class:"m3-icon-button",onClick:Z,title:"清除筛选"},[...s[23]||(s[23]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])])]),N(B,{name:"slide-down"},{default:R(()=>[D.value?(o(),a("div",De,[e("div",Ee,[s[24]||(s[24]=e("label",{class:"filter-label"},"开始时间",-1)),z(e("input",{"onUpdate:modelValue":s[8]||(s[8]=l=>F.value=l),type:"datetime-local",class:"m3-input filter-input"},null,512),[[I,F.value]])]),e("div",Ne,[s[25]||(s[25]=e("label",{class:"filter-label"},"结束时间",-1)),z(e("input",{"onUpdate:modelValue":s[9]||(s[9]=l=>T.value=l),type:"datetime-local",class:"m3-input filter-input"},null,512),[[I,T.value]])]),e("div",ze,[e("label",Re,[z(e("input",{"onUpdate:modelValue":s[10]||(s[10]=l=>P.value=l),type:"checkbox",class:"m3-checkbox"},null,512),[[te,P.value]]),s[26]||(s[26]=le(" 使用正则表达式 ",-1))])])])):c("",!0)]),_:1}),V.value?(o(),a("div",Be,[e("div",Me,[s[27]||(s[27]=e("span",{class:"stat-label"},"总计:",-1)),e("span",Oe,n(V.value.total),1)]),(o(!0),a(C,null,h(V.value.by_level,(l,y)=>(o(),a("div",{class:"stat-item",key:y},[e("span",je,n(y.toUpperCase())+":",1),e("span",{class:d(["stat-value","level-"+y.toLowerCase()])},n(l),3)]))),128))])):c("",!0),e("div",Ie,[v.value?(o(),a("div",qe,[...s[28]||(s[28]=[e("span",{class:"material-symbols-rounded spinning loading-icon"},"progress_activity",-1),e("p",null,"加载中...",-1)])])):r.value?S.value.length===0?(o(),a("div",Ae,[...s[30]||(s[30]=[e("span",{class:"material-symbols-rounded empty-icon"},"inbox",-1),e("p",null,"没有找到日志条目",-1)])])):(o(),a("div",Je,[(o(!0),a(C,null,h(S.value,l=>(o(),a("div",{key:l.file_name+"-"+l.line_number,class:d(["log-entry",`level-${l.level.toLowerCase()}`])},[e("div",Qe,[e("span",Ze,n(H(l.timestamp)),1),e("span",{class:d(["entry-level",`level-${l.level.toLowerCase()}`])},n(l.level.toUpperCase()),3),e("span",{class:"entry-logger",style:ae({color:l.color})},n(l.alias||l.logger_name),5),e("span",Ge,"Line "+n(l.line_number),1)]),e("div",He,n(l.event),1),l.extra&&Object.keys(l.extra).length>0?(o(),a("div",We,[e("details",null,[s[31]||(s[31]=e("summary",null,"额外信息",-1)),e("pre",null,n(JSON.stringify(l.extra,null,2)),1)])])):c("",!0)],2))),128))])):(o(),a("div",Ke,[...s[29]||(s[29]=[e("span",{class:"material-symbols-rounded empty-icon"},"find_in_page",-1),e("p",null,"请选择一个日志文件或启用实时日志",-1)])]))],512),S.value.length>0?(o(),a("div",Xe,[e("button",{class:"m3-icon-button small",disabled:u.value===1,onClick:s[11]||(s[11]=l=>E(1)),title:"第一页"},[...s[32]||(s[32]=[e("span",{class:"material-symbols-rounded"},"first_page",-1)])],8,Ye),e("button",{class:"m3-icon-button small",disabled:u.value===1,onClick:s[12]||(s[12]=l=>E(u.value-1)),title:"上一页"},[...s[33]||(s[33]=[e("span",{class:"material-symbols-rounded"},"chevron_left",-1)])],8,es),e("div",ss,[e("span",null,"第 "+n(u.value)+" / "+n(x.value)+" 页",1),s[34]||(s[34]=e("span",{class:"separator"},"|",-1)),e("span",null,"共 "+n(j.value)+" 条",1)]),e("button",{class:"m3-icon-button small",disabled:u.value===x.value,onClick:s[13]||(s[13]=l=>E(u.value+1)),title:"下一页"},[...s[35]||(s[35]=[e("span",{class:"material-symbols-rounded"},"chevron_right",-1)])],8,ls),e("button",{class:"m3-icon-button small",disabled:u.value===x.value,onClick:s[14]||(s[14]=l=>E(x.value)),title:"最后一页"},[...s[36]||(s[36]=[e("span",{class:"material-symbols-rounded"},"last_page",-1)])],8,ts),e("div",{class:d(["custom-select small",{active:b.value}])},[e("div",{class:"select-trigger",onClick:s[15]||(s[15]=l=>b.value=!b.value)},[e("span",null,n(k.value)+" 条/页",1),s[37]||(s[37]=e("span",{class:"material-symbols-rounded select-arrow"},"arrow_drop_down",-1))]),N(B,{name:"scale-y"},{default:R(()=>[b.value?(o(),a("div",as,[(o(),a(C,null,h([50,100,200,500],l=>e("div",{key:l,class:d(["select-option",{selected:k.value===l}]),onClick:y=>{k.value=l,G(),b.value=!1}},n(l)+" 条/页 ",11,os)),64))])):c("",!0)]),_:1}),b.value?(o(),a("div",{key:0,class:"dropdown-overlay",onClick:s[16]||(s[16]=l=>b.value=!1)})):c("",!0)],2)])):c("",!0)])])])])}}}),rs=oe(ns,[["__scopeId","data-v-c13713b4"]]);export{rs as default};
