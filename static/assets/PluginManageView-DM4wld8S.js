import{d as K,z as k,o as R,l as n,q as s,m as u,j as E,r as m,B as g,v as r,u as d,F as w,D as C,O as z,P as I,k as A,T as S,p as T,ah as U,y as l,_ as q}from"./index-Dp6KJFJl.js";import{u as G}from"./plugin-DxSB6c-z.js";const O={class:"plugin-manage-view"},Y={class:"page-header"},H={class:"header-actions"},J=["disabled"],N=["disabled"],Q=["disabled"],W={class:"stats-grid"},X={class:"m3-card stat-card primary-container"},Z={class:"stat-content"},ss={class:"stat-value"},es={class:"m3-card stat-card success-container"},ts={class:"stat-content"},os={class:"stat-value"},as={class:"m3-card stat-card tertiary-container"},ns={class:"stat-content"},ls={class:"stat-value"},rs={class:"m3-card stat-card error-container"},is={class:"stat-content"},ds={class:"stat-value"},cs={class:"filter-bar"},us={class:"filter-chips"},ms=["onClick"],vs={key:0,class:"material-symbols-rounded check-icon"},_s={class:"search-box"},ys={key:0,class:"section-container"},bs={class:"section-header error-text"},fs={class:"plugin-grid"},hs={class:"card-content"},ps={class:"card-header"},ks={class:"header-text"},gs={class:"plugin-description"},ws={class:"error-message"},Cs={class:"card-actions"},Ps=["onClick"],$s=["onClick"],xs={class:"plugin-list-container"},Es={key:0,class:"loading-state"},As={key:1,class:"error-state"},Ss={key:2,class:"empty-state"},Ts={key:3},Fs={key:0,class:"section-header"},Vs={class:"plugin-grid"},Ds=["onClick"],Ms={class:"card-content"},Bs={class:"card-header"},Ls={class:"plugin-icon"},js={class:"material-symbols-rounded"},Ks={class:"header-text"},Rs={class:"badges"},zs={key:0,class:"m3-assist-chip system"},Is={key:1,class:"m3-assist-chip success"},Us={key:2,class:"m3-assist-chip"},qs={class:"plugin-description"},Gs={key:0,class:"error-message"},Os={class:"plugin-meta"},Ys={class:"meta-item"},Hs={class:"action-left"},Js={key:0,class:"m3-switch"},Ns=["checked","onChange","disabled"],Qs={key:1,class:"system-lock"},Ws={class:"action-right"},Xs=["onClick"],Zs=["onClick"],se=["onClick"],ee=["onClick"],te={class:"material-symbols-rounded"},oe={class:"dialog-content"},ae={class:"headline"},ne={class:"supporting-text"},le={class:"dialog-actions"},re=K({__name:"PluginManageView",setup(ie){const F=U(),a=G(),V=[{label:"全部",value:"all"},{label:"已加载",value:"loaded"},{label:"已启用",value:"enabled"},{label:"失败",value:"failed"}],c=k(!1),h=k(""),D=["Affinity Flow Chatter","Kokoro Flow Chatter","napcat_adapter_plugin","Emoji插件 (Emoji Actions)"];function y(o){return D.includes(o.display_name)}const b=k({show:!1,message:"",type:"success"}),v=k({show:!1,title:"",message:"",onConfirm:()=>{}});function i(o,e="success"){b.value={show:!0,message:o,type:e},setTimeout(()=>{b.value.show=!1},3e3)}function f(o,e,t){v.value={show:!0,title:o,message:e,onConfirm:()=>{t(),v.value.show=!1}}}async function p(){c.value=!0,h.value="",!await a.fetchPlugins()&&a.error&&(h.value=a.error),c.value=!1}async function M(o){try{if(o.enabled){const e=await a.disablePluginAction(o.name);if(!e){i("操作失败：无返回结果","error");return}i(e.success?`插件 ${o.display_name} 已禁用`:e.error||"操作失败",e.success?"success":"error")}else{const e=await a.enablePluginAction(o.name);if(!e){i("操作失败：无返回结果","error");return}i(e.success?`插件 ${o.display_name} 已启用`:e.error||"操作失败",e.success?"success":"error")}}catch(e){i(`操作异常: ${e instanceof Error?e.message:"未知错误"}`,"error")}}async function P(o){const e=a.plugins.find(t=>t.name===o);f("重载插件",`确定要重载插件 "${(e==null?void 0:e.display_name)||o}" 吗？`,async()=>{try{const t=await a.reloadPluginAction(o);if(!t){i("重载失败：无返回结果","error");return}i(t.success?"插件重载成功":t.error||"重载失败",t.success?"success":"error")}catch(t){i(`重载异常: ${t instanceof Error?t.message:"未知错误"}`,"error")}})}async function B(o){const e=a.plugins.find(t=>t.name===o);f("加载插件",`确定要加载插件 "${(e==null?void 0:e.display_name)||o}" 吗？`,async()=>{try{const t=await a.loadPluginAction(o);if(!t){i("加载失败：无返回结果","error");return}i(t.success?"插件加载成功":t.error||"加载失败",t.success?"success":"error")}catch(t){i(`加载异常: ${t instanceof Error?t.message:"未知错误"}`,"error")}})}async function $(o,e){f("删除插件",`确定要删除插件 "${e||o}" 吗？此操作将删除插件的所有文件，且无法撤销！`,async()=>{try{const t=await a.deletePluginAction(o);if(!t){i("删除失败：无返回结果","error");return}i(t.success?"插件已删除":t.error||"删除失败",t.success?"success":"error"),t.success&&await p()}catch(t){i(`删除异常: ${t instanceof Error?t.message:"未知错误"}`,"error")}})}async function L(){f("扫描新插件","将扫描插件目录并注册新发现的插件，是否继续？",async()=>{try{c.value=!0;const o=await a.scanForNewPlugins();if(c.value=!1,!o){i("扫描失败：无返回结果","error");return}o.success&&o.data?i(`扫描完成：注册 ${o.data.registered} 个，加载 ${o.data.loaded} 个，失败 ${o.data.failed} 个`,"success"):i(o.error||"扫描失败","error")}catch(o){c.value=!1,i(`扫描异常: ${o instanceof Error?o.message:"未知错误"}`,"error")}})}async function j(){f("重载所有插件","确定要重载所有已加载的插件吗？这可能需要一些时间。",async()=>{try{c.value=!0;const o=await a.reloadAll();if(c.value=!1,!o){i("重载失败：无返回结果","error");return}i(o.success?"所有插件重载成功":o.error||"重载失败",o.success?"success":"error")}catch(o){c.value=!1,i(`重载异常: ${o instanceof Error?o.message:"未知错误"}`,"error")}})}function x(o){const e=a.plugins.find(t=>t.name===o);if(!e||!e.loaded){i("插件未加载，无法查看详情","error");return}F.push(`/dashboard/plugin-manage/${o}`)}return R(()=>{p()}),(o,e)=>(l(),n("div",O,[s("header",Y,[e[9]||(e[9]=s("div",{class:"header-content"},[s("h1",null,"插件管理"),s("p",{class:"subtitle"},"管理系统插件的加载、启用和配置")],-1)),s("div",H,[s("button",{class:"m3-button text",onClick:L,disabled:c.value},[...e[6]||(e[6]=[s("span",{class:"material-symbols-rounded"},"search_check",-1),m(" 扫描新插件 ",-1)])],8,J),s("button",{class:"m3-button text",onClick:j,disabled:c.value},[...e[7]||(e[7]=[s("span",{class:"material-symbols-rounded"},"refresh",-1),m(" 重载所有 ",-1)])],8,N),s("button",{class:"m3-button filled",onClick:p,disabled:c.value},[s("span",{class:g(["material-symbols-rounded",{spinning:c.value}])},r(c.value?"progress_activity":"sync"),3),e[8]||(e[8]=m(" 刷新列表 ",-1))],8,Q)])]),s("div",W,[s("div",X,[e[11]||(e[11]=s("div",{class:"stat-icon"},[s("span",{class:"material-symbols-rounded"},"extension")],-1)),s("div",Z,[s("div",ss,r(d(a).stats.total),1),e[10]||(e[10]=s("div",{class:"stat-label"},"插件总数",-1))])]),s("div",es,[e[13]||(e[13]=s("div",{class:"stat-icon"},[s("span",{class:"material-symbols-rounded"},"check_circle")],-1)),s("div",ts,[s("div",os,r(d(a).stats.loaded),1),e[12]||(e[12]=s("div",{class:"stat-label"},"已加载",-1))])]),s("div",as,[e[15]||(e[15]=s("div",{class:"stat-icon"},[s("span",{class:"material-symbols-rounded"},"bolt")],-1)),s("div",ns,[s("div",ls,r(d(a).stats.enabled),1),e[14]||(e[14]=s("div",{class:"stat-label"},"已启用",-1))])]),s("div",rs,[e[17]||(e[17]=s("div",{class:"stat-icon"},[s("span",{class:"material-symbols-rounded"},"error")],-1)),s("div",is,[s("div",ds,r(d(a).stats.failed),1),e[16]||(e[16]=s("div",{class:"stat-label"},"加载失败",-1))])])]),s("div",cs,[s("div",us,[(l(),n(w,null,C(V,t=>s("button",{key:t.value,class:g(["m3-filter-chip",{selected:d(a).statusFilter===t.value}]),onClick:_=>d(a).setStatusFilter(t.value)},[d(a).statusFilter===t.value?(l(),n("span",vs,"check")):u("",!0),m(" "+r(t.label),1)],10,ms)),64))]),s("div",_s,[e[18]||(e[18]=s("span",{class:"material-symbols-rounded search-icon"},"search",-1)),z(s("input",{type:"text",class:"m3-input",placeholder:"搜索插件名称或描述...","onUpdate:modelValue":e[0]||(e[0]=t=>d(a).searchKeyword=t)},null,512),[[I,d(a).searchKeyword]])])]),!c.value&&d(a).failedPlugins.length>0?(l(),n("div",ys,[s("div",bs,[e[19]||(e[19]=s("span",{class:"material-symbols-rounded"},"error",-1)),s("h2",null,"加载失败 ("+r(d(a).failedPlugins.length)+")",1)]),s("div",fs,[(l(!0),n(w,null,C(d(a).failedPlugins,t=>(l(),n("div",{key:t.name,class:"m3-card plugin-card error-card"},[s("div",hs,[s("div",ps,[e[20]||(e[20]=s("div",{class:"plugin-icon error"},[s("span",{class:"material-symbols-rounded"},"error")],-1)),s("div",ks,[s("h3",null,r(t.display_name),1),s("p",null,"v"+r(t.version)+" • "+r(t.author),1)])]),s("div",gs,r(t.description||"暂无描述"),1),s("div",ws,[e[21]||(e[21]=s("span",{class:"material-symbols-rounded"},"warning",-1)),m(" "+r(t.error||"未知错误"),1)])]),s("div",Cs,[s("button",{class:"m3-button text",onClick:_=>P(t.name)},[...e[22]||(e[22]=[s("span",{class:"material-symbols-rounded"},"refresh",-1),m(" 重试 ",-1)])],8,Ps),y(t)?u("",!0):(l(),n("button",{key:0,class:"m3-button text error",onClick:_=>$(t.name,t.display_name)},[...e[23]||(e[23]=[s("span",{class:"material-symbols-rounded"},"delete",-1),m(" 删除 ",-1)])],8,$s))])]))),128))])])):u("",!0),s("div",xs,[c.value?(l(),n("div",Es,[...e[24]||(e[24]=[s("span",{class:"material-symbols-rounded spinning loading-icon"},"progress_activity",-1),s("p",null,"加载插件列表...",-1)])])):h.value?(l(),n("div",As,[e[25]||(e[25]=s("span",{class:"material-symbols-rounded error-icon"},"error",-1)),s("p",null,r(h.value),1),s("button",{class:"m3-button filled",onClick:p},"重试")])):d(a).filteredPlugins.length===0&&d(a).failedPlugins.length===0?(l(),n("div",Ss,[...e[26]||(e[26]=[s("span",{class:"material-symbols-rounded empty-icon"},"extension_off",-1),s("p",null,"没有找到插件",-1),s("span",{class:"hint"},"尝试调整筛选条件或扫描新插件",-1)])])):d(a).filteredPlugins.length>0?(l(),n("div",Ts,[d(a).failedPlugins.length>0?(l(),n("div",Fs,[e[27]||(e[27]=s("span",{class:"material-symbols-rounded success-text"},"check_circle",-1)),s("h2",null,"正常插件 ("+r(d(a).filteredPlugins.length)+")",1)])):u("",!0),s("div",Vs,[(l(!0),n(w,null,C(d(a).filteredPlugins,t=>(l(),n("div",{key:t.name,class:g(["m3-card plugin-card",{disabled:!t.loaded}]),onClick:_=>t.loaded?x(t.name):null},[s("div",Ms,[s("div",Bs,[s("div",Ls,[s("span",js,r(t.error?"error":"extension"),1)]),s("div",Ks,[s("h3",null,r(t.display_name),1),s("p",null,"v"+r(t.version)+" • "+r(t.author),1)]),s("div",Rs,[y(t)?(l(),n("span",zs,"系统")):u("",!0),t.loaded?(l(),n("span",Is,"已加载")):(l(),n("span",Us,"未加载"))])]),s("div",qs,r(t.description||"暂无描述"),1),t.error?(l(),n("div",Gs,[e[28]||(e[28]=s("span",{class:"material-symbols-rounded"},"warning",-1)),m(" "+r(t.error),1)])):u("",!0),s("div",Os,[s("span",Ys,[e[29]||(e[29]=s("span",{class:"material-symbols-rounded"},"widgets",-1)),m(" "+r(t.components_count)+" 个组件 ",1)])])]),s("div",{class:"card-actions",onClick:e[1]||(e[1]=T(()=>{},["stop"]))},[s("div",Hs,[t.loaded&&!y(t)?(l(),n("label",Js,[s("input",{type:"checkbox",checked:t.enabled,onChange:_=>M(t),disabled:!t.loaded},null,40,Ns),e[30]||(e[30]=s("span",{class:"slider"},null,-1))])):u("",!0),y(t)?(l(),n("div",Qs,[...e[31]||(e[31]=[s("span",{class:"material-symbols-rounded"},"lock",-1),s("span",null,"系统锁定",-1)])])):u("",!0)]),s("div",Ws,[!t.loaded&&!y(t)?(l(),n("button",{key:0,class:"m3-icon-button",onClick:_=>B(t.name),title:"加载插件"},[...e[32]||(e[32]=[s("span",{class:"material-symbols-rounded"},"download",-1)])],8,Xs)):u("",!0),t.loaded&&!y(t)?(l(),n("button",{key:1,class:"m3-icon-button",onClick:_=>P(t.name),title:"重载插件"},[...e[33]||(e[33]=[s("span",{class:"material-symbols-rounded"},"refresh",-1)])],8,Zs)):u("",!0),y(t)?u("",!0):(l(),n("button",{key:2,class:"m3-icon-button error",onClick:_=>$(t.name,t.display_name),title:"删除插件"},[...e[34]||(e[34]=[s("span",{class:"material-symbols-rounded"},"delete",-1)])],8,se)),t.loaded?(l(),n("button",{key:3,class:"m3-icon-button filled-tonal",onClick:_=>x(t.name),title:"查看详情"},[...e[35]||(e[35]=[s("span",{class:"material-symbols-rounded"},"arrow_forward",-1)])],8,ee)):u("",!0)])])],10,Ds))),128))])])):u("",!0)]),E(S,{name:"toast"},{default:A(()=>[b.value.show?(l(),n("div",{key:0,class:g(["m3-snackbar",b.value.type])},[s("span",te,r(b.value.type==="success"?"check_circle":"error"),1),m(" "+r(b.value.message),1)],2)):u("",!0)]),_:1}),E(S,{name:"dialog"},{default:A(()=>[v.value.show?(l(),n("div",{key:0,class:"m3-dialog-overlay",onClick:e[5]||(e[5]=t=>v.value.show=!1)},[s("div",{class:"m3-dialog",onClick:e[4]||(e[4]=T(()=>{},["stop"]))},[e[36]||(e[36]=s("div",{class:"dialog-icon"},[s("span",{class:"material-symbols-rounded"},"warning")],-1)),s("div",oe,[s("h3",ae,r(v.value.title),1),s("p",ne,r(v.value.message),1)]),s("div",le,[s("button",{class:"m3-button text",onClick:e[2]||(e[2]=t=>v.value.show=!1)},"取消"),s("button",{class:"m3-button text",onClick:e[3]||(e[3]=(...t)=>v.value.onConfirm&&v.value.onConfirm(...t))},"确认")])])])):u("",!0)]),_:1})]))}}),ue=q(re,[["__scopeId","data-v-1349eeb5"]]);export{ue as default};
