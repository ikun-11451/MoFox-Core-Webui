import{a as Ne,r as u,p as Se,P as Pe,I as ge,ab as g,L as le,c as a,e as s,m as Y,g as m,F as k,h as $,t as d,n as h,Y as y,Z as f,a0 as Le,x as P,f as L,w as O,T as q,N as V,O as Z,o as l,_ as Oe}from"./index-BiUNSFIs.js";const qe={class:"chatroom-view"},Be={class:"user-panel m3-card"},je={class:"panel-header"},ze={class:"user-list"},Ee=["onClick"],Re={class:"user-avatar"},Fe=["src","alt"],Je={key:1,class:"material-symbols-rounded"},Ke={class:"user-info"},He={class:"user-name"},Qe={class:"user-id"},Ae=["onClick"],Ye={key:0,class:"empty-state"},Ze={class:"chat-panel m3-card"},Ge={class:"chat-header"},We={key:0,class:"header-content"},Xe={class:"user-avatar"},es=["src","alt"],ss={key:1,class:"material-symbols-rounded"},ts={class:"user-info"},os={key:0},ls={key:1,class:"header-placeholder"},as={class:"header-actions"},ns={key:0,class:"welcome-state"},is={key:1,class:"loading-state"},rs={key:2,class:"messages-list"},us={class:"banner-content"},ds={class:"banner-text"},cs={class:"message-avatar"},ms={class:"material-symbols-rounded"},vs={class:"message-content"},ps={class:"message-header"},ys={class:"message-sender"},fs={class:"message-time"},_s={key:0,class:"message-quote"},gs={class:"quote-content"},bs={class:"quote-author"},ks={class:"quote-text"},hs={key:1,class:"message-text"},ws={key:2,class:"message-emojis"},Cs=["src"],xs={key:0,class:"empty-messages"},Us={class:"input-area"},$s={class:"input-container"},Vs=["disabled","onKeydown"],Ds=["disabled"],Ts={class:"material-symbols-rounded"},Ms={class:"m3-dialog"},Is={class:"dialog-header"},Ns={class:"dialog-content"},Ss={class:"copy-user-section"},Ps={class:"input-row"},Ls={class:"input-group half"},Os={key:0,class:"custom-select-dropdown"},qs={key:0,class:"material-symbols-rounded check-icon"},Bs=["onClick"],js={key:0,class:"material-symbols-rounded check-icon"},zs={class:"input-group half"},Es={key:0,class:"custom-select-dropdown"},Rs={key:0,class:"material-symbols-rounded check-icon"},Fs=["onClick"],Js={key:0,class:"material-symbols-rounded check-icon"},Ks={class:"input-group"},Hs={class:"input-with-action"},Qs={class:"input-group"},As={class:"input-group"},Ys={class:"input-group"},Zs={class:"input-group"},Gs={class:"label-row"},Ws={class:"memory-points-list"},Xs={class:"point-header"},et={class:"point-label"},st=["onClick"],tt={class:"point-content"},ot=["onUpdate:modelValue"],lt={class:"point-weight"},at=["onUpdate:modelValue"],nt={key:0,class:"empty-points"},it={class:"input-group"},rt={class:"input-group"},ut={class:"dialog-actions"},dt=["disabled"],ct={class:"m3-dialog"},mt={class:"dialog-header"},vt={class:"dialog-content"},pt={class:"input-group"},yt={class:"input-group"},ft={class:"input-group"},_t={class:"input-group"},gt={class:"label-row"},bt={class:"memory-points-list"},kt={class:"point-header"},ht={class:"point-label"},wt=["onClick"],Ct={class:"point-content"},xt=["onUpdate:modelValue"],Ut={class:"point-weight"},$t=["onUpdate:modelValue"],Vt={key:0,class:"empty-points"},Dt={class:"input-group"},Tt={class:"input-group"},Mt={class:"dialog-actions"},It=["disabled"],Nt={class:"m3-dialog small"},St={class:"dialog-header"},Pt={class:"dialog-content"},Lt={class:"dialog-actions"},Ot=["disabled"],qt={class:"m3-dialog small"},Bt={class:"dialog-header"},jt={class:"dialog-content"},zt={class:"dialog-actions"},Et=["disabled"],Rt=1e3,Ft=Ne({__name:"ChatroomView",setup(Jt){const z=u([]),r=u(null),w=u([]),D=u(""),G=u(!1),T=u(!1),W=u(!1);let B=null;const X=u(new Map),C=u(!1),M=u(!1),I=u(!1),N=u(!1),S=u(null),E=u([]),R=u([]),ae=u([]),b=u(""),_=u(null),x=u(!1),U=u(!1),n=u({user_id:"",nickname:"",impression:"",short_impression:"",avatar:"",attitude:null,memory_points:[]}),v=u({nickname:"",impression:"",short_impression:"",avatar:"",attitude:null,memory_points:[]}),F=u(!1),J=u(!1),K=u(!1),H=u(!1),Q=u(null),ee=u(null);Se(async()=>{await j(),me(),window.addEventListener("click",ue)}),Pe(()=>{A(),window.removeEventListener("click",ue)}),ge(r,async(o,e)=>{o?(await se(),(e==null?void 0:e.user_id)!==o.user_id&&(A(),me())):(w.value=[],A())}),ge(C,o=>{o&&(Ue(),de(),b.value="",_.value=null)});async function j(){try{const o=await g.get("chatroom/users");o.success&&o.data?z.value=o.data.users||[]:c("加载用户列表失败: "+(o.error||"未知错误"),"error")}catch(o){console.error("加载用户列表失败:",o),c("加载用户列表失败","error")}}async function se(){if(r.value){G.value=!0;try{const o=await g.get("chatroom/messages?limit=100");if(o.success&&o.data){w.value=o.data.messages||[];for(const e of w.value)e.reply_to&&await pe(e.reply_to);await le(),te()}else c("加载消息失败: "+(o.error||"未知错误"),"error")}catch(o){console.error("加载消息失败:",o),c("加载消息失败","error")}finally{G.value=!1}}}function be(o){r.value=o,v.value={nickname:o.nickname,impression:o.impression,short_impression:o.short_impression||"",avatar:o.avatar,attitude:o.attitude??null,memory_points:o.memory_points?JSON.parse(JSON.stringify(o.memory_points)):[]}}async function ke(){if(!n.value.user_id||!n.value.nickname){c("请填写必填字段","error");return}if(!/^\d+$/.test(n.value.user_id)){c("用户ID只能包含数字","error");return}n.value.memory_points=n.value.memory_points.filter(o=>o.content.trim()),F.value=!0;try{const o=await g.post("chatroom/users",n.value);o.success?(c("创建用户成功","success"),C.value=!1,n.value={user_id:"",nickname:"",impression:"",short_impression:"",avatar:"",attitude:null,memory_points:[]},await j()):c(o.error||"创建用户失败","error")}catch(o){console.error("创建用户失败:",o),c(o.message||"创建用户失败","error")}finally{F.value=!1}}async function he(){var o;if(r.value){v.value.memory_points=v.value.memory_points.filter(e=>e.content.trim()),J.value=!0;try{const e=await g.put(`chatroom/users/${r.value.user_id}`,v.value);e.success?(c("更新用户成功","success"),M.value=!1,await j(),(o=e.data)!=null&&o.user&&(r.value=e.data.user)):c(e.error||"更新用户失败","error")}catch(e){console.error("更新用户失败:",e),c(e.message||"更新用户失败","error")}finally{J.value=!1}}}function we(o){S.value=o,I.value=!0}async function Ce(){var o;if(S.value){K.value=!0;try{const e=await g.delete(`chatroom/users/${S.value.user_id}`);e.success?(c("删除用户成功","success"),I.value=!1,((o=r.value)==null?void 0:o.user_id)===S.value.user_id&&(r.value=null),S.value=null,await j()):c(e.error||"删除用户失败","error")}catch(e){console.error("删除用户失败:",e),c(e.message||"删除用户失败","error")}finally{K.value=!1}}}async function xe(){if(r.value){H.value=!0;try{const o=await g.post(`chatroom/users/${r.value.user_id}/reset`);if(o.success){c("用户关系已重置","success"),N.value=!1,await se(),await j();const e=z.value.find(t=>{var i;return t.user_id===((i=r.value)==null?void 0:i.user_id)});e&&(r.value=e)}else c(o.error||"重置失败","error")}catch(o){console.error("重置用户失败:",o),c(o.message||"重置失败","error")}finally{H.value=!1}}}async function Ue(){try{const o=await g.get("chatroom/copyable_users");if(o.success&&o.data){E.value=o.data.users||[];const e=new Set(E.value.map(t=>t.platform));ae.value=Array.from(e).sort(),ne()}}catch(o){console.error("加载可复制用户失败:",o)}}function ne(){b.value?R.value=E.value.filter(o=>o.platform===b.value):R.value=E.value,_.value&&!R.value.find(o=>{var e;return o.person_id===((e=_.value)==null?void 0:e.person_id)})&&(_.value=null)}function $e(o){o.stopPropagation(),x.value=!x.value,U.value=!1}function ie(o){b.value=o,ne(),x.value=!1}function Ve(o){o.stopPropagation(),U.value=!U.value,x.value=!1}function re(o){_.value=o,De(),U.value=!1}function ue(o){o.target.closest(".custom-select-container")||(x.value=!1,U.value=!1)}function De(){if(_.value){const o=_.value;n.value.nickname=o.nickname,n.value.impression=o.impression||"",n.value.short_impression=o.short_impression||"",n.value.attitude=o.attitude,n.value.memory_points=o.memory_points?JSON.parse(JSON.stringify(o.memory_points)):[]}}function de(){const o=Math.floor(Math.random()*9e5+1e5).toString();n.value.user_id=o}async function ce(){if(!(!D.value.trim()||!r.value||T.value)){T.value=!0;try{const o=await g.post("chatroom/send",{user_id:r.value.user_id,content:D.value.trim(),message_type:"text"});o.success&&o.data?(o.data.request_message&&w.value.push(o.data.request_message),D.value="",ee.value&&(ee.value.style.height="auto"),await le(),te()):c(o.error||"发送消息失败","error")}catch(o){console.error("发送消息失败:",o),c(o.message||"发送消息失败","error")}finally{T.value=!1}}}function Te(o){const e=o.target;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}function te(){Q.value&&(Q.value.scrollTop=Q.value.scrollHeight)}function me(){!B&&r.value&&(ve(),B=window.setInterval(ve,Rt))}function A(){B&&(clearInterval(B),B=null)}async function ve(){var o;if(!r.value){A();return}try{const e=await g.get("chatroom/poll");if(e.success&&((o=e.data)!=null&&o.messages)&&e.data.messages.length>0){for(const t of e.data.messages)w.value.find(i=>i.message_id===t.message_id)||(w.value.push(t),t.reply_to&&await pe(t.reply_to));await le(),te()}}catch(e){console.error("轮询消息失败:",e)}}async function pe(o){var e;if(!X.value.has(o))try{const t=await g.get(`chatroom/messages/${o}`);t.success&&((e=t.data)!=null&&e.message)&&X.value.set(o,t.data.message)}catch(t){console.error("加载引用消息失败:",t)}}function oe(o){return X.value.get(o)||null}function Me(o){const e=new Date(o*1e3),t=new Date,i=t.getTime()-e.getTime();return i<864e5&&e.getDate()===t.getDate()?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):i<1728e5&&e.getDate()===t.getDate()-1?"昨天 "+e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function ye(o){o.push({content:"",weight:1})}function fe(o,e){o.splice(e,1)}function c(o,e="success"){const t=document.createElement("div");t.className=`toast toast-${e}`,t.textContent=o,t.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    background: ${e==="success"?"var(--md-sys-color-primary)":"var(--md-sys-color-error)"};
    color: ${e==="success"?"var(--md-sys-color-on-primary)":"var(--md-sys-color-on-error)"};
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    animation: slideIn 0.3s ease;
  `,document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideOut 0.3s ease",setTimeout(()=>{document.body.removeChild(t)},300)},3e3)}return(o,e)=>(l(),a("div",qe,[s("aside",Be,[s("div",je,[e[35]||(e[35]=s("div",{class:"header-content"},[s("span",{class:"material-symbols-rounded"},"people"),s("h2",null,"虚拟用户")],-1)),s("button",{class:"m3-button icon-only",onClick:e[0]||(e[0]=t=>C.value=!0),title:"创建用户"},[...e[34]||(e[34]=[s("span",{class:"material-symbols-rounded"},"person_add",-1)])])]),s("div",ze,[(l(!0),a(k,null,$(z.value,t=>{var i;return l(),a("div",{key:t.user_id,class:h(["user-item",{active:((i=r.value)==null?void 0:i.user_id)===t.user_id}]),onClick:p=>be(t)},[s("div",Re,[t.avatar?(l(),a("img",{key:0,src:t.avatar,alt:t.nickname},null,8,Fe)):(l(),a("span",Je,"account_circle"))]),s("div",Ke,[s("div",He,d(t.nickname),1),s("div",Qe,d(t.user_id),1)]),s("button",{class:"m3-icon-button delete-btn",onClick:P(p=>we(t),["stop"]),title:"删除用户"},[...e[36]||(e[36]=[s("span",{class:"material-symbols-rounded"},"delete",-1)])],8,Ae)],10,Ee)}),128)),z.value.length===0?(l(),a("div",Ye,[e[37]||(e[37]=s("span",{class:"material-symbols-rounded"},"group_off",-1)),e[38]||(e[38]=s("p",null,"暂无虚拟用户",-1)),s("button",{class:"m3-button filled",onClick:e[1]||(e[1]=t=>C.value=!0)}," 创建第一个用户 ")])):m("",!0)])]),s("main",Ze,[s("header",Ge,[r.value?(l(),a("div",We,[s("div",Xe,[r.value.avatar?(l(),a("img",{key:0,src:r.value.avatar,alt:r.value.nickname},null,8,es)):(l(),a("span",ss,"account_circle"))]),s("div",ts,[s("h2",null,d(r.value.nickname),1),r.value.impression?(l(),a("p",os,d(r.value.impression),1)):m("",!0)])])):(l(),a("div",ls,[...e[39]||(e[39]=[s("span",{class:"material-symbols-rounded"},"chat",-1),s("span",null,"UI 聊天室",-1)])])),s("div",as,[r.value?(l(),a("button",{key:0,class:"m3-button icon-only",onClick:e[2]||(e[2]=t=>N.value=!0),title:"重置关系"},[...e[40]||(e[40]=[s("span",{class:"material-symbols-rounded"},"restart_alt",-1)])])):m("",!0),r.value?(l(),a("button",{key:1,class:"m3-button icon-only",onClick:e[3]||(e[3]=t=>M.value=!0),title:"编辑用户"},[...e[41]||(e[41]=[s("span",{class:"material-symbols-rounded"},"edit",-1)])])):m("",!0),s("button",{class:"m3-button icon-only",onClick:se,title:"刷新消息"},[...e[42]||(e[42]=[s("span",{class:"material-symbols-rounded"},"refresh",-1)])])])]),s("div",{class:"messages-container",ref_key:"messagesContainer",ref:Q},[r.value?G.value?(l(),a("div",is,[...e[44]||(e[44]=[s("div",{class:"spinner"},null,-1),s("p",null,"加载消息中...",-1)])])):(l(),a("div",rs,[(l(!0),a(k,null,$(w.value,t=>{var i,p;return l(),a("div",{key:t.message_id,class:h({message:t.user_id!=="system","system-banner":t.user_id==="system","is-bot":t.user_id==="mofox_bot","is-user":t.user_id!=="mofox_bot"&&t.user_id!=="system"})},[t.user_id==="system"?(l(),a(k,{key:0},[e[45]||(e[45]=s("div",{class:"banner-icon"},[s("span",{class:"material-symbols-rounded"},"info")],-1)),s("div",us,[s("span",ds,d(t.content),1)])],64)):(l(),a(k,{key:1},[s("div",cs,[s("span",ms,d(t.user_id==="mofox_bot"?"smart_toy":"account_circle"),1)]),s("div",vs,[s("div",ps,[s("span",ys,d(t.nickname),1),s("span",fs,d(Me(t.timestamp)),1)]),t.reply_to&&oe(t.reply_to)?(l(),a("div",_s,[e[46]||(e[46]=s("div",{class:"quote-line"},null,-1)),s("div",gs,[s("span",bs,d((i=oe(t.reply_to))==null?void 0:i.nickname),1),s("span",ks,d((p=oe(t.reply_to))==null?void 0:p.content),1)])])):m("",!0),t.content?(l(),a("div",hs,d(t.content),1)):m("",!0),t.emojis&&t.emojis.length>0?(l(),a("div",ws,[(l(!0),a(k,null,$(t.emojis,(_e,Ie)=>(l(),a("img",{key:Ie,src:`data:image/png;base64,${_e}`,class:"emoji-image",alt:"emoji"},null,8,Cs))),128))])):m("",!0)])],64))],2)}),128)),w.value.length===0?(l(),a("div",xs,[...e[47]||(e[47]=[s("span",{class:"material-symbols-rounded"},"chat_bubble_outline",-1),s("p",null,"还没有消息，发送第一条消息开始对话吧！",-1)])])):m("",!0)])):(l(),a("div",ns,[...e[43]||(e[43]=[s("span",{class:"material-symbols-rounded"},"forum",-1),s("h3",null,"欢迎使用 UI 聊天室",-1),s("p",null,"选择一个虚拟用户开始对话",-1)])]))],512),s("footer",Us,[s("div",$s,[s("div",{class:h(["input-wrapper",{focused:W.value}])},[y(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),class:"message-input",placeholder:"输入消息...",rows:"1",disabled:!r.value||T.value,onKeydown:Le(P(ce,["exact","prevent"]),["enter"]),onInput:Te,onFocus:e[5]||(e[5]=t=>W.value=!0),onBlur:e[6]||(e[6]=t=>W.value=!1),ref_key:"messageInput",ref:ee},null,40,Vs),[[f,D.value]])],2),s("button",{class:"m3-button fab",disabled:!D.value.trim()||!r.value||T.value,onClick:ce,title:"发送 (Enter)"},[s("span",Ts,d(T.value?"hourglass_empty":"send"),1)],8,Ds)])])]),(l(),Y(Z,{to:"body"},[L(q,{name:"dialog"},{default:O(()=>[C.value?(l(),a("div",{key:0,class:"dialog-overlay",onClick:e[18]||(e[18]=P(t=>C.value=!1,["self"]))},[s("div",Ms,[s("div",Is,[e[49]||(e[49]=s("h3",null,"创建虚拟用户",-1)),s("button",{class:"m3-icon-button",onClick:e[7]||(e[7]=t=>C.value=!1)},[...e[48]||(e[48]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",Ns,[s("div",Ss,[e[56]||(e[56]=s("div",{class:"section-title"},"从现有用户复制",-1)),s("div",Ps,[s("div",Ls,[e[52]||(e[52]=s("label",null,"平台",-1)),s("div",{class:h(["custom-select-container",{"is-open":x.value}])},[s("div",{class:"custom-select-trigger",onClick:$e},[s("span",null,d(b.value||"全部平台"),1),e[50]||(e[50]=s("span",{class:"material-symbols-rounded select-arrow"},"expand_more",-1))]),L(q,{name:"select-fade"},{default:O(()=>[x.value?(l(),a("div",Os,[s("div",{class:h(["custom-select-option",{"is-selected":b.value===""}]),onClick:e[8]||(e[8]=t=>ie(""))},[e[51]||(e[51]=V(" 全部平台 ",-1)),b.value===""?(l(),a("span",qs,"check")):m("",!0)],2),(l(!0),a(k,null,$(ae.value,t=>(l(),a("div",{key:t,class:h(["custom-select-option",{"is-selected":b.value===t}]),onClick:i=>ie(t)},[V(d(t)+" ",1),b.value===t?(l(),a("span",js,"check")):m("",!0)],10,Bs))),128))])):m("",!0)]),_:1})],2)]),s("div",zs,[e[55]||(e[55]=s("label",null,"选择用户",-1)),s("div",{class:h(["custom-select-container",{"is-open":U.value}])},[s("div",{class:"custom-select-trigger",onClick:Ve},[s("span",null,d(_.value?`${_.value.nickname} (${_.value.platform})`:"不复制"),1),e[53]||(e[53]=s("span",{class:"material-symbols-rounded select-arrow"},"expand_more",-1))]),L(q,{name:"select-fade"},{default:O(()=>[U.value?(l(),a("div",Es,[s("div",{class:h(["custom-select-option",{"is-selected":_.value===null}]),onClick:e[9]||(e[9]=t=>re(null))},[e[54]||(e[54]=V(" 不复制 ",-1)),_.value===null?(l(),a("span",Rs,"check")):m("",!0)],2),(l(!0),a(k,null,$(R.value,t=>{var i,p;return l(),a("div",{key:t.person_id,class:h(["custom-select-option",{"is-selected":((i=_.value)==null?void 0:i.person_id)===t.person_id}]),onClick:_e=>re(t)},[V(d(t.nickname)+" ("+d(t.platform)+") ",1),((p=_.value)==null?void 0:p.person_id)===t.person_id?(l(),a("span",Js,"check")):m("",!0)],10,Fs)}),128))])):m("",!0)]),_:1})],2)])])]),e[67]||(e[67]=s("div",{class:"divider"},null,-1)),s("div",Ks,[e[58]||(e[58]=s("label",null,[V("用户ID * "),s("span",{class:"hint"},"(仅限数字)")],-1)),s("div",Hs,[y(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.user_id=t),type:"text",class:"m3-input",placeholder:"例如: 10001",pattern:"[0-9]+"},null,512),[[f,n.value.user_id]]),s("button",{class:"m3-icon-button",onClick:de,title:"随机生成"},[...e[57]||(e[57]=[s("span",{class:"material-symbols-rounded"},"refresh",-1)])])])]),s("div",Qs,[e[59]||(e[59]=s("label",null,"昵称 *",-1)),y(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.nickname=t),type:"text",class:"m3-input",placeholder:"例如: 小明"},null,512),[[f,n.value.nickname]])]),s("div",As,[e[60]||(e[60]=s("label",null,"详细印象/性格描述",-1)),y(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.impression=t),class:"m3-input",rows:"3",placeholder:"例如: 活泼开朗，喜欢聊天，经常分享生活趣事..."},null,512),[[f,n.value.impression]])]),s("div",Ys,[e[61]||(e[61]=s("label",null,"简短印象",-1)),y(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.short_impression=t),type:"text",class:"m3-input",placeholder:"例如: 活泼开朗"},null,512),[[f,n.value.short_impression]])]),s("div",Zs,[s("div",Gs,[e[63]||(e[63]=s("label",null,"记忆点",-1)),s("button",{class:"m3-button text small",onClick:e[14]||(e[14]=t=>ye(n.value.memory_points))},[...e[62]||(e[62]=[s("span",{class:"material-symbols-rounded"},"add",-1),V(" 添加 ",-1)])])]),s("div",Ws,[(l(!0),a(k,null,$(n.value.memory_points,(t,i)=>(l(),a("div",{key:i,class:"memory-point-item"},[s("div",Xs,[s("span",et,"记忆点 #"+d(i+1),1),s("button",{class:"m3-icon-button small",onClick:p=>fe(n.value.memory_points,i)},[...e[64]||(e[64]=[s("span",{class:"material-symbols-rounded"},"delete",-1)])],8,st)]),s("div",tt,[y(s("textarea",{"onUpdate:modelValue":p=>t.content=p,class:"m3-input",rows:"2",placeholder:"输入记忆内容..."},null,8,ot),[[f,t.content]])]),s("div",lt,[s("label",null,"重要度: "+d(t.weight),1),y(s("input",{"onUpdate:modelValue":p=>t.weight=p,type:"range",min:"0.1",max:"2.0",step:"0.1",class:"m3-slider"},null,8,at),[[f,t.weight,void 0,{number:!0}]])])]))),128)),n.value.memory_points.length===0?(l(),a("div",nt," 暂无记忆点 ")):m("",!0)])]),s("div",it,[e[65]||(e[65]=s("label",null,"态度值 (-100 到 100)",-1)),y(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.attitude=t),type:"number",class:"m3-input",min:"-100",max:"100",placeholder:"0"},null,512),[[f,n.value.attitude,void 0,{number:!0}]])]),s("div",rt,[e[66]||(e[66]=s("label",null,"头像URL (可选)",-1)),y(s("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>n.value.avatar=t),type:"text",class:"m3-input",placeholder:"https://..."},null,512),[[f,n.value.avatar]])])]),s("div",ut,[s("button",{class:"m3-button text",onClick:e[17]||(e[17]=t=>C.value=!1)},"取消"),s("button",{class:"m3-button filled",disabled:!n.value.user_id||!n.value.nickname||F.value,onClick:ke},d(F.value?"创建中...":"创建"),9,dt)])])])):m("",!0)]),_:1})])),(l(),Y(Z,{to:"body"},[L(q,{name:"dialog"},{default:O(()=>[M.value?(l(),a("div",{key:0,class:"dialog-overlay",onClick:e[27]||(e[27]=P(t=>M.value=!1,["self"]))},[s("div",ct,[s("div",mt,[e[69]||(e[69]=s("h3",null,"编辑用户",-1)),s("button",{class:"m3-icon-button",onClick:e[19]||(e[19]=t=>M.value=!1)},[...e[68]||(e[68]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",vt,[s("div",pt,[e[70]||(e[70]=s("label",null,"昵称",-1)),y(s("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>v.value.nickname=t),type:"text",class:"m3-input"},null,512),[[f,v.value.nickname]])]),s("div",yt,[e[71]||(e[71]=s("label",null,"详细印象/性格描述",-1)),y(s("textarea",{"onUpdate:modelValue":e[21]||(e[21]=t=>v.value.impression=t),class:"m3-input",rows:"3",placeholder:"详细描述用户的印象和性格特点..."},null,512),[[f,v.value.impression]])]),s("div",ft,[e[72]||(e[72]=s("label",null,"简短印象",-1)),y(s("input",{"onUpdate:modelValue":e[22]||(e[22]=t=>v.value.short_impression=t),type:"text",class:"m3-input",placeholder:"用简短词语概括"},null,512),[[f,v.value.short_impression]])]),s("div",_t,[s("div",gt,[e[74]||(e[74]=s("label",null,"记忆点",-1)),s("button",{class:"m3-button text small",onClick:e[23]||(e[23]=t=>ye(v.value.memory_points))},[...e[73]||(e[73]=[s("span",{class:"material-symbols-rounded"},"add",-1),V(" 添加 ",-1)])])]),s("div",bt,[(l(!0),a(k,null,$(v.value.memory_points,(t,i)=>(l(),a("div",{key:i,class:"memory-point-item"},[s("div",kt,[s("span",ht,"记忆点 #"+d(i+1),1),s("button",{class:"m3-icon-button small",onClick:p=>fe(v.value.memory_points,i)},[...e[75]||(e[75]=[s("span",{class:"material-symbols-rounded"},"delete",-1)])],8,wt)]),s("div",Ct,[y(s("textarea",{"onUpdate:modelValue":p=>t.content=p,class:"m3-input",rows:"2",placeholder:"输入记忆内容..."},null,8,xt),[[f,t.content]])]),s("div",Ut,[s("label",null,"重要度: "+d(t.weight),1),y(s("input",{"onUpdate:modelValue":p=>t.weight=p,type:"range",min:"0.1",max:"2.0",step:"0.1",class:"m3-slider"},null,8,$t),[[f,t.weight,void 0,{number:!0}]])])]))),128)),v.value.memory_points.length===0?(l(),a("div",Vt," 暂无记忆点 ")):m("",!0)])]),s("div",Dt,[e[76]||(e[76]=s("label",null,"态度值 (-100 到 100)",-1)),y(s("input",{"onUpdate:modelValue":e[24]||(e[24]=t=>v.value.attitude=t),type:"number",class:"m3-input",min:"-100",max:"100",placeholder:"数值化的态度评分"},null,512),[[f,v.value.attitude,void 0,{number:!0}]])]),s("div",Tt,[e[77]||(e[77]=s("label",null,"头像URL",-1)),y(s("input",{"onUpdate:modelValue":e[25]||(e[25]=t=>v.value.avatar=t),type:"text",class:"m3-input",placeholder:"https://..."},null,512),[[f,v.value.avatar]])])]),s("div",Mt,[s("button",{class:"m3-button text",onClick:e[26]||(e[26]=t=>M.value=!1)},"取消"),s("button",{class:"m3-button filled",disabled:J.value,onClick:he},d(J.value?"保存中...":"保存"),9,It)])])])):m("",!0)]),_:1})])),(l(),Y(Z,{to:"body"},[L(q,{name:"dialog"},{default:O(()=>{var t;return[I.value?(l(),a("div",{key:0,class:"dialog-overlay",onClick:e[30]||(e[30]=P(i=>I.value=!1,["self"]))},[s("div",Nt,[s("div",St,[e[79]||(e[79]=s("h3",null,"确认删除",-1)),s("button",{class:"m3-icon-button",onClick:e[28]||(e[28]=i=>I.value=!1)},[...e[78]||(e[78]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",Pt,[s("p",null,'确定要删除用户 "'+d((t=S.value)==null?void 0:t.nickname)+'" 吗？',1),e[80]||(e[80]=s("p",{class:"warning-text"},"此操作不可撤销",-1))]),s("div",Lt,[s("button",{class:"m3-button text",onClick:e[29]||(e[29]=i=>I.value=!1)},"取消"),s("button",{class:"m3-button filled error",disabled:K.value,onClick:Ce},d(K.value?"删除中...":"删除"),9,Ot)])])])):m("",!0)]}),_:1})])),(l(),Y(Z,{to:"body"},[L(q,{name:"dialog"},{default:O(()=>{var t;return[N.value?(l(),a("div",{key:0,class:"dialog-overlay",onClick:e[33]||(e[33]=P(i=>N.value=!1,["self"]))},[s("div",qt,[s("div",Bt,[e[82]||(e[82]=s("h3",null,"确认重置",-1)),s("button",{class:"m3-icon-button",onClick:e[31]||(e[31]=i=>N.value=!1)},[...e[81]||(e[81]=[s("span",{class:"material-symbols-rounded"},"close",-1)])])]),s("div",jt,[s("p",null,'确定要重置与用户 "'+d((t=r.value)==null?void 0:t.nickname)+'" 的关系吗？',1),e[83]||(e[83]=s("p",{class:"warning-text"},"这将清除 Bot 对该用户的记忆和关系进展，恢复到初始设定。",-1))]),s("div",zt,[s("button",{class:"m3-button text",onClick:e[32]||(e[32]=i=>N.value=!1)},"取消"),s("button",{class:"m3-button filled error",disabled:H.value,onClick:xe},d(H.value?"重置中...":"重置"),9,Et)])])])):m("",!0)]}),_:1})]))]))}}),Ht=Oe(Ft,[["__scopeId","data-v-22328ebb"]]);export{Ht as default};
