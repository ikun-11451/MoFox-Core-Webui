import{d as Y,al as J,z as y,c as E,o as Q,l as t,q as s,m as d,j,r,v as a,F as D,D as x,k as W,B as F,T as X,am as Z,ah as ss,y as l,_ as es}from"./index-qdINuU9g.js";import{u as os}from"./plugin-DeThDYYX.js";const ns={class:"plugin-detail-view"},ts={class:"page-header"},ls={key:0,class:"header-info"},as={class:"header-actions"},is={key:0,class:"system-plugin-badge"},cs={key:1,class:"m3-switch-container"},ds={class:"m3-switch"},us=["checked","disabled"],rs={class:"switch-label"},vs={key:0,class:"loading-state"},ms={key:1,class:"error-state"},fs={key:2,class:"detail-content"},_s={class:"m3-tabs"},ps=["onClick"],gs={class:"material-symbols-rounded"},bs={class:"tab-content"},ys={key:0,class:"tab-pane"},hs={class:"m3-card info-section"},ks={class:"info-grid"},ws={class:"info-item"},Cs={class:"info-value"},Ps={class:"info-item"},Ds={class:"info-value"},xs={class:"info-item"},As={class:"info-value"},Ts={class:"info-item"},$s={class:"info-value"},Ns={class:"info-item"},Ss={class:"info-value"},Vs={key:0,class:"m3-badge success"},Bs={key:1,class:"m3-badge secondary"},Es={key:2,class:"m3-badge primary"},js={key:3,class:"m3-badge secondary"},Fs={class:"info-item"},Ls={class:"info-value"},Rs={class:"m3-card info-section"},Is={class:"description"},zs={key:0,class:"m3-card info-section"},Ms={class:"info-grid"},Us={class:"info-label"},qs={class:"info-value"},Gs={key:1,class:"tab-pane"},Hs={key:0,class:"empty-state"},Ks={key:1,class:"components-list"},Os={class:"component-header"},Ys={class:"component-icon"},Js={class:"material-symbols-rounded"},Qs={class:"component-info"},Ws={class:"component-type"},Xs={class:"component-actions"},Zs={key:0,class:"m3-switch-container"},se={class:"m3-switch"},ee=["id","checked","onChange"],oe={class:"switch-label"},ne={key:1,class:"component-locked"},te={key:0,class:"component-description"},le={key:2,class:"tab-pane"},ae={class:"m3-card info-section"},ie={class:"config-info"},ce={class:"info-item"},de={class:"info-value code"},ue={class:"info-item"},re={class:"info-value"},ve={key:0,class:"m3-badge success"},me={key:1,class:"m3-badge error"},fe={key:1,class:"config-not-found"},_e={class:"material-symbols-rounded"},pe=Y({__name:"PluginDetailView",setup(ge){const A=ss(),L=J(),u=os(),c=L.params.pluginName,R=[{label:"概览",value:"overview",icon:"info"},{label:"组件",value:"components",icon:"extension"},{label:"配置",value:"config",icon:"settings"}],b=y("overview"),C=y(!1),h=y(""),_=y({show:!1,message:"",type:"success"}),m=y({show:!1,title:"",message:"",onConfirm:()=>{}}),n=E(()=>u.currentPlugin),T=E(()=>u.currentComponents),I=["Affinity Flow Chatter","Kokoro Flow Chatter","napcat_adapter_plugin","Emoji插件 (Emoji Actions)"];function f(o){return o?I.includes(o.display_name):!1}function v(o,e="success"){_.value={show:!0,message:o,type:e},setTimeout(()=>{_.value.show=!1},3e3)}function k(o,e,w){m.value={show:!0,title:o,message:e,onConfirm:()=>{w(),m.value.show=!1}}}async function p(){console.log("[PluginDetail] 开始加载插件详情:",c),C.value=!0,h.value="";const o=await u.fetchPluginDetail(c);console.log("[PluginDetail] 插件详情加载结果:",o),!o&&u.error&&(h.value=u.error),C.value=!1}async function z(){if(n.value)if(console.log("[PluginDetail] 切换插件状态:",n.value.enabled?"禁用":"启用"),n.value.enabled){const o=await u.disablePluginAction(c);v(o.success?"插件已禁用":o.error||"操作失败",o.success?"success":"error")}else{const o=await u.enablePluginAction(c);v(o.success?"插件已启用":o.error||"操作失败",o.success?"success":"error")}}async function M(){k("加载插件",`确定要加载插件 "${c}" 吗？`,async()=>{const o=await u.loadPluginAction(c);v(o.success?"插件加载成功":o.error||"加载失败",o.success?"success":"error"),o.success&&await p()})}async function U(){k("重载插件",`确定要重载插件 "${c}" 吗？`,async()=>{const o=await u.reloadPluginAction(c);v(o.success?"插件重载成功":o.error||"重载失败",o.success?"success":"error"),o.success&&await p()})}async function q(){k("卸载插件",`确定要卸载插件 "${c}" 吗？卸载后需要重新加载才能使用。`,async()=>{const o=await u.unloadPluginAction(c);v(o.success?"插件已卸载":o.error||"卸载失败",o.success?"success":"error"),o.success&&P()})}async function G(){k("删除插件",`确定要删除插件 "${c}" 吗？此操作将删除插件的所有文件，且无法撤销！`,async()=>{const o=await u.deletePluginAction(c);v(o.success?"插件已删除":o.error||"删除失败",o.success?"success":"error"),o.success&&P()})}async function H(o){if(console.log("[PluginDetail] 切换组件状态:",o.name,o.type,o.enabled?"禁用":"启用"),o.enabled){const e=await u.disableComponentAction(c,o.name,o.type);v(e.success?"组件已禁用":e.error||"操作失败",e.success?"success":"error"),e.success&&await p()}else{const e=await u.enableComponentAction(c,o.name,o.type);v(e.success?"组件已启用":e.error||"操作失败",e.success?"success":"error"),e.success&&await p()}}function K(o){return{Command:"terminal",Action:"bolt",EventHandler:"sensors",Router:"alt_route",Tool:"build",Prompt:"chat"}[o]||"extension"}function P(){A.push("/dashboard/plugin-manage")}function O(){var o;if((o=n.value)!=null&&o.name){const e=`plugins/${n.value.name}/config.toml`;console.log("[PluginDetail] 跳转到配置编辑器:",e),A.push({name:"PluginConfigView",params:{path:e}})}else console.warn("[PluginDetail] 配置文件路径不存在"),v("配置文件路径不存在","error")}return Q(()=>{p()}),(o,e)=>{var w,$,N,S,V,B;return l(),t("div",ns,[s("header",ts,[s("button",{class:"m3-button text",onClick:P},[...e[1]||(e[1]=[s("span",{class:"material-symbols-rounded"},"arrow_back",-1),r(" 返回 ",-1)])]),n.value?(l(),t("div",ls,[s("h1",null,a(n.value.display_name),1),s("p",null,"v"+a(n.value.version)+" • "+a(n.value.author),1)])):d("",!0),s("div",as,[f(n.value)?(l(),t("div",is,[...e[2]||(e[2]=[s("span",{class:"material-symbols-rounded"},"lock",-1),s("span",null,"系统插件 - 仅可查看",-1)])])):d("",!0),f(n.value)?d("",!0):(l(),t("div",cs,[s("label",ds,[s("input",{type:"checkbox",id:"plugin-enable-toggle",checked:(w=n.value)==null?void 0:w.enabled,onChange:z,disabled:!(($=n.value)!=null&&$.loaded)},null,40,us),e[3]||(e[3]=s("span",{class:"slider"},null,-1))]),s("span",rs,a((N=n.value)!=null&&N.enabled?"已启用":"已禁用"),1)])),!((S=n.value)!=null&&S.loaded)&&!f(n.value)?(l(),t("button",{key:2,class:"m3-button filled",onClick:M},[...e[4]||(e[4]=[s("span",{class:"material-symbols-rounded"},"download",-1),r(" 加载 ",-1)])])):d("",!0),(V=n.value)!=null&&V.loaded&&!f(n.value)?(l(),t("button",{key:3,class:"m3-button tonal",onClick:U},[...e[5]||(e[5]=[s("span",{class:"material-symbols-rounded"},"refresh",-1),r(" 重载 ",-1)])])):d("",!0),(B=n.value)!=null&&B.loaded&&!f(n.value)?(l(),t("button",{key:4,class:"m3-button tonal error",onClick:q},[...e[6]||(e[6]=[s("span",{class:"material-symbols-rounded"},"power_settings_new",-1),r(" 卸载 ",-1)])])):d("",!0),f(n.value)?d("",!0):(l(),t("button",{key:5,class:"m3-button text error",onClick:G},[...e[7]||(e[7]=[s("span",{class:"material-symbols-rounded"},"delete",-1),r(" 删除 ",-1)])]))])]),C.value?(l(),t("div",vs,[...e[8]||(e[8]=[s("span",{class:"material-symbols-rounded spinning loading-icon"},"progress_activity",-1),s("p",null,"加载插件详情...",-1)])])):h.value?(l(),t("div",ms,[e[9]||(e[9]=s("span",{class:"material-symbols-rounded error-icon"},"error",-1)),s("p",null,a(h.value),1),s("button",{class:"m3-button filled",onClick:p},"重试")])):n.value?(l(),t("div",fs,[s("div",_s,[(l(),t(D,null,x(R,i=>s("button",{key:i.value,class:F(["m3-tab-item",{active:b.value===i.value}]),onClick:g=>b.value=i.value},[s("span",gs,a(i.icon),1),r(" "+a(i.label),1)],10,ps)),64))]),s("div",bs,[b.value==="overview"?(l(),t("div",ys,[s("div",hs,[e[16]||(e[16]=s("h3",{class:"section-title"},"基本信息",-1)),s("div",ks,[s("div",ws,[e[10]||(e[10]=s("div",{class:"info-label"},"插件名称",-1)),s("div",Cs,a(n.value.name),1)]),s("div",Ps,[e[11]||(e[11]=s("div",{class:"info-label"},"显示名称",-1)),s("div",Ds,a(n.value.display_name),1)]),s("div",xs,[e[12]||(e[12]=s("div",{class:"info-label"},"版本",-1)),s("div",As,a(n.value.version),1)]),s("div",Ts,[e[13]||(e[13]=s("div",{class:"info-label"},"作者",-1)),s("div",$s,a(n.value.author),1)]),s("div",Ns,[e[14]||(e[14]=s("div",{class:"info-label"},"状态",-1)),s("div",Ss,[n.value.loaded?(l(),t("span",Vs,"已加载")):(l(),t("span",Bs,"未加载")),n.value.enabled?(l(),t("span",Es,"已启用")):(l(),t("span",js,"已禁用"))])]),s("div",Fs,[e[15]||(e[15]=s("div",{class:"info-label"},"组件数量",-1)),s("div",Ls,a(n.value.components_count),1)])])]),s("div",Rs,[e[17]||(e[17]=s("h3",{class:"section-title"},"描述",-1)),s("p",Is,a(n.value.description||"暂无描述"),1)]),n.value.metadata&&Object.keys(n.value.metadata).length>0?(l(),t("div",zs,[e[18]||(e[18]=s("h3",{class:"section-title"},"元数据",-1)),s("div",Ms,[(l(!0),t(D,null,x(n.value.metadata,(i,g)=>(l(),t("div",{key:g,class:"info-item"},[s("div",Us,a(g),1),s("div",qs,a(i),1)]))),128))])])):d("",!0)])):d("",!0),b.value==="components"?(l(),t("div",Gs,[T.value.length===0?(l(),t("div",Hs,[...e[19]||(e[19]=[s("span",{class:"material-symbols-rounded empty-icon"},"extension_off",-1),s("p",null,"该插件没有组件",-1)])])):(l(),t("div",Ks,[(l(!0),t(D,null,x(T.value,(i,g)=>(l(),t("div",{key:i.name+g,class:"m3-card component-card"},[s("div",Os,[s("div",Ys,[s("span",Js,a(K(i.type)),1)]),s("div",Qs,[s("h4",null,a(i.name),1),s("p",Ws,a(i.type),1)]),s("div",Xs,[f(n.value)?(l(),t("div",ne,[e[21]||(e[21]=s("span",{class:"material-symbols-rounded"},"lock",-1)),s("span",null,a(i.enabled?"已启用":"已禁用"),1)])):(l(),t("div",Zs,[s("label",se,[s("input",{type:"checkbox",id:`comp-${g}`,checked:i.enabled,onChange:be=>H(i)},null,40,ee),e[20]||(e[20]=s("span",{class:"slider"},null,-1))]),s("span",oe,a(i.enabled?"已启用":"已禁用"),1)]))])]),i.description?(l(),t("div",te,a(i.description),1)):d("",!0)]))),128))]))])):d("",!0),b.value==="config"?(l(),t("div",le,[s("div",ae,[e[28]||(e[28]=s("h3",{class:"section-title"},"配置文件",-1)),s("div",ie,[s("div",ce,[e[22]||(e[22]=s("div",{class:"info-label"},"配置路径",-1)),s("div",de,a(n.value.config.path),1)]),s("div",ue,[e[25]||(e[25]=s("div",{class:"info-label"},"文件状态",-1)),s("div",re,[n.value.config.exists?(l(),t("span",ve,[...e[23]||(e[23]=[s("span",{class:"material-symbols-rounded"},"check",-1),r(" 已存在 ",-1)])])):(l(),t("span",me,[...e[24]||(e[24]=[s("span",{class:"material-symbols-rounded"},"close",-1),r(" 不存在 ",-1)])]))])])]),n.value.config.exists?(l(),t("button",{key:0,class:"m3-button filled",onClick:O},[...e[26]||(e[26]=[s("span",{class:"material-symbols-rounded"},"settings",-1),r(" 打开配置编辑器 ",-1)])])):(l(),t("div",fe,[...e[27]||(e[27]=[s("span",{class:"material-symbols-rounded"},"error",-1),s("span",null,"配置文件不存在",-1)])]))])])):d("",!0)])])):d("",!0),j(X,{name:"toast"},{default:W(()=>[_.value.show?(l(),t("div",{key:0,class:F(["m3-snackbar",_.value.type])},[s("span",_e,a(_.value.type==="success"?"check_circle":"error"),1),r(" "+a(_.value.message),1)],2)):d("",!0)]),_:1}),j(Z,{visible:m.value.show,title:m.value.title,message:m.value.message,onConfirm:m.value.onConfirm,onCancel:e[0]||(e[0]=i=>m.value.show=!1)},null,8,["visible","title","message","onConfirm"])])}}}),ke=es(pe,[["__scopeId","data-v-f711e743"]]);export{ke as default};
