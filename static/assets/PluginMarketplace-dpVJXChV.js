import{a as G,r as c,G as D,p as O,c as o,e as a,f as q,Y as z,Z as K,n as y,F as P,h as x,t as l,w as Q,g as w,N as d,T as R,j as U,o as n,_ as Y}from"./index-Dz5dMUCJ.js";import{g as Z,i as H}from"./marketplace-LVahdRNL.js";const J={class:"plugin-marketplace-view"},W={class:"page-header"},X={class:"header-content"},ss={class:"header-actions"},es={class:"search-box"},ts=["disabled"],as={class:"category-filter"},os=["onClick"],ns={key:0,class:"material-symbols-rounded check-icon"},ls={class:"marketplace-container"},rs={key:0,class:"loading-state"},is={key:1,class:"error-state"},cs={key:2,class:"empty-state"},ds={key:3,class:"plugin-grid"},us={class:"plugin-header"},ms={class:"plugin-icon"},vs={class:"material-symbols-rounded"},fs={class:"plugin-status"},ps={key:0,class:"status-badge success"},_s={key:1,class:"status-badge error"},hs={class:"plugin-info"},ys={class:"description"},ks={class:"plugin-meta"},bs={class:"meta-item"},ws={class:"meta-item"},Cs={key:0,class:"plugin-keywords"},gs={class:"plugin-actions"},Ps=["onClick"],xs=["onClick","disabled"],Ns=["onClick","disabled"],$s=["onClick"],Fs={class:"material-symbols-rounded"},Ms=G({__name:"PluginMarketplace",setup(Ts){const C=U(),p=c(!0),v=c(""),u=c([]),m=c({}),_=c([]),k=c(""),h=c("全部"),i=c(new Set),f=c({show:!1,message:"",type:"success"}),E=D(()=>{const t=new Set(["全部"]);return u.value&&u.value.forEach(s=>{s.manifest.categories&&s.manifest.categories.forEach(e=>t.add(e))}),Array.from(t)}),N=D(()=>{if(!u.value)return[];let t=u.value;if(h.value!=="全部"&&(t=t.filter(s=>{var e;return(e=s.manifest.categories)==null?void 0:e.includes(h.value)})),k.value){const s=k.value.toLowerCase();t=t.filter(e=>{var T;const r=e.manifest.name.toLowerCase().includes(s),A=e.manifest.description.toLowerCase().includes(s),B=(T=e.manifest.keywords)==null?void 0:T.some(j=>j.toLowerCase().includes(s));return r||A||B})}return t});function $(t){var e;if(!((e=t==null?void 0:t.manifest)!=null&&e.repository_url))return!1;const s=t.manifest.repository_url.split("/").pop()||"";return Object.prototype.hasOwnProperty.call(m.value,s)}function F(t){var e;if(!((e=t==null?void 0:t.manifest)!=null&&e.repository_url))return!1;const s=t.manifest.repository_url.split("/").pop()||"";return _.value.includes(s)}function I(t){if(!(t!=null&&t.manifest))return"extension";const s=t.manifest.categories||[];return s.includes("Entertainment")||s.includes("Fun")?"sentiment_satisfied":s.includes("Games")?"sports_esports":s.includes("Tools")?"build":"extension"}function L(t){C.push(`/dashboard/marketplace/${t}`)}function V(t){if(t){const s=t.manifest.repository_url.split("/").pop()||"",e=m.value[s];if(e){C.push({path:`plugin-config/plugins%2F${e}%2Fconfig.toml`});return}}C.push("/dashboard/plugin-config")}async function M(t){i.value.add(t.id);try{const s=await H(t.id,t.manifest.repository_url,!0);if(console.log("安装响应:",s),s.success&&s.data){const e=s.data;if(e.success){b(`插件 ${t.manifest.name} 安装成功！`,"success");const r=t.manifest.repository_url.split("/").pop()||"";m.value[r]=e.plugin_name||null}else b(`${e.message||"安装失败"}`,"error")}else b(`安装请求失败: ${s.error||"未知错误"}`,"error")}catch(s){b("安装插件时发生错误","error"),console.error(s)}finally{i.value.delete(t.id)}}async function g(){p.value=!0,v.value="";try{const t=await Z();if(console.log("API 响应:",t),t.success&&t.data){const s=t.data;s.success&&s.data?(u.value=s.data.plugins||[],m.value=s.data.installed_plugins||{},_.value=s.data.failed_plugins||[]):(v.value=s.error||"获取插件市场数据失败",u.value=[],m.value={},_.value=[])}else v.value=t.error||"获取插件市场数据失败",u.value=[],m.value={},_.value=[]}catch(t){v.value="加载插件市场时发生错误",u.value=[],m.value={},_.value=[],console.error(t)}finally{p.value=!1}}function S(){}function b(t,s){f.value={show:!0,message:t,type:s},setTimeout(()=>{f.value.show=!1},3e3)}return O(()=>{g()}),(t,s)=>(n(),o("div",J,[a("header",W,[a("div",X,[s[2]||(s[2]=a("div",{class:"header-left"},[a("div",{class:"header-icon-container"},[a("span",{class:"material-symbols-rounded header-icon"},"storefront")]),a("div",{class:"header-info"},[a("h1",null,"插件市场"),a("p",null,"探索并安装 MoFox 社区插件")])],-1)),a("div",ss,[a("div",es,[s[1]||(s[1]=a("span",{class:"material-symbols-rounded search-icon"},"search",-1)),z(a("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>k.value=e),type:"text",class:"m3-input search-input",placeholder:"搜索插件...",onInput:S},null,544),[[K,k.value]])]),a("button",{class:"m3-icon-button",onClick:g,disabled:p.value,title:"刷新"},[a("span",{class:y(["material-symbols-rounded",{spinning:p.value}])},"refresh",2)],8,ts)])])]),a("div",as,[(n(!0),o(P,null,x(E.value,e=>(n(),o("button",{key:e,class:y(["m3-filter-chip",{selected:h.value===e}]),onClick:r=>h.value=e},[h.value===e?(n(),o("span",ns,"check")):w("",!0),d(" "+l(e),1)],10,os))),128))]),a("div",ls,[p.value?(n(),o("div",rs,[...s[3]||(s[3]=[a("span",{class:"material-symbols-rounded spinning loading-icon"},"progress_activity",-1),a("p",null,"加载插件市场...",-1)])])):v.value?(n(),o("div",is,[s[4]||(s[4]=a("span",{class:"material-symbols-rounded error-icon"},"error",-1)),a("p",null,l(v.value),1),a("button",{class:"m3-button filled",onClick:g},"重试")])):N.value.length===0?(n(),o("div",cs,[...s[5]||(s[5]=[a("span",{class:"material-symbols-rounded empty-icon"},"search_off",-1),a("p",null,"未找到匹配的插件",-1)])])):(n(),o("div",ds,[(n(!0),o(P,null,x(N.value,e=>(n(),o("div",{key:e.id,class:"m3-card plugin-card"},[a("div",us,[a("div",ms,[a("span",vs,l(I(e)),1)]),a("div",fs,[$(e)?(n(),o("span",ps,[...s[6]||(s[6]=[a("span",{class:"material-symbols-rounded"},"check_circle",-1),d(" 已安装 ",-1)])])):F(e)?(n(),o("span",_s,[...s[7]||(s[7]=[a("span",{class:"material-symbols-rounded"},"error",-1),d(" 异常 ",-1)])])):w("",!0)])]),a("div",hs,[a("h3",null,l(e.manifest.name),1),a("p",ys,l(e.manifest.description),1),a("div",ks,[a("span",bs,[s[8]||(s[8]=a("span",{class:"material-symbols-rounded"},"person",-1)),d(" "+l(e.manifest.author),1)]),a("span",ws,[s[9]||(s[9]=a("span",{class:"material-symbols-rounded"},"sell",-1)),d(" v"+l(e.manifest.version),1)])]),e.manifest.keywords&&e.manifest.keywords.length>0?(n(),o("div",Cs,[(n(!0),o(P,null,x(e.manifest.keywords.slice(0,3),r=>(n(),o("span",{key:r,class:"keyword-chip"},l(r),1))),128))])):w("",!0)]),a("div",gs,[a("button",{class:"m3-button text",onClick:r=>L(e.id)}," 详情 ",8,Ps),F(e)?(n(),o("button",{key:0,class:"m3-button filled error-button",onClick:r=>M(e),disabled:i.value.has(e.id)},[a("span",{class:y(["material-symbols-rounded",{spinning:i.value.has(e.id)}])},l(i.value.has(e.id)?"progress_activity":"refresh"),3),d(" "+l(i.value.has(e.id)?"重新安装中...":"重新安装"),1)],8,xs)):$(e)?(n(),o("button",{key:2,class:"m3-button tonal",onClick:r=>V(e)},[...s[10]||(s[10]=[a("span",{class:"material-symbols-rounded"},"settings",-1),d(" 配置 ",-1)])],8,$s)):(n(),o("button",{key:1,class:"m3-button filled",onClick:r=>M(e),disabled:i.value.has(e.id)},[a("span",{class:y(["material-symbols-rounded",{spinning:i.value.has(e.id)}])},l(i.value.has(e.id)?"progress_activity":"download"),3),d(" "+l(i.value.has(e.id)?"安装中...":"安装"),1)],8,Ns))])]))),128))]))]),q(R,{name:"toast"},{default:Q(()=>[f.value.show?(n(),o("div",{key:0,class:y(["m3-snackbar",f.value.type])},[a("span",Fs,l(f.value.type==="success"?"check_circle":"error"),1),d(" "+l(f.value.message),1)],2)):w("",!0)]),_:1})]))}}),Is=Y(Ms,[["__scopeId","data-v-2c5de451"]]);export{Is as default};
