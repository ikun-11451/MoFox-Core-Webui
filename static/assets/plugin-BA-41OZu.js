import{an as M,z as i,c as P,ao as O,ap as Q,aq as T,ar as U,as as V,at as W,au as X,av as Y,aw as Z,ax as $,ay as N,az as ee,aA as se,aB as re,aC as ae,aD as te}from"./index-2cLGT6AP.js";const ce=M("plugin",()=>{const l=i([]),v=i([]),u=i(null),d=i([]),f=i(!1),m=i(!1),o=i(null),h=i(""),y=i("all"),p=P(()=>{const s=l.value.length+v.value.length,e=l.value.filter(a=>a.loaded).length,r=l.value.filter(a=>a.enabled).length,t=v.value.length;return{total:s,loaded:e,enabled:r,failed:t}}),E=P(()=>{let s=l.value;if(y.value!=="all")switch(y.value){case"loaded":s=s.filter(e=>e.loaded);break;case"enabled":s=s.filter(e=>e.enabled);break;case"failed":s=s.filter(e=>e.error);break}if(h.value.trim()){const e=h.value.toLowerCase();s=s.filter(r=>{var t;return r.name.toLowerCase().includes(e)||r.display_name.toLowerCase().includes(e)||((t=r.description)==null?void 0:t.toLowerCase().includes(e))})}return s});async function g(){var s;f.value=!0,o.value=null;try{const e=await O();return console.log("插件列表响应:",e),e.success&&e.data?(l.value=e.data.plugins,v.value=e.data.failed_plugins||[],!0):(o.value=((s=e.data)==null?void 0:s.error)||e.error||"获取插件列表失败",!1)}catch(e){return o.value=e instanceof Error?e.message:"网络错误",!1}finally{f.value=!1}}async function b(s){var e,r;m.value=!0,o.value=null;try{const t=await Q(s);return t.success&&((e=t.data)!=null&&e.plugin)?(u.value=t.data.plugin,d.value=t.data.plugin.components||[],!0):(o.value=((r=t.data)==null?void 0:r.error)||t.error||"获取插件详情失败",!1)}catch(t){return o.value=t instanceof Error?t.message:"网络错误",!1}finally{m.value=!1}}async function C(){return u.value?await b(u.value.name):!1}async function A(s){var e;try{const r=await T(s);return r.success&&r.data?(d.value=r.data.components,!0):(o.value=((e=r.data)==null?void 0:e.error)||r.error||"获取组件列表失败",!1)}catch(r){return o.value=r instanceof Error?r.message:"网络错误",!1}}async function x(s){var e,r,t;try{const a=await U(s);if(a.success){const n=l.value.find(c=>c.name===s);return n&&(n.enabled=!0),((e=u.value)==null?void 0:e.name)===s&&(u.value.enabled=!0),{success:!0,message:(r=a.data)==null?void 0:r.message}}else return{success:!1,error:((t=a.data)==null?void 0:t.error)||a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}}async function L(s){var e,r,t;try{const a=await V(s);if(a.success){const n=l.value.find(c=>c.name===s);return n&&(n.enabled=!1),((e=u.value)==null?void 0:e.name)===s&&(u.value.enabled=!1),{success:!0,message:(r=a.data)==null?void 0:r.message}}else return{success:!1,error:((t=a.data)==null?void 0:t.error)||a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}}async function D(s){var e,r,t;try{const a=await W(s);return a.success?(await g(),((e=u.value)==null?void 0:e.name)===s&&await b(s),{success:!0,message:(r=a.data)==null?void 0:r.message}):{success:!1,error:((t=a.data)==null?void 0:t.error)||a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}}async function k(s){var e,r,t;try{const a=await X(s);if(a.success){const n=l.value.findIndex(c=>c.name===s);return n!==-1&&l.value.splice(n,1),((e=u.value)==null?void 0:e.name)===s&&(u.value=null),{success:!0,message:(r=a.data)==null?void 0:r.message}}else return{success:!1,error:((t=a.data)==null?void 0:t.error)||a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}}async function S(s){var e,r,t;try{const a=await Y(s);if(a.success){const n=l.value.findIndex(c=>c.name===s);return n!==-1&&l.value.splice(n,1),((e=u.value)==null?void 0:e.name)===s&&(u.value=null),{success:!0,message:(r=a.data)==null?void 0:r.message}}else return{success:!1,error:((t=a.data)==null?void 0:t.error)||a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}}async function F(s){var e,r;try{const t=await Z(s);return t.success?(await g(),{success:!0,message:(e=t.data)==null?void 0:e.message}):{success:!1,error:((r=t.data)==null?void 0:r.error)||t.error}}catch(t){return{success:!1,error:t instanceof Error?t.message:"网络错误"}}}async function z(s,e,r){var t,a;try{const n=await $(s,e,r);if(n.success){const c=d.value.find(w=>w.name===e);return c&&(c.enabled=!0),{success:!0,message:(t=n.data)==null?void 0:t.message}}else return{success:!1,error:((a=n.data)==null?void 0:a.error)||n.error}}catch(n){return{success:!1,error:n instanceof Error?n.message:"网络错误"}}}async function I(s,e,r){var t,a;try{const n=await N(s,e,r);if(n.success){const c=d.value.find(w=>w.name===e);return c&&(c.enabled=!1),{success:!0,message:(t=n.data)==null?void 0:t.message}}else return{success:!1,error:((a=n.data)==null?void 0:a.error)||n.error}}catch(n){return{success:!1,error:n instanceof Error?n.message:"网络错误"}}}async function K(s=!0){var e;f.value=!0;try{const r=await ee(s);return r.success?(await g(),{success:!0,data:r.data}):{success:!1,error:((e=r.data)==null?void 0:e.error)||r.error}}catch(r){return{success:!1,error:r instanceof Error?r.message:"网络错误"}}finally{f.value=!1}}async function R(){var s,e;f.value=!0;try{const r=await se();return r.success?(await g(),{success:!0,message:(s=r.data)==null?void 0:s.message}):{success:!1,error:((e=r.data)==null?void 0:e.error)||r.error}}catch(r){return{success:!1,error:r instanceof Error?r.message:"网络错误"}}finally{f.value=!1}}async function _(s){try{const e=await re(s);return e.data?(s.forEach(r=>{var a,n;const t=l.value.find(c=>c.name===r);t&&((n=(a=e.data)==null?void 0:a.results[r])!=null&&n.success)&&(t.enabled=!0)}),e.data):{success:!1,results:{},total:0,succeeded:0,failed:s.length}}catch{return{success:!1,results:{},total:s.length,succeeded:0,failed:s.length}}}async function q(s){try{const e=await ae(s);return e.data?(s.forEach(r=>{var a,n;const t=l.value.find(c=>c.name===r);t&&((n=(a=e.data)==null?void 0:a.results[r])!=null&&n.success)&&(t.enabled=!1)}),e.data):{success:!1,results:{},total:0,succeeded:0,failed:s.length}}catch{return{success:!1,results:{},total:s.length,succeeded:0,failed:s.length}}}async function B(s){try{const e=await te(s);return e.data?(await g(),e.data):{success:!1,results:{},total:0,succeeded:0,failed:s.length}}catch{return{success:!1,results:{},total:s.length,succeeded:0,failed:s.length}}}function j(){u.value=null,d.value=[]}function G(s){h.value=s}function H(s){y.value=s}function J(){o.value=null}return{plugins:l,failedPlugins:v,currentPlugin:u,currentComponents:d,loading:f,detailLoading:m,error:o,searchKeyword:h,statusFilter:y,stats:p,filteredPlugins:E,fetchPlugins:g,fetchPluginDetail:b,refreshCurrentPlugin:C,fetchPluginComponents:A,enablePluginAction:x,disablePluginAction:L,reloadPluginAction:D,unloadPluginAction:k,deletePluginAction:S,loadPluginAction:F,enableComponentAction:z,disableComponentAction:I,scanForNewPlugins:K,reloadAll:R,batchEnable:_,batchDisable:q,batchReload:B,clearCurrentPlugin:j,setSearchKeyword:G,setStatusFilter:H,clearError:J}});export{ce as u};
