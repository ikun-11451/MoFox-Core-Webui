import{ab as U,d as oe,a as G,G as L,c,o as r,n as R,e,x as z,g as I,t as v,F as A,h as K,N as T,_ as H,r as $,I as X,m as W,f as N,T as ee,w as se,Y as Q,Z as O,a0 as ae,a7 as le,O as te,v as ie,aH as ne,p as re,q as D}from"./index-Dsia8u1P.js";import{c as Z,s as de}from"./dialog-DsN8jS3O.js";import"./ConfirmDialog-C-5qpYj8.js";import"./iconify-M55kX5oW.js";async function ue(s={}){return(await U.get("/emoji/list",{params:s})).data}async function ce(s){return(await U.get(`/emoji/${s}`)).data}async function me(s){const o=new FormData;s.forEach(E=>o.append("files",E));const m=await U.post("/emoji/upload",o);if(!m.success){const E=m.error||"上传失败";throw new Error(E)}return m.data}async function ve(s){return(await U.delete(`/emoji/${s}`)).data}async function pe(s,o){return(await U.patch(`/emoji/${s}`,o)).data}async function J(s,o){return(await U.post("/emoji/batch",{action:s,emoji_hashes:o})).data}async function fe(){return(await U.get("/emoji/stats")).data}const Y=oe("emoji",{state:()=>({items:[],total:0,page:1,pageSize:50,totalPages:0,loading:!1,selectedItems:new Set,searchQuery:"",sortBy:"record_time",sortOrder:"desc",isRegisteredFilter:null,isBannedFilter:null}),getters:{hasSelection:s=>s.selectedItems.size>0,selectionCount:s=>s.selectedItems.size,isAllSelected:s=>s.items.length===0?!1:s.items.every(o=>s.selectedItems.has(o.hash)),currentParams:s=>({page:s.page,page_size:s.pageSize,search:s.searchQuery||void 0,sort_by:s.sortBy,sort_order:s.sortOrder,is_registered:s.isRegisteredFilter??void 0,is_banned:s.isBannedFilter??void 0})},actions:{async fetchEmojiList(){this.loading=!0,console.log("[EmojiStore] 准备请求列表, searchQuery:",this.searchQuery),console.log("[EmojiStore] 请求参数:",this.currentParams);try{const s=await ue(this.currentParams);if(s!=null&&s.success){const{items:o,total:m,page:E,page_size:j,total_pages:n}=s.data;this.items=o,this.total=m,this.page=E,this.pageSize=j,this.totalPages=n}}catch(s){throw console.error("获取表情包列表失败:",s),s}finally{this.loading=!1}},async getEmojiDetail(s){try{const o=await ce(s);return o!=null&&o.success?o.data:null}catch(o){throw console.error("获取表情包详情失败:",o),o}},async uploadEmojis(s){try{const o=await me(s);if(o!=null&&o.success)return await this.fetchEmojiList(),o.data;throw new Error("上传失败")}catch(o){throw console.error("上传表情包失败:",o),o}},async deleteEmoji(s){try{const o=await ve(s);return o!=null&&o.success?(await this.fetchEmojiList(),this.selectedItems.delete(s),!0):!1}catch(o){throw console.error("删除表情包失败:",o),o}},async updateEmoji(s,o){try{const m=await pe(s,o);if(m!=null&&m.success)return await this.fetchEmojiList(),m.data;throw new Error("更新失败")}catch(m){throw console.error("更新表情包失败:",m),m}},async batchDelete(s){try{const o=await J("delete",s);if(o!=null&&o.success)return await this.fetchEmojiList(),s.forEach(m=>this.selectedItems.delete(m)),o.data;throw new Error("批量删除失败")}catch(o){throw console.error("批量删除失败:",o),o}},async batchBan(s){try{const o=await J("ban",s);if(o!=null&&o.success)return await this.fetchEmojiList(),o.data;throw new Error("批量禁用失败")}catch(o){throw console.error("批量禁用失败:",o),o}},async batchUnban(s){try{const o=await J("unban",s);if(o!=null&&o.success)return await this.fetchEmojiList(),o.data;throw new Error("批量启用失败")}catch(o){throw console.error("批量启用失败:",o),o}},async getStats(){try{const s=await fe();return s!=null&&s.success?s.data:null}catch(s){return console.error("获取统计信息失败:",s),null}},toggleSelection(s){this.selectedItems.has(s)?this.selectedItems.delete(s):this.selectedItems.add(s)},toggleSelectAll(){this.isAllSelected?this.clearSelection():this.items.forEach(s=>this.selectedItems.add(s.hash))},clearSelection(){this.selectedItems.clear()},setSearchQuery(s){console.log("[EmojiStore] setSearchQuery 被调用, 参数:",s),this.searchQuery=s,this.page=1,console.log("[EmojiStore] searchQuery 已设置为:",this.searchQuery)},setSorting(s,o){this.sortBy=s,this.sortOrder=o,this.page=1},setPage(s){this.page=s},setPageSize(s){this.pageSize=s,this.page=1},resetFilters(){this.searchQuery="",this.isRegisteredFilter=null,this.isBannedFilter=null,this.sortBy="record_time",this.sortOrder="desc",this.page=1}}}),ge={class:"emoji-image-container"},he=["src"],ye={key:1,class:"placeholder"},be={key:2,class:"banned-badge"},_e={class:"hover-actions"},we={class:"emoji-info"},$e=["title"],je={key:0,class:"emotion-tags"},ke={class:"stats"},Ee={class:"stat-item",title:"查询次数"},De={class:"stat-item",title:"使用次数"},Se=G({__name:"EmojiCard",props:{emoji:{},selected:{type:Boolean}},emits:["select","view-detail","delete"],setup(s,{emit:o}){const m=s,E=o,j=h=>{const d=h.match(/Keywords:\s*\[(.*?)\]/),b=h.match(/^(.*?)\s*Keywords:/);return{refined:b?b[1].trim():h,keywords:d?d[1].split(",").map(x=>x.trim()).filter(Boolean):[]}},n=L(()=>j(m.emoji.description).refined||m.emoji.description),p=L(()=>m.emoji.description),k=L(()=>{const h=j(m.emoji.description);return h.keywords.length>0?h.keywords:m.emoji.emotions}),_=()=>{confirm(`确定要删除表情包"${n.value}"吗？`)&&E("delete")};return(h,d)=>(r(),c("div",{class:R(["emoji-card",{selected:s.selected,banned:s.emoji.is_banned}]),onClick:d[2]||(d[2]=b=>h.$emit("view-detail"))},[e("div",{class:R(["select-checkbox",{checked:s.selected}]),onClick:d[0]||(d[0]=z(b=>h.$emit("select"),["stop"]))},[...d[3]||(d[3]=[e("span",{class:"material-symbols-rounded check-icon"},"check",-1)])],2),e("div",ge,[s.emoji.thumbnail?(r(),c("img",{key:0,src:s.emoji.thumbnail,alt:"表情包缩略图",class:"emoji-image",loading:"lazy"},null,8,he)):(r(),c("div",ye,[...d[4]||(d[4]=[e("span",{class:"material-symbols-rounded"},"broken_image",-1)])])),s.emoji.is_banned?(r(),c("div",be,[...d[5]||(d[5]=[e("span",{class:"material-symbols-rounded"},"block",-1)])])):I("",!0),e("div",_e,[e("button",{class:"action-button view",title:"查看详情",onClick:d[1]||(d[1]=z(b=>h.$emit("view-detail"),["stop"]))},[...d[6]||(d[6]=[e("span",{class:"material-symbols-rounded"},"visibility",-1)])]),e("button",{class:"action-button delete",title:"删除",onClick:z(_,["stop"])},[...d[7]||(d[7]=[e("span",{class:"material-symbols-rounded"},"delete",-1)])])])]),e("div",we,[e("div",{class:"emoji-description",title:p.value},v(n.value),9,$e),k.value&&k.value.length>0?(r(),c("div",je,[(r(!0),c(A,null,K(k.value.slice(0,3),b=>(r(),c("span",{key:b,class:"emotion-tag"},v(b),1))),128))])):I("",!0),e("div",ke,[e("span",Ee,[d[8]||(d[8]=e("span",{class:"material-symbols-rounded"},"visibility",-1)),T(" "+v(s.emoji.query_count),1)]),e("span",De,[d[9]||(d[9]=e("span",{class:"material-symbols-rounded"},"emoji_emotions",-1)),T(" "+v(s.emoji.usage_count),1)])])])],2))}}),Ce=H(Se,[["__scopeId","data-v-9e673d04"]]),Ie={class:"dialog-content"},Ve={class:"full-image-container"},xe=["src"],Be={class:"detail-section"},ze={class:"info-grid"},Fe={class:"info-item"},Me={class:"value"},Ue={class:"info-item"},Le={class:"value"},Te={class:"info-item"},Pe=["title"],Qe={class:"detail-section"},Re={class:"detail-section"},Ae={class:"detail-section"},Ke={class:"emotion-editor"},Oe={class:"emotion-chips"},Ne=["onClick"],Ge={class:"add-emotion"},He={class:"detail-section"},qe={class:"stats-grid"},Je={class:"stat-card"},We={class:"stat-value"},Ye={class:"stat-card"},Ze={class:"stat-value"},Xe={class:"detail-section"},es={class:"info-grid"},ss={class:"info-item"},ts={class:"value"},os={class:"info-item"},as={class:"value"},ls={class:"info-item"},is={class:"value"},ns={class:"detail-section"},rs={class:"status-controls"},ds={class:"switch"},us={class:"dialog-footer"},cs=["disabled"],ms=G({__name:"EmojiDetailDialog",props:{modelValue:{type:Boolean},emojiHash:{}},emits:["update:modelValue","updated","deleted"],setup(s,{emit:o}){const m=s,E=o,j=Y(),n=$(null),p=$(""),k=$(""),_=$([]),h=$(!1),d=$(""),b=$(""),x=$(""),V=$([]),F=$(!1),P=y=>{const t=y.match(/Keywords:\s*\[(.*?)\]/),a=y.match(/Desc:\s*(.*)/),u=y.match(/^(.*?)\s*Keywords:/);return{refined:u?u[1].trim():"",keywords:t?t[1].split(",").map(C=>C.trim()).filter(Boolean):[],detailed:a?a[1].trim():y}},M=()=>{const y=_.value.join(",");return`${p.value.trim()} Keywords: [${y}] Desc: ${k.value.trim()}`},B=L(()=>{if(p.value.trim()!==b.value.trim()||k.value.trim()!==x.value.trim()||h.value!==F.value||_.value.length!==V.value.length)return!0;const y=[..._.value].sort(),t=[...V.value].sort();return!y.every((a,u)=>a===t[u])});X(()=>[m.modelValue,m.emojiHash],async([y,t])=>{if(y&&t)try{if(n.value=await j.getEmojiDetail(t),n.value){const a=P(n.value.description);p.value=a.refined,k.value=a.detailed,_.value=a.keywords.length>0?a.keywords:[...n.value.emotions],h.value=n.value.is_banned,b.value=a.refined,x.value=a.detailed,V.value=a.keywords.length>0?[...a.keywords]:[...n.value.emotions],F.value=n.value.is_banned}}catch(a){console.error("加载表情包详情失败:",a),i()}},{immediate:!0});const i=()=>{E("update:modelValue",!1),n.value=null},l=()=>{d.value.trim()&&(_.value.push(d.value.trim()),d.value="")},f=y=>{_.value.splice(y,1)},g=async()=>{if(n.value)try{const y=M();await j.updateEmoji(n.value.hash,{description:y,emotions:_.value,is_banned:h.value}),E("updated"),i()}catch(y){console.error("保存失败:",y),await Z({title:"错误",message:"保存失败，请重试",type:"danger"})}},w=async()=>{if(!(!n.value||!await de({title:"删除表情包",message:`确定要删除表情包"${n.value.description}"吗？`,type:"danger",confirmText:"删除"})))try{await j.deleteEmoji(n.value.hash),E("deleted"),i()}catch(t){console.error("删除失败:",t),await Z({title:"错误",message:"删除失败，请重试",type:"danger"})}},S=y=>y?new Date(y*1e3).toLocaleString("zh-CN"):"未记录";return(y,t)=>(r(),W(te,{to:"body"},[N(ee,{name:"dialog"},{default:se(()=>[s.modelValue&&n.value?(r(),c("div",{key:0,class:"dialog-overlay",onClick:i},[e("div",{class:"dialog-container",onClick:t[4]||(t[4]=z(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[t[6]||(t[6]=e("h2",null,"表情包详情",-1)),e("button",{class:"close-button",onClick:i},[...t[5]||(t[5]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])]),e("div",Ie,[e("div",Ve,[n.value.full_image?(r(),c("img",{key:0,src:n.value.full_image,alt:"表情包图片",class:"full-image"},null,8,xe)):I("",!0)]),e("div",Be,[t[10]||(t[10]=e("h3",null,"基本信息",-1)),e("div",ze,[e("div",Fe,[t[7]||(t[7]=e("label",null,"哈希值",-1)),e("div",Me,v(n.value.hash),1)]),e("div",Ue,[t[8]||(t[8]=e("label",null,"格式",-1)),e("div",Le,v(n.value.format.toUpperCase()),1)]),e("div",Te,[t[9]||(t[9]=e("label",null,"文件路径",-1)),e("div",{class:"value truncate",title:n.value.full_path},v(n.value.full_path),9,Pe)])])]),e("div",Qe,[t[11]||(t[11]=e("h3",null,"精炼描述",-1)),Q(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),class:"description-input",rows:"2",placeholder:"输入精炼的自然语言描述..."},null,512),[[O,p.value]])]),e("div",Re,[t[12]||(t[12]=e("h3",null,"详细描述",-1)),Q(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>k.value=a),class:"description-input",rows:"4",placeholder:"输入详细描述（不超过250字）..."},null,512),[[O,k.value]])]),e("div",Ae,[t[15]||(t[15]=e("h3",null,"情感标签",-1)),e("div",Ke,[e("div",Oe,[(r(!0),c(A,null,K(_.value,(a,u)=>(r(),c("span",{key:u,class:"emotion-chip"},[T(v(a)+" ",1),e("button",{onClick:C=>f(u)},[...t[13]||(t[13]=[e("span",{class:"material-symbols-rounded"},"close",-1)])],8,Ne)]))),128))]),e("div",Ge,[Q(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>d.value=a),type:"text",placeholder:"添加情感标签...",onKeyup:ae(l,["enter"])},null,544),[[O,d.value]]),e("button",{onClick:l},[...t[14]||(t[14]=[e("span",{class:"material-symbols-rounded"},"add",-1)])])])])]),e("div",He,[t[20]||(t[20]=e("h3",null,"统计信息",-1)),e("div",qe,[e("div",Je,[t[17]||(t[17]=e("span",{class:"material-symbols-rounded"},"visibility",-1)),e("div",null,[e("div",We,v(n.value.query_count),1),t[16]||(t[16]=e("div",{class:"stat-label"},"查询次数",-1))])]),e("div",Ye,[t[19]||(t[19]=e("span",{class:"material-symbols-rounded"},"emoji_emotions",-1)),e("div",null,[e("div",Ze,v(n.value.usage_count),1),t[18]||(t[18]=e("div",{class:"stat-label"},"使用次数",-1))])])])]),e("div",Xe,[t[24]||(t[24]=e("h3",null,"时间信息",-1)),e("div",es,[e("div",ss,[t[21]||(t[21]=e("label",null,"记录时间",-1)),e("div",ts,v(S(n.value.record_time)),1)]),e("div",os,[t[22]||(t[22]=e("label",null,"注册时间",-1)),e("div",as,v(S(n.value.register_time)),1)]),e("div",ls,[t[23]||(t[23]=e("label",null,"最后使用",-1)),e("div",is,v(S(n.value.last_used_time)),1)])])]),e("div",ns,[t[27]||(t[27]=e("h3",null,"状态控制",-1)),e("div",rs,[e("label",ds,[Q(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>h.value=a),type:"checkbox"},null,512),[[le,h.value]]),t[25]||(t[25]=e("span",{class:"slider"},null,-1)),t[26]||(t[26]=e("span",{class:"label"},"禁用表情包",-1))])])])]),e("div",us,[e("button",{class:"secondary-button",onClick:i}," 取消 "),e("button",{class:"danger-button",onClick:w}," 删除 "),e("button",{class:"primary-button",onClick:g,disabled:!B.value}," 保存更改 ",8,cs)])])])):I("",!0)]),_:1})]))}}),vs=H(ms,[["__scopeId","data-v-f51af2c3"]]),ps={class:"dialog-content"},fs={key:0,class:"file-list"},gs={class:"file-grid"},hs={class:"file-preview"},ys=["src","alt"],bs={key:1,class:"preview-placeholder"},_s={class:"file-info"},ws=["title"],$s={class:"file-size"},js={key:0,class:"file-error"},ks={key:1,class:"file-progress"},Es={class:"progress-bar"},Ds={class:"progress-text"},Ss={key:2,class:"file-success"},Cs=["disabled","onClick"],Is={key:1,class:"upload-stats"},Vs={class:"stat-item"},xs={class:"stat-item success"},Bs={class:"stat-item error"},zs={class:"dialog-footer"},Fs=["disabled"],Ms=["disabled"],Us={key:0},Ls={key:1},Ts=G({__name:"EmojiUploadDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","uploaded"],setup(s,{emit:o}){const m=s,E=o,j=Y(),n=$(null),p=$([]),k=$(!1),_=$(!1),h=L(()=>({total:p.value.length,success:p.value.filter(i=>i.success).length,failed:p.value.filter(i=>i.error).length}));X(()=>m.modelValue,i=>{i||(p.value=[],_.value=!1)});const d=()=>{var i;(i=n.value)==null||i.click()},b=i=>{const l=i.target;l.files&&V(Array.from(l.files))},x=i=>{var l;k.value=!1,(l=i.dataTransfer)!=null&&l.files&&V(Array.from(i.dataTransfer.files))},V=i=>{const l=["image/png","image/jpeg","image/gif","image/webp"];for(const g of i){if(p.value.some(a=>a.name===g.name&&a.size===g.size))continue;let w=null;l.includes(g.type)?g.size>10485760&&(w="超过大小限制（10MB）"):w="格式不支持";const S={name:g.name,size:g.size,file:g,preview:null,uploading:!1,success:!1,error:w,progress:0},y=p.value.push(S),t=p.value[y-1];if(!w){const a=new FileReader;a.onload=u=>{var C;t.preview=(C=u.target)==null?void 0:C.result},a.readAsDataURL(g)}}},F=i=>{p.value.splice(i,1)},P=async()=>{if(p.value.length===0)return;_.value=!0;const i=[];for(const l of p.value)!l.success&&!l.error&&i.push(l.file);try{for(const g of p.value)!g.success&&!g.error&&(g.uploading=!0,g.progress=0);const l=setInterval(()=>{for(const g of p.value)g.uploading&&g.progress<90&&(g.progress=parseFloat((g.progress+Math.random()*10).toFixed(2)))},200),f=await j.uploadEmojis(i);clearInterval(l);for(const g of f.success||[]){const w=p.value.find(S=>S.name===g.filename);w&&(w.uploading=!1,w.success=!0,w.progress=100)}for(const g of f.failed||[]){const w=p.value.find(S=>S.name===g.filename);w&&(w.uploading=!1,w.error=g.error||"上传失败",w.progress=0)}f.failed.length===0&&setTimeout(()=>{E("uploaded"),B()},1500)}catch(l){console.error("上传失败:",l);for(const f of p.value)f.uploading&&(f.uploading=!1,f.error="上传失败，请重试")}finally{_.value=!1}},M=i=>i<1024?i+" B":i<1024*1024?(i/1024).toFixed(2)+" KB":(i/(1024*1024)).toFixed(2)+" MB",B=()=>{_.value&&!confirm("上传正在进行中，确定要关闭吗？")||E("update:modelValue",!1)};return(i,l)=>(r(),W(te,{to:"body"},[N(ee,{name:"dialog"},{default:se(()=>[s.modelValue?(r(),c("div",{key:0,class:"dialog-overlay",onClick:B},[e("div",{class:"dialog-container",onClick:l[2]||(l[2]=z(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[l[4]||(l[4]=e("h2",null,"上传表情包",-1)),e("button",{class:"close-button",onClick:B},[...l[3]||(l[3]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])]),e("div",ps,[e("div",{class:R(["upload-area",{"drag-over":k.value}]),onDrop:z(x,["prevent"]),onDragover:l[0]||(l[0]=z(f=>k.value=!0,["prevent"])),onDragleave:l[1]||(l[1]=z(f=>k.value=!1,["prevent"])),onClick:d},[l[5]||(l[5]=e("span",{class:"material-symbols-rounded upload-icon"},"cloud_upload",-1)),l[6]||(l[6]=e("p",{class:"upload-text"},"拖拽文件到此处或点击选择",-1)),l[7]||(l[7]=e("p",{class:"upload-hint"},"支持 PNG, JPG, GIF, WEBP 格式",-1)),e("input",{ref_key:"fileInput",ref:n,type:"file",multiple:"",accept:"image/png,image/jpeg,image/gif,image/webp",style:{display:"none"},onChange:b},null,544)],34),p.value.length>0?(r(),c("div",fs,[e("h3",null,"待上传文件 ("+v(p.value.length)+")",1),e("div",gs,[(r(!0),c(A,null,K(p.value,(f,g)=>(r(),c("div",{key:g,class:R(["file-item",{"upload-error":f.error,"upload-success":f.success}])},[e("div",hs,[f.preview?(r(),c("img",{key:0,src:f.preview,alt:f.name},null,8,ys)):(r(),c("div",bs,[...l[8]||(l[8]=[e("span",{class:"material-symbols-rounded"},"image",-1)])]))]),e("div",_s,[e("div",{class:"file-name",title:f.name},v(f.name),9,ws),e("div",$s,v(M(f.size)),1),f.error?(r(),c("div",js,v(f.error),1)):I("",!0),f.uploading?(r(),c("div",ks,[e("div",Es,[e("div",{class:"progress-fill",style:ie({width:f.progress+"%"})},null,4)]),e("div",Ds,v(f.progress.toFixed(2))+"%",1)])):I("",!0),f.success?(r(),c("div",Ss,[...l[9]||(l[9]=[e("span",{class:"material-symbols-rounded"},"check_circle",-1),T(" 上传成功 ",-1)])])):I("",!0)]),e("button",{class:"remove-button",disabled:f.uploading,onClick:w=>F(g)},[...l[10]||(l[10]=[e("span",{class:"material-symbols-rounded"},"close",-1)])],8,Cs)],2))),128))])])):I("",!0),h.value.total>0?(r(),c("div",Is,[e("div",Vs,[l[11]||(l[11]=e("span",{class:"material-symbols-rounded"},"folder",-1)),e("span",null,"总计: "+v(h.value.total),1)]),e("div",xs,[l[12]||(l[12]=e("span",{class:"material-symbols-rounded"},"check_circle",-1)),e("span",null,"成功: "+v(h.value.success),1)]),e("div",Bs,[l[13]||(l[13]=e("span",{class:"material-symbols-rounded"},"error",-1)),e("span",null,"失败: "+v(h.value.failed),1)])])):I("",!0)]),e("div",zs,[e("button",{class:"secondary-button",onClick:B,disabled:_.value}," 取消 ",8,Fs),e("button",{class:"primary-button",onClick:P,disabled:p.value.length===0||_.value},[_.value?(r(),c("span",Us,"上传中...")):(r(),c("span",Ls,"开始上传 ("+v(p.value.length)+")",1))],8,Ms)])])])):I("",!0)]),_:1})]))}}),Ps=H(Ts,[["__scopeId","data-v-e1912663"]]),Qs={class:"emoji-manager"},Rs={class:"toolbar"},As={class:"toolbar-left"},Ks={class:"search-box"},Os={class:"toolbar-right"},Ns={key:0,class:"stats-card"},Gs={class:"stat-item"},Hs={class:"stat-content"},qs={class:"stat-value"},Js={class:"stat-item"},Ws={class:"stat-content"},Ys={class:"stat-value"},Zs={class:"stat-item"},Xs={class:"stat-content"},et={class:"stat-value"},st={class:"stat-item"},tt={class:"stat-content"},ot={class:"stat-value"},at={class:"emoji-grid-container"},lt={key:0,class:"loading-container"},it={key:1,class:"empty-state"},nt={key:2,class:"grid"},rt={key:1,class:"pagination"},dt=["disabled"],ut={class:"page-numbers"},ct=["onClick"],mt=["disabled"],vt={class:"page-info"},pt=G({__name:"EmojiManager",setup(s){const o=Y(),{items:m,total:E,page:j,totalPages:n,loading:p,selectedItems:k,hasSelection:_,selectionCount:h}=ne(o),d=$(""),b=$({total_count:0,registered_count:0,banned_count:0,avg_usage:0}),x=$(!1),V=$(!1),F=$(""),P=L(()=>{const t=[];let u=Math.max(1,j.value-Math.floor(3.5)),C=Math.min(n.value,u+7-1);C-u<6&&(u=Math.max(1,C-7+1));for(let q=u;q<=C;q++)t.push(q);return t});let M=null;const B=()=>{M&&clearTimeout(M),M=setTimeout(()=>{o.setSearchQuery(d.value),o.fetchEmojiList()},300)},i=async()=>{await o.fetchEmojiList();const t=await o.getStats();t&&(b.value=t)},l=t=>{o.toggleSelection(t)},f=t=>{F.value=t,x.value=!0},g=async t=>{if(confirm("确定要删除这个表情包吗？"))try{await o.deleteEmoji(t)}catch{alert("删除失败")}},w=async()=>{if(confirm(`确定要删除选中的 ${h.value} 个表情包吗？`))try{await o.batchDelete(Array.from(k.value)),o.clearSelection()}catch{alert("批量删除失败")}},S=t=>{o.setPage(t),o.fetchEmojiList()},y=async()=>{await i(),V.value=!1};return re(async()=>{await o.fetchEmojiList();const t=await o.getStats();t&&(b.value=t)}),(t,a)=>(r(),c("div",Qs,[e("div",Rs,[e("div",As,[e("div",Ks,[a[6]||(a[6]=e("span",{class:"material-symbols-rounded"},"search",-1)),Q(e("input",{"onUpdate:modelValue":a[0]||(a[0]=u=>d.value=u),type:"text",placeholder:"搜索表情包描述...",onInput:B},null,544),[[O,d.value]])]),e("button",{class:"icon-button",title:"刷新",onClick:i},[...a[7]||(a[7]=[e("span",{class:"material-symbols-rounded"},"refresh",-1)])])]),e("div",Os,[D(_)?(r(),c("button",{key:0,class:"batch-button delete",onClick:w},[a[8]||(a[8]=e("span",{class:"material-symbols-rounded"},"delete",-1)),T(" 删除选中 ("+v(D(h))+") ",1)])):I("",!0),e("button",{class:"upload-button",onClick:a[1]||(a[1]=u=>V.value=!0)},[...a[9]||(a[9]=[e("span",{class:"material-symbols-rounded"},"upload",-1),T(" 上传表情包 ",-1)])])])]),b.value?(r(),c("div",Ns,[e("div",Gs,[a[11]||(a[11]=e("span",{class:"material-symbols-rounded icon"},"inventory_2",-1)),e("div",Hs,[e("div",qs,v(b.value.total_count),1),a[10]||(a[10]=e("div",{class:"stat-label"},"总表情包数",-1))])]),e("div",Js,[a[13]||(a[13]=e("span",{class:"material-symbols-rounded icon"},"check_circle",-1)),e("div",Ws,[e("div",Ys,v(b.value.registered_count),1),a[12]||(a[12]=e("div",{class:"stat-label"},"已注册",-1))])]),e("div",Zs,[a[15]||(a[15]=e("span",{class:"material-symbols-rounded icon"},"block",-1)),e("div",Xs,[e("div",et,v(b.value.banned_count),1),a[14]||(a[14]=e("div",{class:"stat-label"},"已禁用",-1))])]),e("div",st,[a[17]||(a[17]=e("span",{class:"material-symbols-rounded icon"},"trending_up",-1)),e("div",tt,[e("div",ot,v(b.value.total_usage),1),a[16]||(a[16]=e("div",{class:"stat-label"},"总使用次数",-1))])])])):I("",!0),e("div",at,[D(p)?(r(),c("div",lt,[...a[18]||(a[18]=[e("div",{class:"spinner"},null,-1),e("p",null,"加载中...",-1)])])):D(m).length===0?(r(),c("div",it,[...a[19]||(a[19]=[e("span",{class:"material-symbols-rounded"},"image_not_supported",-1),e("p",null,"暂无表情包",-1)])])):(r(),c("div",nt,[(r(!0),c(A,null,K(D(m),u=>(r(),W(Ce,{key:u.hash,emoji:u,selected:D(k).has(u.hash),onSelect:C=>l(u.hash),onViewDetail:C=>f(u.hash),onDelete:C=>g(u.hash)},null,8,["emoji","selected","onSelect","onViewDetail","onDelete"]))),128))]))]),D(n)>1?(r(),c("div",rt,[e("button",{class:"page-button",disabled:D(j)===1,onClick:a[2]||(a[2]=u=>S(D(j)-1))},[...a[20]||(a[20]=[e("span",{class:"material-symbols-rounded"},"chevron_left",-1)])],8,dt),e("div",ut,[(r(!0),c(A,null,K(P.value,u=>(r(),c("button",{key:u,class:R(["page-number",{active:u===D(j)}]),onClick:C=>S(u)},v(u),11,ct))),128))]),e("button",{class:"page-button",disabled:D(j)===D(n),onClick:a[3]||(a[3]=u=>S(D(j)+1))},[...a[21]||(a[21]=[e("span",{class:"material-symbols-rounded"},"chevron_right",-1)])],8,mt),e("div",vt," 第 "+v(D(j))+" / "+v(D(n))+" 页，共 "+v(D(E))+" 条 ",1)])):I("",!0),N(vs,{modelValue:x.value,"onUpdate:modelValue":a[4]||(a[4]=u=>x.value=u),"emoji-hash":F.value,onUpdated:i,onDeleted:i},null,8,["modelValue","emoji-hash"]),N(Ps,{modelValue:V.value,"onUpdate:modelValue":a[5]||(a[5]=u=>V.value=u),onUploaded:y},null,8,["modelValue"])]))}}),bt=H(pt,[["__scopeId","data-v-36f3be1a"]]);export{bt as default};
