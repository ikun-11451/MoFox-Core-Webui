import{a as Y,r as F,G as W,p as ae,P as ie,c as a,o as s,e,f as h,x as se,n as M,t as g,q as m,T as oe,w as le,g as T,F as N,h as Q,m as H,N as V,_ as Z,I as re,Y as ne,Z as pe,$ as ce,a0 as ye,a1 as de,L as _e,y as me,a2 as he,a3 as ge,a4 as ke,a5 as fe,a6 as be}from"./index-Dsia8u1P.js";import{I as f}from"./iconify-M55kX5oW.js";import{S as $e}from"./FieldEditor.vue_vue_type_style_index_0_scoped_e4edd2b4_lang-TyskGkOb.js";import{M as we}from"./MasterUsersEditor-DCnwE8kl.js";import{b as ue}from"./configDescriptions-B6rfcIUW.js";import{V as Ce}from"./index-CFA5NQrH.js";const xe={class:"chat-stream-id-input"},Ie={class:"stream-inputs"},Ae={key:0,class:"custom-select-dropdown"},Ee=["onClick"],Se=["value"],Ke={key:0,class:"custom-select-dropdown"},De=["onClick"],Pe={class:"hint-text"},je=Y({__name:"ChatStreamIdInput",props:{value:{}},emits:["update"],setup(b,{emit:q}){const E=b,v=q,y=[{value:"qq",label:"QQ"},{value:"telegram",label:"Telegram"},{value:"discord",label:"Discord"}],P=[{value:"group",label:"群聊"},{value:"private",label:"私聊"}],K=F(!1),I=F(!1),j=F(null),R=F(null),r=W(()=>{if(!E.value)return{platform:"",id:"",type:""};const l=E.value.split(":");return{platform:l[0]||"",id:l[1]||"",type:l[2]||""}}),$=W(()=>{const{platform:l,id:u,type:O}=r.value;return!l||!u||!O?"":`${l}:${u}:${O}`});function k(){K.value=!K.value,K.value&&(I.value=!1)}function C(){I.value=!I.value,I.value&&(K.value=!1)}function w(l){const{id:u,type:O}=r.value,L=`${l}:${u}:${O}`;v("update",L),K.value=!1}function d(l){const{platform:u,type:O}=r.value,L=`${u}:${l}:${O}`;v("update",L)}function n(l){const{platform:u,id:O}=r.value,L=`${u}:${O}:${l}`;v("update",L),I.value=!1}function o(l){j.value&&!j.value.contains(l.target)&&(K.value=!1),R.value&&!R.value.contains(l.target)&&(I.value=!1)}return ae(()=>{document.addEventListener("click",o)}),ie(()=>{document.removeEventListener("click",o)}),(l,u)=>{var O,L;return s(),a("div",xe,[e("div",Ie,[e("div",{class:"custom-select-wrapper",ref:i=>j.value=i},[e("div",{class:M(["custom-select-trigger input",{active:K.value}]),onClick:se(k,["stop"])},[e("span",null,g(((O=y.find(i=>i.value===r.value.platform))==null?void 0:O.label)||r.value.platform||"选择平台"),1),h(m(f),{icon:"lucide:chevron-down",class:M(["select-arrow",{rotated:K.value}])},null,8,["class"])],2),h(oe,{name:"fade"},{default:le(()=>[K.value?(s(),a("div",Ae,[(s(),a(N,null,Q(y,i=>e("div",{key:i.value,class:M(["custom-select-option",{selected:r.value.platform===i.value}]),onClick:se(p=>w(i.value),["stop"])},[e("span",null,g(i.label),1),r.value.platform===i.value?(s(),H(m(f),{key:0,icon:"lucide:check",class:"check-icon"})):T("",!0)],10,Ee)),64))])):T("",!0)]),_:1})],512),e("input",{type:"text",class:"input id-input",value:r.value.id,onInput:u[0]||(u[0]=i=>d(i.target.value)),placeholder:"聊天ID"},null,40,Se),e("div",{class:"custom-select-wrapper",ref:i=>R.value=i},[e("div",{class:M(["custom-select-trigger input",{active:I.value}]),onClick:se(C,["stop"])},[e("span",null,g(((L=P.find(i=>i.value===r.value.type))==null?void 0:L.label)||r.value.type||"类型"),1),h(m(f),{icon:"lucide:chevron-down",class:M(["select-arrow",{rotated:I.value}])},null,8,["class"])],2),h(oe,{name:"fade"},{default:le(()=>[I.value?(s(),a("div",Ke,[(s(),a(N,null,Q(P,i=>e("div",{key:i.value,class:M(["custom-select-option",{selected:r.value.type===i.value}]),onClick:se(p=>n(i.value),["stop"])},[e("span",null,g(i.label),1),r.value.type===i.value?(s(),H(m(f),{key:0,icon:"lucide:check",class:"check-icon"})):T("",!0)],10,De)),64))])):T("",!0)]),_:1})],512)]),e("div",Pe,[h(m(f),{icon:"lucide:info"}),V(" 留空表示全局配置 · 当前: "+g($.value||"全局"),1)])])}}}),ve=Z(je,[["__scopeId","data-v-eccb0380"]]),Te={class:"key-value-editor"},Ue={class:"editor-header"},Ve={key:0,class:"editor-hint"},Oe={class:"kv-list"},Le=["value","placeholder","onInput"],Fe=["value","placeholder","onInput"],Re=["onClick"],Be={key:0,class:"empty-state"},Ne=Y({__name:"KeyValueEditor",props:{value:{},title:{},description:{},keyPlaceholder:{},valuePlaceholder:{},emptyText:{},addButtonText:{}},emits:["update"],setup(b,{emit:q}){const E=b,v=q,y=W(()=>!E.value||typeof E.value!="object"?[]:Object.entries(E.value).map(([r,$])=>({key:r,value:String($||"")})));function P(r){const $={};return r.forEach(k=>{k.key&&($[k.key]=k.value)}),$}function K(){const r=[...y.value,{key:"",value:""}];v("update",P(r))}function I(r){const $=y.value.filter((k,C)=>C!==r);v("update",P($))}function j(r,$){const k=[...y.value];k[r]={...k[r],key:$},v("update",P(k))}function R(r,$){const k=[...y.value];k[r]={...k[r],value:$},v("update",P(k))}return(r,$)=>(s(),a("div",Te,[e("div",Ue,[e("h4",null,[h(m(f),{icon:"lucide:settings-2"}),V(" "+g(b.title||"键值对配置"),1)]),b.description?(s(),a("p",Ve,g(b.description),1)):T("",!0)]),e("div",Oe,[(s(!0),a(N,null,Q(y.value,(k,C)=>(s(),a("div",{key:C,class:"kv-item"},[e("input",{type:"text",class:"input key-input",value:k.key,placeholder:b.keyPlaceholder||"键",onInput:w=>j(C,w.target.value)},null,40,Le),$[0]||($[0]=e("span",{class:"separator"},"=",-1)),e("input",{type:"text",class:"input value-input",value:k.value,placeholder:b.valuePlaceholder||"值",onInput:w=>R(C,w.target.value)},null,40,Fe),e("button",{class:"btn-icon delete-btn",onClick:w=>I(C),title:"删除"},[h(m(f),{icon:"lucide:trash-2"})],8,Re)]))),128)),y.value.length===0?(s(),a("div",Be,[h(m(f),{icon:"lucide:package-open"}),e("p",null,g(b.emptyText||"暂无配置项"),1)])):T("",!0)]),e("button",{class:"btn btn-outline add-btn",onClick:K},[h(m(f),{icon:"lucide:plus"}),V(" "+g(b.addButtonText||"添加配置"),1)])]))}}),Me=Z(Ne,[["__scopeId","data-v-3d1da23a"]]),Ge={key:0,class:"readonly-badge"},qe={key:1,class:"toggle-switch"},Je=["checked","disabled"],ze={class:"toggle-label"},Qe=["value","readonly","disabled"],Xe={key:3,class:"array-field"},We={class:"array-count"},He={class:"modal-content"},Ye={class:"modal-header"},Ze={class:"modal-body"},et={class:"array-items"},tt=["value","onInput"],st=["onClick"],nt={class:"modal-footer"},at={key:4,class:"object-array-field"},ot={class:"modal-content modal-large"},lt={class:"modal-header"},it={class:"modal-body"},rt={class:"object-array-tabs"},ut=["onClick"],ct=["onClick"],dt={key:0,class:"object-fields"},pt={class:"field-label"},vt={class:"field-name"},yt={class:"field-input"},_t=["value","onInput"],mt=["value","onInput"],ht={class:"modal-footer"},gt={key:5,class:"object-field"},kt=["disabled"],ft=["value","readonly","disabled"],bt=["value","readonly","disabled"],$t=Y({__name:"FieldEditor",props:{field:{},value:{}},emits:["update"],setup(b,{emit:q}){const E=b,v=q,y=F(!1),P=F([]),K=F(!1),I=F([]),j=F(0),R=W(()=>{const i=E.value;return typeof i=="string"&&(i.includes(`
`)||i.length>100)});re(()=>[y.value,E.value],([i])=>{i&&(P.value=Array.isArray(E.value)?[...E.value]:[])},{immediate:!0}),re(()=>[K.value,E.value],([i])=>{i&&(I.value=Array.isArray(E.value)?E.value.map(p=>({...p})):[],j.value=0)},{immediate:!0});function r(i,p){return p==="integer"?parseInt(i)||0:parseFloat(i)||0}function $(i,p){P.value[i]=p}function k(i){P.value.splice(i,1)}function C(){P.value.push("")}function w(){v("update",[...P.value]),y.value=!1}function d(i,p){return i.name?String(i.name):i.model_identifier?String(i.model_identifier):`项 ${p+1}`}function n(i){return typeof i=="string"?i:typeof i=="number"||typeof i=="boolean"?String(i):Array.isArray(i)?JSON.stringify(i):String(i)}function o(i,p,ee=!1){if(j.value>=I.value.length)return;let U=p;if(ee)try{U=JSON.parse(p)}catch{U=p}else p==="true"?U=!0:p==="false"?U=!1:/^\d+$/.test(p)?U=parseInt(p):/^\d+\.\d+$/.test(p)&&(U=parseFloat(p));const J=I.value[j.value];J&&(J[i]=U)}function l(){if(I.value.length>0){const i={...I.value[0]};for(const p in i)typeof i[p]=="string"?i[p]="":typeof i[p]=="number"?i[p]=0:typeof i[p]=="boolean"?i[p]=!1:Array.isArray(i[p])&&(i[p]=[]);I.value.push(i)}else I.value.push({});j.value=I.value.length-1}function u(i){I.value.length<=1||(I.value.splice(i,1),j.value>=I.value.length&&(j.value=I.value.length-1))}function O(){v("update",[...I.value]),K.value=!1}function L(){const i=E.value;typeof i=="object"&&i!==null&&(I.value=[{...i}],j.value=0,K.value=!0)}return(i,p)=>{var ee;return s(),a("div",{class:M(["field-editor",{"is-readonly":b.field.readonly}])},[b.field.readonly?(s(),a("div",Ge,[h(m(f),{icon:"lucide:lock"}),p[12]||(p[12]=V(" 只读 ",-1))])):T("",!0),b.field.type==="boolean"?(s(),a("label",qe,[e("input",{type:"checkbox",checked:!!b.value,disabled:b.field.readonly,onChange:p[0]||(p[0]=U=>v("update",U.target.checked))},null,40,Je),p[13]||(p[13]=e("span",{class:"toggle-slider"},null,-1)),e("span",ze,g(b.value?"启用":"禁用"),1)])):b.field.type==="integer"||b.field.type==="number"?(s(),a("input",{key:2,type:"number",class:"input",value:b.value,readonly:b.field.readonly,disabled:b.field.readonly,onInput:p[1]||(p[1]=U=>v("update",r(U.target.value,b.field.type)))},null,40,Qe)):b.field.type==="array"?(s(),a("div",Xe,[e("div",{class:"array-preview",onClick:p[2]||(p[2]=U=>y.value=!0)},[e("span",We,g(((ee=b.value)==null?void 0:ee.length)||0)+" 项",1),h(m(f),{icon:"lucide:edit-3"})]),y.value?(s(),a("div",{key:0,class:"modal-overlay",onClick:p[5]||(p[5]=se(U=>y.value=!1,["self"]))},[e("div",He,[e("div",Ye,[e("h3",null,[h(m(f),{icon:"lucide:list"}),V(" 编辑数组: "+g(b.field.key),1)]),e("button",{class:"close-btn",onClick:p[3]||(p[3]=U=>y.value=!1)},[h(m(f),{icon:"lucide:x"})])]),e("div",Ze,[e("div",et,[(s(!0),a(N,null,Q(P.value,(U,J)=>(s(),a("div",{key:J,class:"array-item"},[e("input",{type:"text",class:"input",value:typeof U=="object"?JSON.stringify(U):U,onInput:X=>$(J,X.target.value)},null,40,tt),e("button",{class:"btn btn-sm btn-ghost btn-danger",onClick:X=>k(J)},[h(m(f),{icon:"lucide:trash-2"})],8,st)]))),128))]),e("button",{class:"btn btn-sm btn-ghost add-item-btn",onClick:C},[h(m(f),{icon:"lucide:plus"}),p[14]||(p[14]=V(" 添加项 ",-1))])]),e("div",nt,[e("button",{class:"btn btn-secondary",onClick:p[4]||(p[4]=U=>y.value=!1)},"取消"),e("button",{class:"btn btn-primary",onClick:w},"保存")])])])):T("",!0)])):b.field.type==="array_of_objects"?(s(),a("div",at,[e("button",{class:"btn btn-sm btn-ghost",onClick:p[6]||(p[6]=U=>K.value=!0)},[h(m(f),{icon:"lucide:edit-3"}),V(" 编辑 "+g(b.field.items_count||0)+" 个配置项 ",1)]),K.value?(s(),a("div",{key:0,class:"modal-overlay",onClick:p[9]||(p[9]=se(U=>K.value=!1,["self"]))},[e("div",ot,[e("div",lt,[e("h3",null,[h(m(f),{icon:"lucide:layers"}),V(" 编辑: "+g(b.field.key),1)]),e("button",{class:"close-btn",onClick:p[7]||(p[7]=U=>K.value=!1)},[h(m(f),{icon:"lucide:x"})])]),e("div",it,[e("div",rt,[(s(!0),a(N,null,Q(I.value,(U,J)=>(s(),a("button",{key:J,class:M(["tab-btn",{active:j.value===J}]),onClick:X=>j.value=J},[V(g(d(U,J))+" ",1),e("span",{class:"tab-close",onClick:se(X=>u(J),["stop"])},[h(m(f),{icon:"lucide:x"})],8,ct)],10,ut))),128)),e("button",{class:"btn btn-sm btn-ghost add-tab-btn",onClick:l},[h(m(f),{icon:"lucide:plus"})])]),I.value.length>0?(s(),a("div",dt,[(s(!0),a(N,null,Q(I.value[j.value],(U,J)=>(s(),a("div",{key:J,class:"field-row"},[e("div",pt,[e("span",vt,g(J),1)]),e("div",yt,[typeof U!="object"||U===null?(s(),a("input",{key:0,type:"text",class:"input",value:n(U),onInput:X=>o(J,X.target.value)},null,40,_t)):(s(),a("textarea",{key:1,class:"input textarea",value:JSON.stringify(U,null,2),onInput:X=>o(J,X.target.value,!0)},null,40,mt))])]))),128))])):T("",!0)]),e("div",ht,[e("button",{class:"btn btn-secondary",onClick:p[8]||(p[8]=U=>K.value=!1)},"取消"),e("button",{class:"btn btn-primary",onClick:O},"保存")])])])):T("",!0)])):b.field.type==="object"?(s(),a("div",gt,[e("button",{class:"btn btn-sm btn-ghost",onClick:L,disabled:b.field.readonly},[h(m(f),{icon:"lucide:edit-3"}),p[15]||(p[15]=V(" 编辑对象 ",-1))],8,kt)])):b.field.type==="textarea"||R.value?(s(),a("textarea",{key:6,class:"input textarea",value:b.value,readonly:b.field.readonly,disabled:b.field.readonly,onInput:p[10]||(p[10]=U=>v("update",U.target.value))},null,40,ft)):(s(),a("input",{key:7,type:"text",class:"input",value:b.value,readonly:b.field.readonly,disabled:b.field.readonly,onInput:p[11]||(p[11]=U=>v("update",U.target.value))},null,40,bt))],2)}}}),wt=Z($t,[["__scopeId","data-v-e4edd2b4"]]),Ct={class:"expression-rules-editor"},xt={class:"editor-header"},It={class:"group-card global-group"},At={class:"group-header"},Et={class:"group-info"},St={class:"group-content"},Kt={class:"field-row switches"},Dt={class:"switch-label"},Pt=["checked"],jt={class:"switch-label"},Tt=["checked"],Ut={class:"field-row"},Vt={class:"slider-input"},Ot=["value"],Lt={class:"slider-value"},Ft={class:"groups-list"},Rt={class:"group-header"},Bt={class:"group-info"},Nt=["value","onInput"],Mt={class:"stream-count"},Gt=["onClick"],qt={class:"group-content"},Jt={class:"field-row switches"},zt={class:"switch-label"},Qt=["checked","onChange"],Xt={class:"switch-label"},Wt=["checked","onChange"],Ht={class:"field-row"},Yt={class:"slider-input"},Zt=["value","onInput"],es={class:"slider-value"},ts={class:"streams-section"},ss={class:"section-label"},ns={class:"streams-list"},as=["onClick"],os=["onClick"],ls=Y({__name:"ExpressionRulesEditor",props:{value:{}},emits:["update"],setup(b,{emit:q}){const E=b,v=q,y=W(()=>(Array.isArray(E.value)?E.value:[]).find(n=>!n.chat_stream_id&&!n.group)||{use_expression:!0,learn_expression:!0,learning_strength:1}),P=W(()=>{const d=Array.isArray(E.value)?E.value:[],n=new Map;return d.forEach(o=>{o.group&&(n.has(o.group)||n.set(o.group,{name:o.group,streams:[],use_expression:o.use_expression??!0,learn_expression:o.learn_expression??!0,learning_strength:o.learning_strength??1}),o.chat_stream_id!==void 0&&o.chat_stream_id!==null&&n.get(o.group).streams.push(o.chat_stream_id))}),Array.from(n.values())});function K(){const d=[];return d.push({chat_stream_id:"",use_expression:y.value.use_expression,learn_expression:y.value.learn_expression,learning_strength:y.value.learning_strength}),P.value.forEach(n=>{n.streams.forEach(o=>{d.push({chat_stream_id:o,group:n.name,use_expression:n.use_expression,learn_expression:n.learn_expression,learning_strength:n.learning_strength})})}),d}function I(d,n){const o=Array.isArray(E.value)?E.value:[],l=o.findIndex(u=>!u.chat_stream_id&&!u.group);if(l>=0){const u=[...o];u[l]={...u[l],[d]:n},v("update",u)}else v("update",[{chat_stream_id:"",[d]:n},...o])}function j(){const d=`group_${P.value.length+1}`,n=K();n.push({chat_stream_id:"",group:d,use_expression:!0,learn_expression:!0,learning_strength:1}),v("update",n)}function R(d){const n=P.value.filter((l,u)=>u!==d),o=[{chat_stream_id:"",use_expression:y.value.use_expression,learn_expression:y.value.learn_expression,learning_strength:y.value.learning_strength}];n.forEach(l=>{l.streams.forEach(u=>{o.push({chat_stream_id:u,group:l.name,use_expression:l.use_expression,learn_expression:l.learn_expression,learning_strength:l.learning_strength})})}),v("update",o)}function r(d,n){const o=P.value[d];if(!o)return;const l=K(),u=o.name;l.forEach(O=>{O.group===u&&(O.group=n)}),v("update",l)}function $(d,n,o){const l=P.value[d];if(!l)return;const u=K(),O=l.name;u.forEach(L=>{L.group===O&&(L[n]=o)}),v("update",u)}function k(d){const n=P.value[d];if(!n)return;const o=K();o.push({chat_stream_id:"",group:n.name,use_expression:n.use_expression,learn_expression:n.learn_expression,learning_strength:n.learning_strength}),v("update",o)}function C(d,n){const o=[];o.push({chat_stream_id:"",use_expression:y.value.use_expression,learn_expression:y.value.learn_expression,learning_strength:y.value.learning_strength}),P.value.forEach((l,u)=>{l.streams.forEach((O,L)=>{u===d&&L===n||o.push({chat_stream_id:O,group:l.name,use_expression:l.use_expression,learn_expression:l.learn_expression,learning_strength:l.learning_strength})})}),v("update",o)}function w(d,n,o){const l=[];l.push({chat_stream_id:"",use_expression:y.value.use_expression,learn_expression:y.value.learn_expression,learning_strength:y.value.learning_strength}),P.value.forEach((u,O)=>{u.streams.forEach((L,i)=>{let p=L;O===d&&i===n&&(p=o),l.push({chat_stream_id:p,group:u.name,use_expression:u.use_expression,learn_expression:u.learn_expression,learning_strength:u.learning_strength})})}),v("update",l)}return(d,n)=>(s(),a("div",Ct,[e("div",xt,[e("h4",null,[h(m(f),{icon:"lucide:sparkles"}),n[3]||(n[3]=V(" 表达学习规则配置 ",-1))]),n[4]||(n[4]=e("p",{class:"editor-hint"},"按共享组管理表达学习规则，同组内的聊天流共享学到的表达方式",-1))]),e("div",It,[e("div",At,[e("div",Et,[h(m(f),{icon:"lucide:globe",class:"group-icon"}),n[5]||(n[5]=e("span",{class:"group-name"},"全局规则",-1)),n[6]||(n[6]=e("span",{class:"group-badge"},"默认配置",-1))])]),e("div",St,[e("div",Kt,[e("label",Dt,[e("input",{type:"checkbox",checked:y.value.use_expression!==!1,onChange:n[0]||(n[0]=o=>I("use_expression",o.target.checked))},null,40,Pt),n[7]||(n[7]=e("span",null,"使用表达",-1))]),e("label",jt,[e("input",{type:"checkbox",checked:y.value.learn_expression!==!1,onChange:n[1]||(n[1]=o=>I("learn_expression",o.target.checked))},null,40,Tt),n[8]||(n[8]=e("span",null,"学习表达",-1))])]),e("div",Ut,[n[9]||(n[9]=e("label",null,"学习强度",-1)),e("div",Vt,[e("input",{type:"range",value:y.value.learning_strength??1,onInput:n[2]||(n[2]=o=>I("learning_strength",parseFloat(o.target.value))),min:"0",max:"5",step:"0.1",class:"slider"},null,40,Ot),e("span",Lt,g((y.value.learning_strength??1).toFixed(1)),1)])])])]),e("div",Ft,[(s(!0),a(N,null,Q(P.value,(o,l)=>(s(),a("div",{key:l,class:"group-card"},[e("div",Rt,[e("div",Bt,[h(m(f),{icon:"lucide:users",class:"group-icon"}),e("input",{type:"text",class:"group-name-input",value:o.name,onInput:u=>r(l,u.target.value),placeholder:"组名称"},null,40,Nt),e("span",Mt,g(o.streams.length)+" 个聊天流",1)]),e("button",{class:"btn-icon delete-btn",onClick:u=>R(l),title:"删除组"},[h(m(f),{icon:"lucide:trash-2"})],8,Gt)]),e("div",qt,[e("div",Jt,[e("label",zt,[e("input",{type:"checkbox",checked:o.use_expression!==!1,onChange:u=>$(l,"use_expression",u.target.checked)},null,40,Qt),n[10]||(n[10]=e("span",null,"使用表达",-1))]),e("label",Xt,[e("input",{type:"checkbox",checked:o.learn_expression!==!1,onChange:u=>$(l,"learn_expression",u.target.checked)},null,40,Wt),n[11]||(n[11]=e("span",null,"学习表达",-1))])]),e("div",Ht,[n[12]||(n[12]=e("label",null,"学习强度",-1)),e("div",Yt,[e("input",{type:"range",value:o.learning_strength??1,onInput:u=>$(l,"learning_strength",parseFloat(u.target.value)),min:"0",max:"5",step:"0.1",class:"slider"},null,40,Zt),e("span",es,g((o.learning_strength??1).toFixed(1)),1)])]),e("div",ts,[e("label",ss,[h(m(f),{icon:"lucide:message-square"}),n[13]||(n[13]=V(" 聊天流列表 ",-1))]),e("div",ns,[(s(!0),a(N,null,Q(o.streams,(u,O)=>(s(),a("div",{key:O,class:"stream-item"},[h(m(ve),{value:u,onUpdate:L=>w(l,O,L)},null,8,["value","onUpdate"]),e("button",{class:"btn-icon delete-btn",onClick:L=>C(l,O),title:"删除聊天流"},[h(m(f),{icon:"lucide:x"})],8,as)]))),128)),e("button",{class:"btn btn-sm btn-outline add-stream-btn",onClick:u=>k(l)},[h(m(f),{icon:"lucide:plus"}),n[14]||(n[14]=V(" 添加聊天流 ",-1))],8,os)])])])]))),128))]),e("button",{class:"btn btn-outline add-btn",onClick:j},[h(m(f),{icon:"lucide:plus"}),n[15]||(n[15]=V(" 添加共享组 ",-1))])]))}}),is=Z(ls,[["__scopeId","data-v-42d8a6eb"]]),rs={class:"reaction-rules-editor"},us={class:"editor-header"},cs={class:"rules-list"},ds={class:"rule-header"},ps={class:"rule-info"},vs={key:0,class:"scope-badge"},ys=["onClick"],_s={class:"rule-fields"},ms={class:"field-row"},hs={class:"field-row"},gs=["onClick"],ks={key:0,class:"custom-select-dropdown"},fs=["onClick"],bs=["onClick"],$s={class:"field-row"},ws={class:"patterns-editor"},Cs=["value","onInput","placeholder"],xs=["onClick"],Is=["onClick"],As={class:"field-row"},Es=["value","onInput"],Ss={key:0,class:"empty-state"},Ks=Y({__name:"ReactionRulesEditor",props:{value:{}},emits:["update"],setup(b,{emit:q}){const E=b,v=q,y=F(null),P=d=>{y.value===d?y.value=null:y.value=d},K=()=>{y.value=null},I=d=>{d.target.closest(".custom-select-container")||K()};ae(()=>{document.addEventListener("click",I)}),ie(()=>{document.removeEventListener("click",I)});const j=W(()=>Array.isArray(E.value)?E.value:[]);function R(){const d=[...j.value,{chat_stream_id:"",rule_type:"keyword",patterns:[],reaction:""}];v("update",d)}function r(d){const n=j.value.filter((o,l)=>l!==d);v("update",n)}function $(d,n,o){const l=j.value.map((u,O)=>O===d?{...u,[n]:o}:u);v("update",l)}function k(d){const n=j.value.map((o,l)=>l===d?{...o,patterns:[...o.patterns||[],""]}:o);v("update",n)}function C(d,n){const o=j.value.map((l,u)=>u===d?{...l,patterns:l.patterns.filter((O,L)=>L!==n)}:l);v("update",o)}function w(d,n,o){const l=j.value.map((u,O)=>{if(O===d){const L=[...u.patterns];return L[n]=o,{...u,patterns:L}}return u});v("update",l)}return(d,n)=>(s(),a("div",rs,[e("div",us,[e("h4",null,[h(m(f),{icon:"lucide:zap"}),n[0]||(n[0]=V(" 反应规则配置 ",-1))]),n[1]||(n[1]=e("p",{class:"editor-hint"},"配置基于关键词或正则表达式的自动回复规则",-1))]),e("div",cs,[(s(!0),a(N,null,Q(j.value,(o,l)=>(s(),a("div",{key:l,class:M(["rule-card",{"global-rule":!o.chat_stream_id,"regex-rule":o.rule_type==="regex"}])},[e("div",ds,[e("div",ps,[e("span",{class:M(["rule-type-badge",o.rule_type])},[h(m(f),{icon:o.rule_type==="regex"?"lucide:regex":"lucide:key"},null,8,["icon"]),V(" "+g(o.rule_type==="regex"?"正则":"关键词"),1)],2),o.chat_stream_id?T("",!0):(s(),a("span",vs,[h(m(f),{icon:"lucide:globe"}),n[2]||(n[2]=V(" 全局 ",-1))]))]),e("button",{class:"btn-icon delete-btn",onClick:u=>r(l),title:"删除规则"},[h(m(f),{icon:"lucide:trash-2"})],8,ys)]),e("div",_s,[e("div",ms,[n[3]||(n[3]=e("label",null,"聊天流ID",-1)),h(m(ve),{value:o.chat_stream_id||"",onUpdate:u=>$(l,"chat_stream_id",u)},null,8,["value","onUpdate"])]),e("div",hs,[n[6]||(n[6]=e("label",null,"规则类型",-1)),e("div",{class:M(["custom-select-container",{"is-open":y.value===`rule_type_${l}`}])},[e("div",{class:"custom-select-trigger",onClick:u=>P(`rule_type_${l}`)},[e("span",null,g(o.rule_type==="regex"?"正则表达式":"关键词匹配"),1),h(m(f),{icon:"lucide:chevron-down",class:"select-arrow"})],8,gs),h(oe,{name:"select-fade"},{default:le(()=>[y.value===`rule_type_${l}`?(s(),a("div",ks,[e("div",{class:M(["custom-select-option",{"is-selected":o.rule_type==="keyword"}]),onClick:u=>{$(l,"rule_type","keyword"),K()}},[n[4]||(n[4]=V(" 关键词匹配 ",-1)),o.rule_type==="keyword"?(s(),H(m(f),{key:0,icon:"lucide:check",class:"check-icon"})):T("",!0)],10,fs),e("div",{class:M(["custom-select-option",{"is-selected":o.rule_type==="regex"}]),onClick:u=>{$(l,"rule_type","regex"),K()}},[n[5]||(n[5]=V(" 正则表达式 ",-1)),o.rule_type==="regex"?(s(),H(m(f),{key:0,icon:"lucide:check",class:"check-icon"})):T("",!0)],10,bs)])):T("",!0)]),_:2},1024)],2)]),e("div",$s,[e("label",null,g(o.rule_type==="regex"?"正则表达式":"关键词列表"),1),e("div",ws,[(s(!0),a(N,null,Q(o.patterns||[],(u,O)=>(s(),a("div",{key:O,class:"pattern-item"},[e("input",{type:"text",class:"input",value:u,onInput:L=>w(l,O,L.target.value),placeholder:o.rule_type==="regex"?"输入正则表达式":"输入关键词"},null,40,Cs),e("button",{class:"btn-icon",onClick:L=>C(l,O),title:"删除"},[h(m(f),{icon:"lucide:x"})],8,xs)]))),128)),e("button",{class:"btn btn-sm add-pattern-btn",onClick:u=>k(l)},[h(m(f),{icon:"lucide:plus"}),V(" 添加"+g(o.rule_type==="regex"?"正则":"关键词"),1)],8,Is)])]),e("div",As,[n[7]||(n[7]=e("label",null,"回复模板",-1)),e("textarea",{class:"input textarea",value:o.reaction||"",onInput:u=>$(l,"reaction",u.target.value),placeholder:"触发规则后的回复内容或提示词",rows:"3"},null,40,Es),n[8]||(n[8]=e("span",{class:"field-hint"}," 提示：对于正则表达式，可以使用 (?P<name>...) 定义命名捕获组，并在回复中用 [name] 引用 ",-1))])])],2))),128)),j.value.length===0?(s(),a("div",Ss,[h(m(f),{icon:"lucide:list-x"}),n[9]||(n[9]=e("p",null,"暂无反应规则",-1))])):T("",!0)]),e("button",{class:"btn btn-outline add-btn",onClick:R},[h(m(f),{icon:"lucide:plus"}),n[10]||(n[10]=V(" 添加规则 ",-1))])]))}}),Ds=Z(Ks,[["__scopeId","data-v-6248fb95"]]),Ps={class:"web-search-engines-editor"},js={class:"editor-header"},Ts={class:"engines-grid"},Us={class:"engine-header"},Vs={class:"engine-toggle"},Os=["checked","onChange"],Ls={class:"engine-info"},Fs={class:"engine-name"},Rs={key:0,class:"api-badge"},Bs={key:1,class:"free-badge"},Ns={class:"engine-desc"},Ms={key:0,class:"api-config"},Gs={class:"api-field-label"},qs={class:"api-keys-list"},Js=["value","placeholder","onInput"],zs=["onClick"],Qs=["onClick"],Xs=Y({__name:"WebSearchEnginesEditor",props:{value:{},configData:{}},emits:["update","updateConfig"],setup(b,{emit:q}){const E=b,v=q,y=[{id:"ddg",name:"DuckDuckGo",icon:"simple-icons:duckduckgo",description:"免费的隐私优先搜索引擎，无需 API 密钥",needsApiKey:!1},{id:"bing",name:"Bing",icon:"logos:bing",description:"微软必应搜索，无需 API 密钥",needsApiKey:!1},{id:"tavily",name:"Tavily",icon:"lucide:search-code",description:"专为 AI 应用优化的搜索引擎，结果精准",needsApiKey:!0,apiFields:[{key:"web_search.tavily_api_keys",label:"API 密钥",placeholder:"输入 Tavily API 密钥...",icon:"lucide:key"}]},{id:"exa",name:"EXA",icon:"lucide:brain",description:"神经网络驱动的智能搜索引擎",needsApiKey:!0,apiFields:[{key:"web_search.exa_api_keys",label:"API 密钥",placeholder:"输入 EXA API 密钥...",icon:"lucide:key"}]},{id:"metaso",name:"Metaso",icon:"lucide:sparkles",description:"秘塔AI搜索引擎，支持中文搜索",needsApiKey:!0,apiFields:[{key:"web_search.metaso_api_keys",label:"API 密钥",placeholder:"输入 Metaso API 密钥...",icon:"lucide:key"}]},{id:"serper",name:"Serper",icon:"lucide:globe",description:"Google 搜索结果 API，结果丰富",needsApiKey:!0,apiFields:[{key:"web_search.serper_api_keys",label:"API 密钥",placeholder:"输入 Serper API 密钥...",icon:"lucide:key"}]},{id:"searxng",name:"SearXNG",icon:"lucide:server",description:"自托管的元搜索引擎，支持自定义实例",needsApiKey:!0,apiFields:[{key:"web_search.searxng_instances",label:"实例 URL",placeholder:"输入 SearXNG 实例地址...",icon:"lucide:link"},{key:"web_search.searxng_api_keys",label:"API 密钥（可选）",placeholder:"输入 SearXNG API 密钥...",icon:"lucide:key"}]}],P=W(()=>{if(E.value!==void 0&&E.value!==null&&Array.isArray(E.value))return E.value;if(E.configData&&typeof E.configData=="object"){const k=E.configData.web_search;if(k&&Array.isArray(k.enabled_engines))return k.enabled_engines}return[]});function K(k){return P.value.includes(k)}function I(k){const C=[...P.value],w=K(k)?C.filter(d=>d!==k):[...C,k];v("update",w)}function j(k){const C=k.split(".");let w=E.configData;for(const d of C)if(w&&typeof w=="object")w=w[d];else return[];return Array.isArray(w)?w:[]}function R(k){const C=j(k);v("updateConfig",k,[...C,""])}function r(k,C){const d=j(k).filter((n,o)=>o!==C);v("updateConfig",k,d)}function $(k,C,w){const n=[...j(k)];n[C]=w,v("updateConfig",k,n)}return(k,C)=>(s(),a("div",Ps,[e("div",js,[e("h4",null,[h(m(f),{icon:"lucide:search"}),C[0]||(C[0]=V(" 搜索引擎配置 ",-1))]),C[1]||(C[1]=e("p",{class:"editor-hint"},"选择要启用的搜索引擎，启用需要 API 密钥的引擎时会显示对应配置项",-1))]),e("div",Ts,[(s(),a(N,null,Q(y,w=>e("div",{key:w.id,class:M(["engine-card",{"is-enabled":K(w.id)}])},[e("div",Us,[e("label",Vs,[e("input",{type:"checkbox",checked:K(w.id),onChange:d=>I(w.id)},null,40,Os),C[2]||(C[2]=e("span",{class:"toggle-slider"},null,-1))]),e("div",Ls,[h(m(f),{icon:w.icon,class:"engine-icon"},null,8,["icon"]),e("span",Fs,g(w.name),1)]),w.needsApiKey?(s(),a("span",Rs,"需要API密钥")):(s(),a("span",Bs,"免费"))]),e("p",Ns,g(w.description),1),K(w.id)&&w.needsApiKey?(s(),a("div",Ms,[(s(!0),a(N,null,Q(w.apiFields,d=>(s(),a("div",{key:d.key,class:"api-field"},[e("label",Gs,[h(m(f),{icon:d.icon||"lucide:key"},null,8,["icon"]),V(" "+g(d.label),1)]),e("div",qs,[(s(!0),a(N,null,Q(j(d.key),(n,o)=>(s(),a("div",{key:o,class:"api-key-item"},[e("input",{type:"password",class:"input api-key-input",value:n,placeholder:d.placeholder,onInput:l=>$(d.key,o,l.target.value)},null,40,Js),e("button",{class:"btn-icon delete-btn",onClick:l=>r(d.key,o),title:"删除"},[h(m(f),{icon:"lucide:trash-2"})],8,zs)]))),128)),e("button",{class:"btn btn-sm btn-outline add-key-btn",onClick:n=>R(d.key)},[h(m(f),{icon:"lucide:plus"}),V(" 添加"+g(d.label),1)],8,Qs)])]))),128))])):T("",!0)],2)),64))])]))}}),Ws=Z(Xs,[["__scopeId","data-v-cef8dfc2"]]),Hs={class:"chat-list-editor"},Ys={key:0,class:"editor-header"},Zs={key:0},en={key:1,class:"editor-hint"},tn={class:"table-container"},sn={class:"chat-table"},nn={class:"text-center"},an=["onUpdate:modelValue"],on=["onUpdate:modelValue"],ln=["onUpdate:modelValue"],rn={class:"text-center"},un=["onClick"],cn={key:0},dn={colspan:"5",class:"empty-state"},pn=Y({__name:"ChatListEditor",props:{value:{},title:{},description:{}},emits:["update"],setup(b,{emit:q}){const E=b,v=q,y=F([]);re(()=>E.value,R=>{const r=Array.isArray(R)?R:[],$=P(y.value);JSON.stringify(r)===JSON.stringify($)||(y.value=r.map(C=>{if(typeof C!="string")return{platform:"qq",type:"group",id:""};const w=C.split(":");return w.length>=3?{platform:w[0]||"qq",type:w[1]||"group",id:w.slice(2).join(":")}:{platform:"qq",type:"group",id:C}}))},{immediate:!0,deep:!0});function P(R){return R.map(r=>`${r.platform}:${r.type}:${r.id}`)}function K(){v("update",P(y.value))}function I(){const R={platform:"qq",type:"group",id:""},r=[...y.value,R];y.value=r,v("update",P(r))}function j(R){const r=[...y.value];r.splice(R,1),y.value=r,v("update",P(r))}return(R,r)=>(s(),a("div",Hs,[b.title||b.description?(s(),a("div",Ys,[b.title?(s(),a("h4",Zs,[h(m(f),{icon:"lucide:list"}),V(" "+g(b.title),1)])):T("",!0),b.description?(s(),a("p",en,g(b.description),1)):T("",!0)])):T("",!0),e("div",tn,[e("table",sn,[r[6]||(r[6]=e("thead",null,[e("tr",null,[e("th",{style:{width:"60px"}},"序号"),e("th",null,"ID"),e("th",{style:{width:"120px"}},"平台"),e("th",{style:{width:"120px"}},"类型"),e("th",{style:{width:"60px"}},"操作")])],-1)),e("tbody",null,[(s(!0),a(N,null,Q(y.value,($,k)=>(s(),a("tr",{key:k},[e("td",nn,g(k+1),1),e("td",null,[ne(e("input",{type:"text",class:"input","onUpdate:modelValue":C=>$.id=C,placeholder:"聊天ID",onInput:r[0]||(r[0]=C=>K())},null,40,an),[[pe,$.id]])]),e("td",null,[ne(e("select",{class:"select","onUpdate:modelValue":C=>$.platform=C,onChange:r[1]||(r[1]=C=>K())},[...r[3]||(r[3]=[e("option",{value:"qq"},"QQ",-1),e("option",{value:"telegram"},"Telegram",-1),e("option",{value:"discord"},"Discord",-1),e("option",{value:"other"},"Other",-1)])],40,on),[[ce,$.platform]])]),e("td",null,[ne(e("select",{class:"select","onUpdate:modelValue":C=>$.type=C,onChange:r[2]||(r[2]=C=>K())},[...r[4]||(r[4]=[e("option",{value:"group"},"群聊",-1),e("option",{value:"private"},"私聊",-1)])],40,ln),[[ce,$.type]])]),e("td",rn,[e("button",{class:"btn-icon delete-btn",onClick:C=>j(k),title:"删除"},[h(m(f),{icon:"lucide:trash-2"})],8,un)])]))),128)),y.value.length===0?(s(),a("tr",cn,[e("td",dn,[h(m(f),{icon:"lucide:inbox"}),r[5]||(r[5]=e("span",null,"暂无配置",-1))])])):T("",!0)])])]),e("button",{class:"btn btn-outline add-btn",onClick:I},[h(m(f),{icon:"lucide:plus"}),r[7]||(r[7]=V(" 添加项 ",-1))])]))}}),vn=Z(pn,[["__scopeId","data-v-3aef8cbc"]]),yn={class:"bot-config-editor"},_n={class:"config-nav-bar"},mn={class:"nav-tabs"},hn=["onClick"],gn={class:"tab-header"},kn={class:"tab-title"},fn={class:"tab-description"},bn={key:0,class:"config-toolbar"},$n={key:1,class:"search-shortcut"},wn={key:0,class:"search-results-hint"},Cn={class:"config-content"},xn=["onClick"],In={class:"group-title"},An={key:0,class:"expert-badge"},En={class:"group-meta"},Sn={class:"group-hint"},Kn={class:"group-content"},Dn={key:0,class:"field-card special-editor-card"},Pn={key:0,class:"readonly-badge"},jn={class:"field-left"},Tn={class:"field-header"},Un={class:"field-name"},Vn={key:0,class:"advanced-badge"},On={key:1,class:"expert-badge"},Ln={class:"field-description"},Fn=["checked","disabled","onChange"],Rn={class:"field-header"},Bn={class:"field-name"},Nn={class:"field-key"},Mn={key:0,class:"advanced-badge"},Gn={key:1,class:"expert-badge"},qn={class:"field-description"},Jn={class:"field-input"},zn=["onClick"],Qn={key:0,class:"custom-select-dropdown"},Xn=["onClick"],Wn=["value","placeholder","disabled","readonly","onInput"],Hn={key:2,class:"password-input"},Yn=["type","value","placeholder","disabled","readonly","onInput"],Zn=["disabled","onClick"],ea={key:0,class:"slider-input"},ta=["min","max","step","value","disabled","onInput"],sa={class:"slider-value"},na=["min","max","step","value","placeholder","disabled","readonly","onInput"],aa={key:4,class:"array-input"},oa=["value","placeholder","disabled","readonly","onInput"],la=["value","placeholder","disabled","readonly","onInput"],ia={key:1,class:"config-content"},ra={class:"config-group custom-section"},ua={class:"group-title"},ca={class:"group-meta"},da={class:"group-content"},pa={class:"subsection-title"},va={key:0,class:"field-left"},ya={class:"field-header"},_a={class:"field-name"},ma={key:0,class:"field-description"},ha={class:"field-header"},ga={class:"field-name"},ka={class:"field-key"},fa={key:0,class:"field-description"},ba={key:2,class:"field-input"},$a={key:3,class:"toggle-switch"},wa=["checked","onChange"],Ca=Y({__name:"BotConfigEditor",props:{parsedData:{},editedValues:{},configSchema:{}},emits:["update"],setup(b,{emit:q}){const E=b,v=q,y=F(null),P=x=>{y.value===x?y.value=null:y.value=x},K=()=>{y.value=null},I=x=>{x.target.closest(".custom-select-container")||K()},j=(x,_)=>{const B=x.find(z=>z.value===_);return B?B.label:_};ae(()=>{document.addEventListener("click",I)}),ie(()=>{document.removeEventListener("click",I)});const R=[{key:"basic",name:"基本信息",description:"配置机器人的基础信息和账号设置",groupKeys:["inner","bot","command","permission"]},{key:"personality",name:"人格",description:"配置机器人的性格特点和身份设定",groupKeys:["personality"]},{key:"chat",name:"聊天",description:"配置机器人的聊天行为、私聊和群聊模式",groupKeys:["chat","message_receive","kokoro_flow_chatter","cross_context","affinity_flow","proactive_thinking"]},{key:"expression",name:"表达",description:"配置机器人学习和使用表达方式",groupKeys:["expression","reaction"]},{key:"function",name:"功能",description:"配置机器人的各项功能模块",groupKeys:["tool","voice","web_search","video_analysis","planning_system","notice","plugin_http_system"]},{key:"process",name:"处理",description:"配置回复的后处理和优化",groupKeys:["response_post_process","chinese_typo","response_splitter"]},{key:"emotion",name:"情绪",description:"配置机器人的情绪系统和表情包",groupKeys:["mood","emoji"]},{key:"memory",name:"知识库",description:"配置记忆系统和向量数据库",groupKeys:["memory","database","lpmm_knowledge"]},{key:"advanced",name:"高级",description:"高级配置选项，包括视频分析、消息总线等",groupKeys:["video_analysis_expert","message_bus","custom_prompt","dependency_management"]},{key:"other",name:"其他",description:"日志、调试等其他配置",groupKeys:["log","debug"]}],r=F("basic"),$=F(""),k=F(!1),C=F({}),w=F({}),d=F(!1),n=F(null);function o(){var x;$.value="",(x=n.value)==null||x.blur()}function l(x){(x.ctrlKey||x.metaKey)&&x.key==="k"&&(x.preventDefault(),_e(()=>{var _;(_=n.value)==null||_.focus()}))}const u=W(()=>{if(!$.value)return 0;let x=0;return p.value.forEach(_=>{x+=U(_).length}),x});ae(()=>{document.addEventListener("keydown",l)}),ie(()=>{document.removeEventListener("keydown",l)});const O=W(()=>{const x=JSON.parse(JSON.stringify(E.parsedData));for(const[_,B]of Object.entries(E.editedValues)){const z=_.split(".");let S=x;for(let D=0;D<z.length-1;D++){const te=z[D];te&&((!S[te]||typeof S[te]!="object")&&(S[te]={}),S=S[te])}const t=z[z.length-1];t&&(S[t]=B)}return x}),L=W(()=>R.find(_=>_.key===r.value)??R[0]),i=W(()=>{const x=L.value;return ue.filter(_=>x==null?void 0:x.groupKeys.includes(_.key))}),p=W(()=>{let x=i.value;if(!$.value)return x;const _=$.value.toLowerCase();return x.filter(B=>B.name.toLowerCase().includes(_)?!0:B.fields.some(z=>z.name.toLowerCase().includes(_)||z.description.toLowerCase().includes(_)||z.key.toLowerCase().includes(_)))}),ee=W(()=>i.value.some(x=>x.fields.some(_=>_.advanced)));function U(x){let _=x.fields;if(_=_.filter(B=>!B.hidden),$.value){const B=$.value.toLowerCase();_=_.filter(z=>z.name.toLowerCase().includes(B)||z.description.toLowerCase().includes(B)||z.key.toLowerCase().includes(B))}return k.value||(_=_.filter(B=>!B.advanced)),_}const J=W(()=>{const x=new Set,_=new Set;ue.forEach(S=>{S.fields.forEach(t=>{x.add(t.key),t.type==="object"&&_.add(t.key)})});function B(S){if(x.has(S))return!0;for(const t of _)if(S.startsWith(t+"."))return!0;return!1}function z(S){return"display_name"in S&&S.fields.every(t=>"full_key"in t)}return E.configSchema.filter(z).filter(S=>S.fields.some(t=>!B(t.full_key))).map(S=>({...S,fields:S.fields.filter(t=>!B(t.full_key))}))});function X(x){w.value[x]=!w.value[x]}function A(x){if(x in E.editedValues)return E.editedValues[x];const _=x.split(".");let B=E.parsedData;for(const z of _)if(B&&typeof B=="object"&&z in B)B=B[z];else return;return B}function c(x){return Array.isArray(x)?x.join(", "):""}function G(x){return x.split(",").map(_=>_.trim()).filter(_=>_)}return(x,_)=>{var B,z;return s(),a("div",yn,[e("div",_n,[e("div",mn,[(s(),a(N,null,Q(R,S=>e("button",{key:S.key,class:M(["nav-tab",{active:r.value===S.key}]),onClick:t=>r.value=S.key},g(S.name),11,hn)),64))])]),e("div",gn,[e("h3",kn,g((B=L.value)==null?void 0:B.name),1),e("p",fn,g((z=L.value)==null?void 0:z.description),1),ee.value?(s(),a("button",{key:0,class:"add-rule-btn",onClick:_[0]||(_[0]=S=>k.value=!k.value)},[h(m(f),{icon:k.value?"lucide:eye-off":"lucide:eye"},null,8,["icon"]),V(" "+g(k.value?"隐藏高级选项":"显示高级选项"),1)])):T("",!0)]),i.value.length>1?(s(),a("div",bn,[e("div",{class:M(["search-box",{focused:d.value}])},[h(m(f),{icon:"lucide:search"}),ne(e("input",{ref_key:"searchInputRef",ref:n,"onUpdate:modelValue":_[1]||(_[1]=S=>$.value=S),type:"text",placeholder:"搜索配置项... (Ctrl+K)",class:"search-input",onFocus:_[2]||(_[2]=S=>d.value=!0),onBlur:_[3]||(_[3]=S=>d.value=!1),onKeydown:ye(o,["escape"])},null,544),[[pe,$.value]]),$.value?(s(),a("button",{key:0,class:"clear-search-btn",onClick:o,title:"清除搜索"},[h(m(f),{icon:"lucide:x"})])):T("",!0),!$.value&&!d.value?(s(),a("span",$n,"Ctrl+K")):T("",!0)],2),$.value?(s(),a("div",wn," 找到 "+g(u.value)+" 个匹配项 ",1)):T("",!0)])):T("",!0),e("div",Cn,[(s(!0),a(N,null,Q(p.value,S=>(s(),a("div",{key:S.key,class:M(["config-group",{collapsed:w.value[S.key],"expert-group":S.expert,"single-group":i.value.length===1}])},[i.value.length>1?(s(),a("div",{key:0,class:"group-header",onClick:t=>X(S.key)},[e("div",In,[h(m(f),{icon:S.icon},null,8,["icon"]),e("h3",null,g(S.name),1),S.expert?(s(),a("span",An,"专家")):T("",!0)]),e("div",En,[e("span",Sn,g(S.description),1),h(m(f),{icon:w.value[S.key]?"lucide:chevron-down":"lucide:chevron-up"},null,8,["icon"])])],8,xn)):T("",!0),ne(e("div",Kn,[(s(!0),a(N,null,Q(U(S),t=>(s(),a(N,{key:t.key},[t.specialEditor?(s(),a("div",Dn,[t.specialEditor==="string_array"?(s(),H(m($e),{key:0,value:A(t.key),title:t.name,description:t.description,placeholder:t.placeholder,emptyText:"暂无"+t.name,addButtonText:"添加"+t.name,onUpdate:D=>v("update",t.key,D)},null,8,["value","title","description","placeholder","emptyText","addButtonText","onUpdate"])):t.specialEditor==="key_value"?(s(),H(m(Me),{key:1,value:A(t.key),title:t.name,description:t.description,onUpdate:D=>v("update",t.key,D)},null,8,["value","title","description","onUpdate"])):t.specialEditor==="master_users"?(s(),H(we,{key:2,value:A(t.key),onUpdate:D=>v("update",t.key,D)},null,8,["value","onUpdate"])):t.specialEditor==="expression_rules"?(s(),H(is,{key:3,value:A(t.key),onUpdate:D=>v("update",t.key,D)},null,8,["value","onUpdate"])):t.specialEditor==="reaction_rules"?(s(),H(Ds,{key:4,value:A(t.key),onUpdate:D=>v("update",t.key,D)},null,8,["value","onUpdate"])):t.specialEditor==="web_search_engines"?(s(),H(Ws,{key:5,value:A(t.key),configData:O.value,onUpdate:D=>v("update",t.key,D),onUpdateConfig:_[4]||(_[4]=(D,te)=>v("update",D,te))},null,8,["value","configData","onUpdate"])):t.specialEditor==="chat_list"?(s(),H(vn,{key:6,value:A(t.key),title:t.name,description:t.description,onUpdate:D=>v("update",t.key,D)},null,8,["value","title","description","onUpdate"])):T("",!0)])):(s(),a("div",{key:1,class:M(["field-card",{inline:t.type==="boolean",advanced:t.advanced,expert:t.expert,readonly:t.readonly}])},[t.readonly?(s(),a("span",Pn,"只读")):T("",!0),t.type==="boolean"?(s(),a(N,{key:1},[e("div",jn,[e("div",Tn,[e("span",Un,g(t.name),1),t.advanced?(s(),a("span",Vn,"高级")):T("",!0),t.expert?(s(),a("span",On,"专家")):T("",!0)]),e("div",Ln,g(t.description),1)]),e("label",{class:M(["toggle-switch",{disabled:t.readonly}])},[e("input",{type:"checkbox",checked:!!A(t.key),disabled:t.readonly,onChange:D=>v("update",t.key,D.target.checked)},null,40,Fn),_[6]||(_[6]=e("span",{class:"toggle-slider"},null,-1))],2)],64)):(s(),a(N,{key:2},[e("div",Rn,[e("span",Bn,g(t.name),1),e("span",Nn,g(t.key),1),t.advanced?(s(),a("span",Mn,"高级")):T("",!0),t.expert?(s(),a("span",Gn,"专家")):T("",!0)]),e("div",qn,g(t.description),1),e("div",Jn,[t.type==="select"?(s(),a("div",{key:0,class:M(["custom-select-container",{"is-open":y.value===t.key,"is-disabled":t.readonly}])},[e("div",{class:"custom-select-trigger",onClick:D=>!t.readonly&&P(t.key)},[e("span",null,g(j(t.options||[],A(t.key)??t.default)),1),h(m(f),{icon:"lucide:chevron-down",class:"select-arrow"})],8,zn),h(oe,{name:"select-fade"},{default:le(()=>[y.value===t.key?(s(),a("div",Qn,[(s(!0),a(N,null,Q(t.options,D=>(s(),a("div",{key:D.value,class:M(["custom-select-option",{"is-selected":(A(t.key)??t.default)===D.value}]),onClick:te=>{v("update",t.key,D.value),K()}},[V(g(D.label)+" ",1),(A(t.key)??t.default)===D.value?(s(),H(m(f),{key:0,icon:"lucide:check",class:"check-icon"})):T("",!0)],10,Xn))),128))])):T("",!0)]),_:2},1024)],2)):t.type==="textarea"?(s(),a("textarea",{key:1,class:"input textarea",value:String(A(t.key)??t.default??""),placeholder:t.placeholder,disabled:t.readonly,readonly:t.readonly,onInput:D=>v("update",t.key,D.target.value),rows:"3"},null,40,Wn)):t.type==="password"?(s(),a("div",Hn,[e("input",{type:C.value[t.key]?"text":"password",class:"input",value:A(t.key)??"",placeholder:t.placeholder,disabled:t.readonly,readonly:t.readonly,onInput:D=>v("update",t.key,D.target.value)},null,40,Yn),e("button",{class:"toggle-visibility",type:"button",disabled:t.readonly,onClick:D=>C.value[t.key]=!C.value[t.key]},[h(m(f),{icon:C.value[t.key]?"lucide:eye-off":"lucide:eye"},null,8,["icon"])],8,Zn)])):t.type==="number"?(s(),a(N,{key:3},[t.min!==void 0&&t.max!==void 0&&t.max-t.min<=100?(s(),a("div",ea,[e("input",{type:"range",min:t.min,max:t.max,step:t.step??1,value:A(t.key)??t.default??t.min,disabled:t.readonly,onInput:D=>v("update",t.key,parseFloat(D.target.value))},null,40,ta),e("span",sa,g(A(t.key)??t.default??t.min),1)])):(s(),a("input",{key:1,type:"number",class:"input",min:t.min,max:t.max,step:t.step,value:A(t.key)??t.default??"",placeholder:t.placeholder,disabled:t.readonly,readonly:t.readonly,onInput:D=>v("update",t.key,parseFloat(D.target.value)||0)},null,40,na))],64)):t.type==="array"?(s(),a("div",aa,[e("input",{type:"text",class:"input",value:c(A(t.key)),placeholder:t.placeholder,disabled:t.readonly,readonly:t.readonly,onInput:D=>v("update",t.key,G(D.target.value))},null,40,oa),_[7]||(_[7]=e("span",{class:"input-hint"},"多个值用逗号分隔",-1))])):(s(),a("input",{key:5,type:"text",class:"input",value:A(t.key)??t.default??"",placeholder:t.placeholder,disabled:t.readonly,readonly:t.readonly,onInput:D=>v("update",t.key,D.target.value)},null,40,la))])],64))],2))],64))),128))],512),[[de,i.value.length===1||!w.value[S.key]]])],2))),128))]),r.value==="other"&&J.value.length>0?(s(),a("div",ia,[e("div",ra,[e("div",{class:"group-header",onClick:_[5]||(_[5]=S=>X("__custom__"))},[e("div",ua,[h(m(f),{icon:"lucide:file-json"}),_[8]||(_[8]=e("h3",null,"未分类配置",-1))]),e("div",ca,[_[9]||(_[9]=e("span",{class:"group-hint"},"配置文件中未注释的配置项",-1)),h(m(f),{icon:w.value.__custom__?"lucide:chevron-down":"lucide:chevron-up"},null,8,["icon"])])]),ne(e("div",da,[(s(!0),a(N,null,Q(J.value,S=>(s(),a("div",{key:S.name,class:"custom-subsection"},[e("h4",pa,g(S.display_name),1),(s(!0),a(N,null,Q(S.fields,t=>(s(),a("div",{key:t.full_key,class:M(["field-card",{inline:t.type==="boolean"}])},[t.type==="boolean"?(s(),a("div",va,[e("div",ya,[e("span",_a,g(t.key),1)]),t.description?(s(),a("div",ma,g(t.description),1)):T("",!0)])):(s(),a(N,{key:1},[e("div",ha,[e("span",ga,g(t.key),1),e("span",ka,g(t.full_key),1)]),t.description?(s(),a("div",fa,g(t.description),1)):T("",!0)],64)),t.type!=="boolean"?(s(),a("div",ba,[h(m(wt),{field:t,value:A(t.full_key),onUpdate:D=>v("update",t.full_key,D)},null,8,["field","value","onUpdate"])])):(s(),a("label",$a,[e("input",{type:"checkbox",checked:!!A(t.full_key),onChange:D=>v("update",t.full_key,D.target.checked)},null,40,wa),_[10]||(_[10]=e("span",{class:"toggle-slider"},null,-1))]))],2))),128))]))),128))],512),[[de,!w.value.__custom__]])])])):T("",!0)])}}}),xa=Z(Ca,[["__scopeId","data-v-a4ac660e"]]),Ia={class:"bot-config-view"},Aa={class:"config-header"},Ea={class:"header-actions"},Sa={class:"m3-segmented-button"},Ka=["disabled"],Da={key:0,class:"visual-editor"},Pa={key:0,class:"loading-state"},ja={key:1,class:"error-state"},Ta={key:1,class:"source-editor"},Ua={class:"source-toolbar"},Va={class:"file-path"},Oa={class:"monaco-container"},La={key:0,class:"validation-error"},Fa={class:"m3-dialog"},Ra={class:"dialog-header"},Ba={class:"dialog-content"},Na={key:0,class:"loading-state"},Ma={key:1,class:"backup-list"},Ga={class:"backup-info"},qa={class:"backup-name"},Ja={class:"backup-meta"},za={class:"backup-actions"},Qa=["onClick"],Xa={key:2,class:"empty-state"},Wa={class:"material-symbols-rounded"},Ha=Y({__name:"BotConfigView",setup(b){const q=F("visual"),E=F(!1),v=F(!1),y=F(""),P=F("bot_config.toml"),K=F({}),I=F({}),j=F(""),R=F(""),r=F(""),$=F(!1),k=F(!1),C=F([]),w=F({visible:!1,message:"",type:"success"});me();const d=F(ue),n={minimap:{enabled:!1},fontSize:14,lineHeight:24,fontFamily:"'Roboto Mono', 'Noto Sans SC', monospace",scrollBeyondLastLine:!1,automaticLayout:!0,padding:{top:16,bottom:16}},o=W(()=>q.value==="source"?j.value!==R.value:JSON.stringify(I.value)!==JSON.stringify(K.value));ae(async()=>{await l()});async function l(){var A;E.value=!0,y.value="";try{const c=await he("bot_config.toml");c.success&&c.data&&c.data.success?(K.value=c.data.parsed,I.value=JSON.parse(JSON.stringify(c.data.parsed)),j.value=c.data.content||"",R.value=c.data.content||"",P.value=c.data.path):y.value=((A=c.data)==null?void 0:A.error)||c.error||"加载配置失败"}catch(c){y.value="网络请求失败",console.error(c)}finally{E.value=!1}}function u(A,c,G){if(G===void 0){const x=A,_=c;I.value[x]=_}else{const x=A,_=c;I.value[x]||(I.value[x]={}),I.value[x][_]=G}}async function O(){var A;v.value=!0;try{let c;q.value==="source"?c=await ge(P.value,j.value):c=await ke(P.value,I.value),c.success&&c.data&&c.data.success?(X("配置已保存","success"),await l()):X(((A=c.data)==null?void 0:A.error)||c.error||"保存失败","error")}catch(c){X("保存请求失败","error"),console.error(c)}finally{v.value=!1}}function L(){}function i(A){}re($,A=>{A&&p()});async function p(){k.value=!0;try{const A=await be(P.value);A.success&&A.data&&A.data.success&&(C.value=A.data.backups)}catch(A){console.error(A)}finally{k.value=!1}}async function ee(A){var c;if(confirm(`确定要还原到 ${U(A.created_at)} 的版本吗？当前未保存的更改将丢失。`))try{const G=await fe(P.value,A.name);G.success&&G.data&&G.data.success?(X("配置已还原","success"),$.value=!1,await l()):X(((c=G.data)==null?void 0:c.error)||G.error||"还原失败","error")}catch{X("还原请求失败","error")}}function U(A){return new Date(A).toLocaleString()}function J(A){return A<1024?A+" B":(A/1024).toFixed(1)+" KB"}function X(A,c="success"){w.value={visible:!0,message:A,type:c},setTimeout(()=>{w.value.visible=!1},3e3)}return(A,c)=>(s(),a("div",Ia,[e("header",Aa,[c[9]||(c[9]=e("div",{class:"header-left"},[e("div",{class:"header-icon-container"},[e("span",{class:"material-symbols-rounded header-icon"},"smart_toy")]),e("div",{class:"header-info"},[e("h1",null,"机器人配置"),e("p",null,"配置机器人的基础信息、人格、聊天行为等")])],-1)),e("div",Ea,[e("div",Sa,[e("button",{class:M(["segment",{active:q.value==="visual"}]),onClick:c[0]||(c[0]=G=>q.value="visual")},[...c[6]||(c[6]=[e("span",{class:"material-symbols-rounded"},"grid_view",-1),V(" 可视化 ",-1)])],2),e("button",{class:M(["segment",{active:q.value==="source"}]),onClick:c[1]||(c[1]=G=>q.value="source")},[...c[7]||(c[7]=[e("span",{class:"material-symbols-rounded"},"code",-1),V(" 源码 ",-1)])],2)]),e("button",{class:"m3-icon-button",onClick:c[2]||(c[2]=G=>$.value=!0),title:"备份历史"},[...c[8]||(c[8]=[e("span",{class:"material-symbols-rounded"},"history",-1)])]),e("button",{class:"m3-button filled",onClick:O,disabled:v.value||!o.value},[e("span",{class:M(["material-symbols-rounded",{spinning:v.value}])},g(v.value?"progress_activity":"save"),3),V(" "+g(v.value?"保存中...":"保存配置"),1)],8,Ka)])]),q.value==="visual"?(s(),a("div",Da,[E.value?(s(),a("div",Pa,[...c[10]||(c[10]=[e("span",{class:"material-symbols-rounded spinning"},"progress_activity",-1),V(" 加载配置中... ",-1)])])):y.value?(s(),a("div",ja,[c[11]||(c[11]=e("span",{class:"material-symbols-rounded"},"error",-1)),V(" "+g(y.value),1)])):(s(),H(xa,{key:2,"parsed-data":K.value,"edited-values":I.value,"config-schema":d.value,onUpdate:u},null,8,["parsed-data","edited-values","config-schema"]))])):(s(),a("div",Ta,[e("div",Ua,[e("span",Va,[c[12]||(c[12]=e("span",{class:"material-symbols-rounded"},"description",-1)),V(" "+g(P.value),1)]),e("div",{class:"toolbar-actions"},[e("button",{class:"m3-button text small",onClick:L},[...c[13]||(c[13]=[e("span",{class:"material-symbols-rounded"},"format_align_left",-1),V(" 格式化 ",-1)])])])]),e("div",Oa,[h(m(Ce),{value:j.value,"onUpdate:value":c[3]||(c[3]=G=>j.value=G),language:"ini",theme:"vs-dark",options:n,onMount:i},null,8,["value"])]),r.value?(s(),a("div",La,[c[14]||(c[14]=e("span",{class:"material-symbols-rounded"},"warning",-1)),V(" "+g(r.value),1)])):T("",!0)])),$.value?(s(),a("div",{key:2,class:"m3-dialog-overlay",onClick:c[5]||(c[5]=se(G=>$.value=!1,["self"]))},[e("div",Fa,[e("div",Ra,[c[16]||(c[16]=e("h3",null,[e("span",{class:"material-symbols-rounded"},"history"),V(" 备份管理 ")],-1)),e("button",{class:"m3-icon-button",onClick:c[4]||(c[4]=G=>$.value=!1)},[...c[15]||(c[15]=[e("span",{class:"material-symbols-rounded"},"close",-1)])])]),e("div",Ba,[k.value?(s(),a("div",Na,[...c[17]||(c[17]=[e("span",{class:"material-symbols-rounded spinning"},"progress_activity",-1),V(" 加载备份列表... ",-1)])])):C.value.length?(s(),a("div",Ma,[(s(!0),a(N,null,Q(C.value,G=>(s(),a("div",{class:"backup-item",key:G.path},[e("div",Ga,[e("span",qa,g(G.name),1),e("span",Ja,g(U(G.created_at))+" · "+g(J(G.size)),1)]),e("div",za,[e("button",{class:"m3-button text small",onClick:x=>ee(G)},[...c[18]||(c[18]=[e("span",{class:"material-symbols-rounded"},"restore",-1),V(" 还原 ",-1)])],8,Qa)])]))),128))])):(s(),a("div",Xa,[...c[19]||(c[19]=[e("span",{class:"material-symbols-rounded empty-icon"},"history_toggle_off",-1),e("p",null,"暂无备份记录",-1)])]))])])])):T("",!0),h(oe,{name:"toast"},{default:le(()=>[w.value.visible?(s(),a("div",{key:0,class:M(["m3-snackbar",w.value.type])},[e("span",Wa,g(w.value.type==="success"?"check_circle":"error"),1),V(" "+g(w.value.message),1)],2)):T("",!0)]),_:1})]))}}),ao=Z(Ha,[["__scopeId","data-v-0f162d9a"]]);export{ao as default};
