import{d as A,z as c,c as D,o as O,l as o,q as a,j,O as q,P as z,B as k,F as C,D as P,v as l,k as G,m as b,r as u,T as K,ah as Q,y as n,_ as R}from"./index-2cLGT6AP.js";import{g as U,i as H}from"./marketplace-CQD6LDk-.js";const J={class:"plugin-marketplace-view"},W={class:"page-header"},X={class:"header-content"},Y={class:"header-actions"},Z={class:"search-box"},ss=["disabled"],es={class:"category-filter"},ts=["onClick"],as={key:0,class:"material-symbols-rounded check-icon"},os={class:"marketplace-container"},ns={key:0,class:"loading-state"},ls={key:1,class:"error-state"},is={key:2,class:"empty-state"},rs={key:3,class:"plugin-grid"},cs={class:"plugin-header"},ds={class:"plugin-icon"},us={class:"material-symbols-rounded"},ms={class:"plugin-status"},vs={key:0,class:"status-badge success"},fs={class:"plugin-info"},ps={class:"description"},hs={class:"plugin-meta"},_s={class:"meta-item"},ys={class:"meta-item"},ks={key:0,class:"plugin-keywords"},bs={class:"plugin-actions"},gs=["onClick"],ws=["onClick","disabled"],Cs=["onClick"],Ps={class:"material-symbols-rounded"},xs=A({__name:"PluginMarketplace",setup(Ns){const g=Q(),p=c(!0),m=c(""),r=c([]),d=c({}),_=c(""),h=c("全部"),v=c(new Set),f=c({show:!1,message:"",type:"success"}),M=D(()=>{const t=new Set(["全部"]);return r.value&&r.value.forEach(s=>{s.manifest.categories&&s.manifest.categories.forEach(e=>t.add(e))}),Array.from(t)}),x=D(()=>{if(!r.value)return[];let t=r.value;if(h.value!=="全部"&&(t=t.filter(s=>{var e;return(e=s.manifest.categories)==null?void 0:e.includes(h.value)})),_.value){const s=_.value.toLowerCase();t=t.filter(e=>{var $;const i=e.manifest.name.toLowerCase().includes(s),V=e.manifest.description.toLowerCase().includes(s),B=($=e.manifest.keywords)==null?void 0:$.some(S=>S.toLowerCase().includes(s));return i||V||B})}return t});function N(t){var e;if(!((e=t==null?void 0:t.manifest)!=null&&e.repository_url))return!1;const s=t.manifest.repository_url.split("/").pop()||"";return Object.prototype.hasOwnProperty.call(d.value,s)}function T(t){if(!(t!=null&&t.manifest))return"extension";const s=t.manifest.categories||[];return s.includes("Entertainment")||s.includes("Fun")?"sentiment_satisfied":s.includes("Games")?"sports_esports":s.includes("Tools")?"build":"extension"}function F(t){g.push(`/dashboard/marketplace/${t}`)}function E(t){if(t){const s=t.manifest.repository_url.split("/").pop()||"",e=d.value[s];if(e){g.push({path:`plugin-config/plugins%2F${e}%2Fconfig.toml`});return}}g.push("/dashboard/plugin-config")}async function I(t){v.value.add(t.id);try{const s=await H(t.id,t.manifest.repository_url,!0);if(console.log("安装响应:",s),s.success&&s.data){const e=s.data;if(e.success){y(`插件 ${t.manifest.name} 安装成功！`,"success");const i=t.manifest.repository_url.split("/").pop()||"";d.value[i]=e.plugin_name||null}else y(`安装失败: ${e.error||"未知错误"}`,"error")}else y(`安装请求失败: ${s.error||"未知错误"}`,"error")}catch(s){y("安装插件时发生错误","error"),console.error(s)}finally{v.value.delete(t.id)}}async function w(){p.value=!0,m.value="";try{const t=await U();if(console.log("API 响应:",t),t.success&&t.data){const s=t.data;s.success&&s.data?(r.value=s.data.plugins||[],d.value=s.data.installed_plugins||{}):(m.value=s.error||"获取插件市场数据失败",r.value=[],d.value={})}else m.value=t.error||"获取插件市场数据失败",r.value=[],d.value={}}catch(t){m.value="加载插件市场时发生错误",r.value=[],d.value={},console.error(t)}finally{p.value=!1}}function L(){}function y(t,s){f.value={show:!0,message:t,type:s},setTimeout(()=>{f.value.show=!1},3e3)}return O(()=>{w()}),(t,s)=>(n(),o("div",J,[a("header",W,[a("div",X,[s[2]||(s[2]=a("div",{class:"header-left"},[a("div",{class:"header-icon-container"},[a("span",{class:"material-symbols-rounded header-icon"},"storefront")]),a("div",{class:"header-info"},[a("h1",null,"插件市场"),a("p",null,"探索并安装 MoFox 社区插件")])],-1)),a("div",Y,[a("div",Z,[s[1]||(s[1]=a("span",{class:"material-symbols-rounded search-icon"},"search",-1)),q(a("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e),type:"text",class:"m3-input search-input",placeholder:"搜索插件...",onInput:L},null,544),[[z,_.value]])]),a("button",{class:"m3-icon-button",onClick:w,disabled:p.value,title:"刷新"},[a("span",{class:k(["material-symbols-rounded",{spinning:p.value}])},"refresh",2)],8,ss)])])]),a("div",es,[(n(!0),o(C,null,P(M.value,e=>(n(),o("button",{key:e,class:k(["m3-filter-chip",{selected:h.value===e}]),onClick:i=>h.value=e},[h.value===e?(n(),o("span",as,"check")):b("",!0),u(" "+l(e),1)],10,ts))),128))]),a("div",os,[p.value?(n(),o("div",ns,[...s[3]||(s[3]=[a("span",{class:"material-symbols-rounded spinning loading-icon"},"progress_activity",-1),a("p",null,"加载插件市场...",-1)])])):m.value?(n(),o("div",ls,[s[4]||(s[4]=a("span",{class:"material-symbols-rounded error-icon"},"error",-1)),a("p",null,l(m.value),1),a("button",{class:"m3-button filled",onClick:w},"重试")])):x.value.length===0?(n(),o("div",is,[...s[5]||(s[5]=[a("span",{class:"material-symbols-rounded empty-icon"},"search_off",-1),a("p",null,"未找到匹配的插件",-1)])])):(n(),o("div",rs,[(n(!0),o(C,null,P(x.value,e=>(n(),o("div",{key:e.id,class:"m3-card plugin-card"},[a("div",cs,[a("div",ds,[a("span",us,l(T(e)),1)]),a("div",ms,[N(e)?(n(),o("span",vs,[...s[6]||(s[6]=[a("span",{class:"material-symbols-rounded"},"check_circle",-1),u(" 已安装 ",-1)])])):b("",!0)])]),a("div",fs,[a("h3",null,l(e.manifest.name),1),a("p",ps,l(e.manifest.description),1),a("div",hs,[a("span",_s,[s[7]||(s[7]=a("span",{class:"material-symbols-rounded"},"person",-1)),u(" "+l(e.manifest.author),1)]),a("span",ys,[s[8]||(s[8]=a("span",{class:"material-symbols-rounded"},"sell",-1)),u(" v"+l(e.manifest.version),1)])]),e.manifest.keywords&&e.manifest.keywords.length>0?(n(),o("div",ks,[(n(!0),o(C,null,P(e.manifest.keywords.slice(0,3),i=>(n(),o("span",{key:i,class:"keyword-chip"},l(i),1))),128))])):b("",!0)]),a("div",bs,[a("button",{class:"m3-button text",onClick:i=>F(e.id)}," 详情 ",8,gs),N(e)?(n(),o("button",{key:1,class:"m3-button tonal",onClick:i=>E(e)},[...s[9]||(s[9]=[a("span",{class:"material-symbols-rounded"},"settings",-1),u(" 配置 ",-1)])],8,Cs)):(n(),o("button",{key:0,class:"m3-button filled",onClick:i=>I(e),disabled:v.value.has(e.id)},[a("span",{class:k(["material-symbols-rounded",{spinning:v.value.has(e.id)}])},l(v.value.has(e.id)?"progress_activity":"download"),3),u(" "+l(v.value.has(e.id)?"安装中...":"安装"),1)],8,ws))])]))),128))]))]),j(K,{name:"toast"},{default:G(()=>[f.value.show?(n(),o("div",{key:0,class:k(["m3-snackbar",f.value.type])},[a("span",Ps,l(f.value.type==="success"?"check_circle":"error"),1),u(" "+l(f.value.message),1)],2)):b("",!0)]),_:1})]))}}),Ms=R(xs,[["__scopeId","data-v-f9c96372"]]);export{Ms as default};
