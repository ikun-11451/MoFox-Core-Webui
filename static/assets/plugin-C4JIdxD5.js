import{d as M,r as i,G as P,ar as O,as as Q,at as T,au as U,av as V,aw as W,ax as X,ay as Y,az as Z,aA as $,aB as N,aC as ee,aD as se,aE as ae,aF as re,aG as te}from"./index-Dz5dMUCJ.js";const ce=M("plugin",()=>{const l=i([]),v=i([]),u=i(null),d=i([]),f=i(!1),m=i(!1),o=i(null),h=i(""),y=i("all"),p=P(()=>{const s=l.value.length+v.value.length,e=l.value.filter(r=>r.loaded).length,a=l.value.filter(r=>r.enabled).length,t=v.value.length;return{total:s,loaded:e,enabled:a,failed:t}}),E=P(()=>{let s=l.value;if(y.value!=="all")switch(y.value){case"loaded":s=s.filter(e=>e.loaded);break;case"enabled":s=s.filter(e=>e.enabled);break;case"failed":s=s.filter(e=>e.error);break}if(h.value.trim()){const e=h.value.toLowerCase();s=s.filter(a=>{var t;return a.name.toLowerCase().includes(e)||a.display_name.toLowerCase().includes(e)||((t=a.description)==null?void 0:t.toLowerCase().includes(e))})}return s});async function g(){var s;f.value=!0,o.value=null;try{const e=await O();return console.log("插件列表响应:",e),e.data.success&&e.data?(l.value=e.data.plugins,v.value=e.data.failed_plugins||[],!0):(o.value=((s=e.data)==null?void 0:s.error)||e.error||"获取插件列表失败",!1)}catch(e){return o.value=e instanceof Error?e.message:"网络错误",!1}finally{f.value=!1}}async function b(s){var e,a;m.value=!0,o.value=null;try{const t=await Q(s);return t.data.success&&((e=t.data)!=null&&e.plugin)?(u.value=t.data.plugin,d.value=t.data.plugin.components||[],!0):(o.value=((a=t.data)==null?void 0:a.error)||t.error||"获取插件详情失败",!1)}catch(t){return o.value=t instanceof Error?t.message:"网络错误",!1}finally{m.value=!1}}async function C(){return u.value?await b(u.value.name):!1}async function A(s){var e;try{const a=await T(s);return a.data.success&&a.data?(d.value=a.data.components,!0):(o.value=((e=a.data)==null?void 0:e.error)||a.error||"获取组件列表失败",!1)}catch(a){return o.value=a instanceof Error?a.message:"网络错误",!1}}async function x(s){var e,a,t;try{const r=await U(s);if(r.data.success){const n=l.value.find(c=>c.name===s);return n&&(n.enabled=!0),((e=u.value)==null?void 0:e.name)===s&&(u.value.enabled=!0),{success:!0,message:(a=r.data)==null?void 0:a.message}}else return{success:!1,error:((t=r.data)==null?void 0:t.error)||r.error}}catch(r){return{success:!1,error:r instanceof Error?r.message:"网络错误"}}}async function L(s){var e,a,t;try{const r=await V(s);if(r.data.success){const n=l.value.find(c=>c.name===s);return n&&(n.enabled=!1),((e=u.value)==null?void 0:e.name)===s&&(u.value.enabled=!1),{success:!0,message:(a=r.data)==null?void 0:a.message}}else return{success:!1,error:((t=r.data)==null?void 0:t.error)||r.error}}catch(r){return{success:!1,error:r instanceof Error?r.message:"网络错误"}}}async function D(s){var e,a,t;try{const r=await W(s);return r.data.success?(await g(),((e=u.value)==null?void 0:e.name)===s&&await b(s),{success:!0,message:(a=r.data)==null?void 0:a.message}):{success:!1,error:((t=r.data)==null?void 0:t.error)||r.error}}catch(r){return{success:!1,error:r instanceof Error?r.message:"网络错误"}}}async function k(s){var e,a,t;try{const r=await X(s);if(r.data.success){const n=l.value.findIndex(c=>c.name===s);return n!==-1&&l.value.splice(n,1),((e=u.value)==null?void 0:e.name)===s&&(u.value=null),{success:!0,message:(a=r.data)==null?void 0:a.message}}else return{success:!1,error:((t=r.data)==null?void 0:t.error)||r.error}}catch(r){return{success:!1,error:r instanceof Error?r.message:"网络错误"}}}async function F(s){var e,a,t;try{const r=await Y(s);if(r.data.success){const n=l.value.findIndex(c=>c.name===s);return n!==-1&&l.value.splice(n,1),((e=u.value)==null?void 0:e.name)===s&&(u.value=null),{success:!0,message:(a=r.data)==null?void 0:a.message}}else return{success:!1,error:((t=r.data)==null?void 0:t.error)||r.error}}catch(r){return{success:!1,error:r instanceof Error?r.message:"网络错误"}}}async function S(s){var e,a;try{const t=await Z(s);return t.data.success?(await g(),{success:!0,message:(e=t.data)==null?void 0:e.message}):{success:!1,error:((a=t.data)==null?void 0:a.error)||t.error}}catch(t){return{success:!1,error:t instanceof Error?t.message:"网络错误"}}}async function G(s,e,a){var t,r;try{const n=await $(s,e,a);if(n.data.success){const c=d.value.find(w=>w.name===e);return c&&(c.enabled=!0),{success:!0,message:(t=n.data)==null?void 0:t.message}}else return{success:!1,error:((r=n.data)==null?void 0:r.error)||n.error}}catch(n){return{success:!1,error:n instanceof Error?n.message:"网络错误"}}}async function I(s,e,a){var t,r;try{const n=await N(s,e,a);if(n.data.success){const c=d.value.find(w=>w.name===e);return c&&(c.enabled=!1),{success:!0,message:(t=n.data)==null?void 0:t.message}}else return{success:!1,error:((r=n.data)==null?void 0:r.error)||n.error}}catch(n){return{success:!1,error:n instanceof Error?n.message:"网络错误"}}}async function K(s=!0){var e;f.value=!0;try{const a=await ee(s);return a.data.success?(await g(),{success:!0,data:a.data}):{success:!1,error:((e=a.data)==null?void 0:e.error)||a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}finally{f.value=!1}}async function R(){var s,e;f.value=!0;try{const a=await se();return a.data.success?(await g(),{success:!0,message:(s=a.data)==null?void 0:s.message}):{success:!1,error:((e=a.data)==null?void 0:e.error)||a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}finally{f.value=!1}}async function _(s){try{const e=await ae(s);return e.data?(s.forEach(a=>{var r,n;const t=l.value.find(c=>c.name===a);t&&((n=(r=e.data)==null?void 0:r.results[a])!=null&&n.success)&&(t.enabled=!0)}),e.data):{success:!1,results:{},total:0,succeeded:0,failed:s.length}}catch{return{success:!1,results:{},total:s.length,succeeded:0,failed:s.length}}}async function z(s){try{const e=await re(s);return e.data?(s.forEach(a=>{var r,n;const t=l.value.find(c=>c.name===a);t&&((n=(r=e.data)==null?void 0:r.results[a])!=null&&n.success)&&(t.enabled=!1)}),e.data):{success:!1,results:{},total:0,succeeded:0,failed:s.length}}catch{return{success:!1,results:{},total:s.length,succeeded:0,failed:s.length}}}async function B(s){try{const e=await te(s);return e.data?(await g(),e.data):{success:!1,results:{},total:0,succeeded:0,failed:s.length}}catch{return{success:!1,results:{},total:s.length,succeeded:0,failed:s.length}}}function j(){u.value=null,d.value=[]}function q(s){h.value=s}function H(s){y.value=s}function J(){o.value=null}return{plugins:l,failedPlugins:v,currentPlugin:u,currentComponents:d,loading:f,detailLoading:m,error:o,searchKeyword:h,statusFilter:y,stats:p,filteredPlugins:E,fetchPlugins:g,fetchPluginDetail:b,refreshCurrentPlugin:C,fetchPluginComponents:A,enablePluginAction:x,disablePluginAction:L,reloadPluginAction:D,unloadPluginAction:k,deletePluginAction:F,loadPluginAction:S,enableComponentAction:G,disableComponentAction:I,scanForNewPlugins:K,reloadAll:R,batchEnable:_,batchDisable:z,batchReload:B,clearCurrentPlugin:j,setSearchKeyword:q,setStatusFilter:H,clearError:J}});export{ce as u};
