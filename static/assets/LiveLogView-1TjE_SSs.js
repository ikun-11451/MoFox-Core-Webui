import{a as z,r as v,G as M,I as j,p as q,P,c as a,e,n as h,t as n,Y as R,a7 as $,g as S,F as N,h as E,Z as Q,L as U,o as i,v as Y,_ as Z}from"./index-DXO0-Yhm.js";const K={class:"live-log-view"},X={class:"page-header"},ee={class:"header-content"},se={class:"title-group"},le={class:"status-text"},te={class:"content-wrapper"},oe={class:"log-container"},ae={class:"toolbar"},ne={class:"toolbar-left"},ie=["disabled"],re={class:"material-symbols-rounded"},ce=["disabled"],ue={class:"m3-switch-container"},de={class:"m3-switch"},ve={class:"toolbar-right"},pe={class:"filter-group"},me={class:"level-filter-dropdown"},ge={class:"material-symbols-rounded"},fe={key:0,class:"filter-dropdown-menu m3-card"},_e=["value"],be={class:"search-box"},he={class:"stats-bar"},we={class:"stat-item"},ye={class:"stat-value"},ke={key:0,class:"stat-item"},Le={class:"stat-value"},Ce={class:"stat-label"},xe={key:0,class:"loading-state"},Ie={key:1,class:"empty-state"},Re={key:2,class:"empty-state"},Se={key:3,class:"log-entries terminal-style"},Ne={class:"terminal-time"},Ee=["title"],Te=["innerHTML"],Oe=z({__name:"LiveLogView",setup(We){const c=v(!1),d=v(!1),r=v([]),y=v(!0),p=v(null),k=v(null),T=["DEBUG","INFO","WARNING","ERROR","CRITICAL"],g=v(["INFO","WARNING","ERROR","CRITICAL"]),f=v(!1),L=v(""),V=()=>{f.value=!f.value},O=t=>{t.target.closest(".level-filter-dropdown")||(f.value=!1)},C=M(()=>{let t=r.value;if(g.value.length>0&&g.value.length<T.length&&(t=t.filter(s=>g.value.includes(s.level))),L.value){const s=L.value.toLowerCase();t=t.filter(l=>l.event.toLowerCase().includes(s)||l.logger_name&&l.logger_name.toLowerCase().includes(s)||l.alias&&l.alias.toLowerCase().includes(s))}return t}),A=M(()=>{const t={DEBUG:0,INFO:0,WARNING:0,ERROR:0,CRITICAL:0};return r.value.forEach(s=>{const l=s.level;l&&t[l]!==void 0&&t[l]++}),t}),B=t=>t?t.replace("T"," ").substring(0,19):"",G=t=>{if(!t)return"";try{let u=null;try{u=JSON.parse(t)}catch{const b=t.replace(/'/g,'"').replace(/True/g,"true").replace(/False/g,"false").replace(/None/g,"null");u=JSON.parse(b)}if(u&&typeof u=="object"&&u.event)return _(u.event)}catch{}const s=/\x1b\[(\d+)m/g,l={30:"#000000",31:"#e74c3c",32:"#2ecc71",33:"#f39c12",34:"#3498db",35:"#9b59b6",36:"#1abc9c",37:"#ecf0f1",90:"#7f8c8d",91:"#e74c3c",92:"#2ecc71",93:"#f39c12",94:"#3498db",95:"#9b59b6",96:"#1abc9c",97:"#ffffff"};let o="",w=0,m="",x;for(;(x=s.exec(t))!==null;){const u=t.substring(w,x.index);u&&(m?o+=`<span style="color: ${m}">${_(u)}</span>`:o+=_(u));const b=x[1];b==="0"?m="":b&&l[b]&&(m=l[b]),w=s.lastIndex}const I=t.substring(w);return I&&(m?o+=`<span style="color: ${m}">${_(I)}</span>`:o+=_(I)),o||_(t)},_=t=>{const s=document.createElement("div");return s.textContent=t,s.innerHTML},D=()=>{c.value?W():H()},H=async()=>{if(!(d.value||c.value)){d.value=!0;try{const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/plugins/webui_backend/log_viewer/realtime`;console.log("正在连接WebSocket:",s),p.value=new WebSocket(s),p.value.onopen=()=>{console.log("WebSocket已连接"),c.value=!0,d.value=!1},p.value.onmessage=l=>{try{let o=JSON.parse(l.data);if(typeof o=="string")try{o=JSON.parse(o)}catch{o={timestamp:new Date().toISOString(),level:"INFO",logger_name:"unknown",event:String(o),line_number:0,file_name:"realtime"}}o.line_number=r.value.length+1,o.file_name="realtime",r.value.push(o),r.value.length>1e3&&(r.value.shift(),r.value.forEach((w,m)=>{w.line_number=m+1})),y.value&&U(()=>{F()})}catch(o){console.error("解析日志消息失败:",o,l.data)}},p.value.onerror=l=>{console.error("WebSocket错误:",l),d.value=!1},p.value.onclose=()=>{console.log("WebSocket已断开"),c.value=!1,d.value=!1}}catch(t){console.error("连接WebSocket失败:",t),d.value=!1}}},W=()=>{p.value&&(p.value.close(),p.value=null),c.value=!1,d.value=!1},J=()=>{r.value=[]},F=()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)};return j(y,t=>{t&&U(()=>{F()})}),q(()=>{document.addEventListener("click",O)}),P(()=>{W(),document.removeEventListener("click",O)}),(t,s)=>(i(),a("div",K,[e("div",X,[e("div",ee,[e("div",se,[s[4]||(s[4]=e("span",{class:"material-symbols-rounded title-icon"},"sensors",-1)),s[5]||(s[5]=e("h1",{class:"page-title"},"实时日志",-1)),e("div",{class:h(["status-badge",{connected:c.value}])},[s[3]||(s[3]=e("span",{class:"status-dot"},null,-1)),e("span",le,n(c.value?"已连接":"未连接"),1)],2)]),s[6]||(s[6]=e("p",{class:"page-description"},"实时查看系统日志输出",-1))])]),e("div",te,[e("div",oe,[e("div",ae,[e("div",ne,[e("button",{class:"m3-button filled",onClick:D,disabled:d.value},[e("span",re,n(c.value?"pause":"play_arrow"),1),e("span",null,n(c.value?"断开连接":"开始监听"),1)],8,ie),e("button",{class:"m3-button text error",onClick:J,disabled:!c.value&&r.value.length===0},[...s[7]||(s[7]=[e("span",{class:"material-symbols-rounded"},"delete",-1),e("span",null,"清空日志",-1)])],8,ce),s[10]||(s[10]=e("div",{class:"separator-line"},null,-1)),e("div",ue,[e("label",de,[R(e("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=l=>y.value=l)},null,512),[[$,y.value]]),s[8]||(s[8]=e("span",{class:"slider"},null,-1))]),s[9]||(s[9]=e("span",{class:"switch-label"},"自动滚动",-1))])]),e("div",ve,[e("div",pe,[e("div",me,[e("button",{class:h(["m3-filter-chip",{active:f.value}]),onClick:V},[s[11]||(s[11]=e("span",{class:"material-symbols-rounded"},"filter_list",-1)),e("span",null,"日志级别 ("+n(g.value.length)+")",1),e("span",ge,n(f.value?"expand_less":"expand_more"),1)],2),f.value?(i(),a("div",fe,[(i(),a(N,null,E(T,l=>e("label",{key:l,class:"filter-option"},[R(e("input",{type:"checkbox",value:l,"onUpdate:modelValue":s[1]||(s[1]=o=>g.value=o)},null,8,_e),[[$,g.value]]),e("span",{class:h(["level-badge","level-"+l.toLowerCase()])},n(l),3)])),64))])):S("",!0)]),e("div",be,[s[12]||(s[12]=e("span",{class:"material-symbols-rounded search-icon"},"search",-1)),R(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>L.value=l),type:"text",class:"m3-input",placeholder:"搜索日志内容..."},null,512),[[Q,L.value]])])])])]),e("div",he,[e("div",we,[s[13]||(s[13]=e("span",{class:"stat-label"},"总数:",-1)),e("span",ye,n(r.value.length),1)]),r.value.length!==C.value.length?(i(),a("div",ke,[s[14]||(s[14]=e("span",{class:"stat-label"},"已筛选:",-1)),e("span",Le,n(C.value.length),1)])):S("",!0),(i(!0),a(N,null,E(A.value,(l,o)=>(i(),a("div",{class:"stat-item",key:o},[e("span",Ce,n(o)+":",1),e("span",{class:h(["stat-value","level-"+o.toLowerCase()])},n(l),3)]))),128))]),e("div",{class:"log-content",ref_key:"logContentContainer",ref:k},[d.value?(i(),a("div",xe,[...s[15]||(s[15]=[e("span",{class:"material-symbols-rounded spinning loading-icon"},"progress_activity",-1),e("p",null,"正在连接...",-1)])])):!c.value&&r.value.length===0?(i(),a("div",Ie,[...s[16]||(s[16]=[e("span",{class:"material-symbols-rounded empty-icon"},"sensors",-1),e("p",null,'点击"开始监听"按钮开始接收实时日志',-1)])])):C.value.length===0?(i(),a("div",Re,[...s[17]||(s[17]=[e("span",{class:"material-symbols-rounded empty-icon"},"filter_list_off",-1),e("p",null,"没有匹配的日志",-1),e("p",{style:{"font-size":"12px","margin-top":"8px"}},"尝试调整筛选条件或搜索关键词",-1)])])):(i(),a("div",Se,[(i(!0),a(N,null,E(C.value,l=>(i(),a("div",{key:l.line_number,class:h(["log-entry terminal-line",`level-${l.level.toLowerCase()}`])},[e("span",Ne,n(B(l.timestamp)),1),e("span",{class:h(["terminal-level",`level-${l.level.toLowerCase()}`])}," ["+n(l.level.padEnd(8," "))+"] ",3),l.alias||l.logger_name?(i(),a("span",{key:0,class:"terminal-logger",style:Y(l.color?{color:l.color}:{}),title:l.alias?l.logger_name:""}," ["+n(l.alias||l.logger_name)+"] ",13,Ee)):S("",!0),e("span",{class:"terminal-message",innerHTML:G(l.event)},null,8,Te)],2))),128))]))],512)])])]))}}),Me=Z(Oe,[["__scopeId","data-v-6d6bbb74"]]);export{Me as default};
