import{d as J,z as v,c as M,w as j,o as q,A as P,l as o,q as e,B as h,v as n,O as S,Z as $,m as R,F as N,D as E,P as Q,aH as Z,n as A,y as i,C as K,_ as X}from"./index-Dp6KJFJl.js";const Y={class:"live-log-view"},ee={class:"page-header"},se={class:"header-content"},le={class:"title-group"},te={class:"status-text"},ae={class:"content-wrapper"},oe={class:"log-container"},ne={class:"toolbar"},ie={class:"toolbar-left"},re=["disabled"],ce={class:"material-symbols-rounded"},ue=["disabled"],de={class:"m3-switch-container"},ve={class:"m3-switch"},pe={class:"toolbar-right"},me={class:"filter-group"},ge={class:"level-filter-dropdown"},fe={class:"material-symbols-rounded"},_e={key:0,class:"filter-dropdown-menu m3-card"},be=["value"],he={class:"search-box"},ye={class:"stats-bar"},ke={class:"stat-item"},we={class:"stat-value"},Ce={key:0,class:"stat-item"},Le={class:"stat-value"},xe={class:"stat-label"},Ie={key:0,class:"loading-state"},Se={key:1,class:"empty-state"},Re={key:2,class:"empty-state"},Ne={key:3,class:"log-entries terminal-style"},Ee={class:"terminal-time"},Oe=["title"],Te=["innerHTML"],We=J({__name:"LiveLogView",setup(Fe){const c=v(!1),d=v(!1),r=v([]),k=v(!0),p=v(null),w=v(null),O=["DEBUG","INFO","WARNING","ERROR","CRITICAL"],g=v(["INFO","WARNING","ERROR","CRITICAL"]),f=v(!1),C=v(""),B=()=>{f.value=!f.value},T=t=>{t.target.closest(".level-filter-dropdown")||(f.value=!1)},L=M(()=>{let t=r.value;if(g.value.length>0&&g.value.length<O.length&&(t=t.filter(s=>g.value.includes(s.level))),C.value){const s=C.value.toLowerCase();t=t.filter(l=>l.event.toLowerCase().includes(s)||l.logger_name&&l.logger_name.toLowerCase().includes(s)||l.alias&&l.alias.toLowerCase().includes(s))}return t}),U=M(()=>{const t={DEBUG:0,INFO:0,WARNING:0,ERROR:0,CRITICAL:0};return r.value.forEach(s=>{const l=s.level;l&&t[l]!==void 0&&t[l]++}),t}),V=t=>t?t.replace("T"," ").substring(0,19):"",D=t=>{if(!t)return"";try{let u=null;try{u=JSON.parse(t)}catch{const b=t.replace(/'/g,'"').replace(/True/g,"true").replace(/False/g,"false").replace(/None/g,"null");u=JSON.parse(b)}if(u&&typeof u=="object"&&u.event)return _(u.event)}catch{}const s=/\x1b\[(\d+)m/g,l={30:"#000000",31:"#e74c3c",32:"#2ecc71",33:"#f39c12",34:"#3498db",35:"#9b59b6",36:"#1abc9c",37:"#ecf0f1",90:"#7f8c8d",91:"#e74c3c",92:"#2ecc71",93:"#f39c12",94:"#3498db",95:"#9b59b6",96:"#1abc9c",97:"#ffffff"};let a="",y=0,m="",x;for(;(x=s.exec(t))!==null;){const u=t.substring(y,x.index);u&&(m?a+=`<span style="color: ${m}">${_(u)}</span>`:a+=_(u));const b=x[1];b==="0"?m="":b&&l[b]&&(m=l[b]),y=s.lastIndex}const I=t.substring(y);return I&&(m?a+=`<span style="color: ${m}">${_(I)}</span>`:a+=_(I)),a||_(t)},_=t=>{const s=document.createElement("div");return s.textContent=t,s.innerHTML},H=()=>{c.value?W():G()},G=async()=>{if(!(d.value||c.value)){d.value=!0;try{const t=await Z(),s=`ws://${t.host}:${t.port}/plugins/webui_backend/log_viewer/realtime`;console.log("正在连接WebSocket:",s),p.value=new WebSocket(s),p.value.onopen=()=>{console.log("WebSocket已连接"),c.value=!0,d.value=!1},p.value.onmessage=l=>{try{let a=JSON.parse(l.data);if(typeof a=="string")try{a=JSON.parse(a)}catch{a={timestamp:new Date().toISOString(),level:"INFO",logger_name:"unknown",event:String(a),line_number:0,file_name:"realtime"}}a.line_number=r.value.length+1,a.file_name="realtime",r.value.push(a),r.value.length>1e3&&(r.value.shift(),r.value.forEach((y,m)=>{y.line_number=m+1})),k.value&&A(()=>{F()})}catch(a){console.error("解析日志消息失败:",a,l.data)}},p.value.onerror=l=>{console.error("WebSocket错误:",l),d.value=!1},p.value.onclose=()=>{console.log("WebSocket已断开"),c.value=!1,d.value=!1}}catch(t){console.error("连接WebSocket失败:",t),d.value=!1}}},W=()=>{p.value&&(p.value.close(),p.value=null),c.value=!1,d.value=!1},z=()=>{r.value=[]},F=()=>{w.value&&(w.value.scrollTop=w.value.scrollHeight)};return j(k,t=>{t&&A(()=>{F()})}),q(()=>{document.addEventListener("click",T)}),P(()=>{W(),document.removeEventListener("click",T)}),(t,s)=>(i(),o("div",Y,[e("div",ee,[e("div",se,[e("div",le,[s[4]||(s[4]=e("span",{class:"material-symbols-rounded title-icon"},"sensors",-1)),s[5]||(s[5]=e("h1",{class:"page-title"},"实时日志",-1)),e("div",{class:h(["status-badge",{connected:c.value}])},[s[3]||(s[3]=e("span",{class:"status-dot"},null,-1)),e("span",te,n(c.value?"已连接":"未连接"),1)],2)]),s[6]||(s[6]=e("p",{class:"page-description"},"实时查看系统日志输出",-1))])]),e("div",ae,[e("div",oe,[e("div",ne,[e("div",ie,[e("button",{class:"m3-button filled",onClick:H,disabled:d.value},[e("span",ce,n(c.value?"pause":"play_arrow"),1),e("span",null,n(c.value?"断开连接":"开始监听"),1)],8,re),e("button",{class:"m3-button text error",onClick:z,disabled:!c.value&&r.value.length===0},[...s[7]||(s[7]=[e("span",{class:"material-symbols-rounded"},"delete",-1),e("span",null,"清空日志",-1)])],8,ue),s[10]||(s[10]=e("div",{class:"separator-line"},null,-1)),e("div",de,[e("label",ve,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=l=>k.value=l)},null,512),[[$,k.value]]),s[8]||(s[8]=e("span",{class:"slider"},null,-1))]),s[9]||(s[9]=e("span",{class:"switch-label"},"自动滚动",-1))])]),e("div",pe,[e("div",me,[e("div",ge,[e("button",{class:h(["m3-filter-chip",{active:f.value}]),onClick:B},[s[11]||(s[11]=e("span",{class:"material-symbols-rounded"},"filter_list",-1)),e("span",null,"日志级别 ("+n(g.value.length)+")",1),e("span",fe,n(f.value?"expand_less":"expand_more"),1)],2),f.value?(i(),o("div",_e,[(i(),o(N,null,E(O,l=>e("label",{key:l,class:"filter-option"},[S(e("input",{type:"checkbox",value:l,"onUpdate:modelValue":s[1]||(s[1]=a=>g.value=a)},null,8,be),[[$,g.value]]),e("span",{class:h(["level-badge","level-"+l.toLowerCase()])},n(l),3)])),64))])):R("",!0)]),e("div",he,[s[12]||(s[12]=e("span",{class:"material-symbols-rounded search-icon"},"search",-1)),S(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>C.value=l),type:"text",class:"m3-input",placeholder:"搜索日志内容..."},null,512),[[Q,C.value]])])])])]),e("div",ye,[e("div",ke,[s[13]||(s[13]=e("span",{class:"stat-label"},"总数:",-1)),e("span",we,n(r.value.length),1)]),r.value.length!==L.value.length?(i(),o("div",Ce,[s[14]||(s[14]=e("span",{class:"stat-label"},"已筛选:",-1)),e("span",Le,n(L.value.length),1)])):R("",!0),(i(!0),o(N,null,E(U.value,(l,a)=>(i(),o("div",{class:"stat-item",key:a},[e("span",xe,n(a)+":",1),e("span",{class:h(["stat-value","level-"+a.toLowerCase()])},n(l),3)]))),128))]),e("div",{class:"log-content",ref_key:"logContentContainer",ref:w},[d.value?(i(),o("div",Ie,[...s[15]||(s[15]=[e("span",{class:"material-symbols-rounded spinning loading-icon"},"progress_activity",-1),e("p",null,"正在连接...",-1)])])):!c.value&&r.value.length===0?(i(),o("div",Se,[...s[16]||(s[16]=[e("span",{class:"material-symbols-rounded empty-icon"},"sensors",-1),e("p",null,'点击"开始监听"按钮开始接收实时日志',-1)])])):L.value.length===0?(i(),o("div",Re,[...s[17]||(s[17]=[e("span",{class:"material-symbols-rounded empty-icon"},"filter_list_off",-1),e("p",null,"没有匹配的日志",-1),e("p",{style:{"font-size":"12px","margin-top":"8px"}},"尝试调整筛选条件或搜索关键词",-1)])])):(i(),o("div",Ne,[(i(!0),o(N,null,E(L.value,l=>(i(),o("div",{key:l.line_number,class:h(["log-entry terminal-line",`level-${l.level.toLowerCase()}`])},[e("span",Ee,n(V(l.timestamp)),1),e("span",{class:h(["terminal-level",`level-${l.level.toLowerCase()}`])}," ["+n(l.level.padEnd(8," "))+"] ",3),l.alias||l.logger_name?(i(),o("span",{key:0,class:"terminal-logger",style:K(l.color?{color:l.color}:{}),title:l.alias?l.logger_name:""}," ["+n(l.alias||l.logger_name)+"] ",13,Oe)):R("",!0),e("span",{class:"terminal-message",innerHTML:D(l.event)},null,8,Te)],2))),128))]))],512)])])]))}}),$e=X(We,[["__scopeId","data-v-1d17828b"]]);export{$e as default};
