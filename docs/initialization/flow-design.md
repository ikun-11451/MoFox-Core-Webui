# åˆå§‹åŒ–æµç¨‹è®¾è®¡

> æœ¬æ–‡æ¡£æè¿° MoFox WebUI åˆå§‹åŒ–ç³»ç»Ÿçš„å®Œæ•´æµç¨‹å’ŒçŠ¶æ€æ£€æµ‹é€»è¾‘

---

## ğŸ“Š æµç¨‹å›¾

### ä¸»æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·é¦–æ¬¡ç™»å½•    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æµ‹åˆå§‹åŒ–çŠ¶æ€   â”‚â”€â”€â”€â”€â” å·²å®Œæˆåˆå§‹åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚ æœªåˆå§‹åŒ–     â”‚
         â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºæ¬¢è¿é¡µé¢     â”‚  â”‚ ç›´æ¥è¿›å…¥ä»ªè¡¨ç›˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1:         â”‚
â”‚ æœºå™¨äººåŸºç¡€é…ç½®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2:         â”‚
â”‚ SiliconFlow API â”‚
â”‚ é…ç½®            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3:         â”‚
â”‚ Git è·¯å¾„é…ç½®     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é…ç½®å®Œæˆé¡µé¢     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿›å…¥ä»ªè¡¨ç›˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” çŠ¶æ€æ£€æµ‹é€»è¾‘

ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹æ£€æµ‹æ­¥éª¤ï¼š

### 1. åˆå§‹åŒ–æ ‡è®°æ£€æµ‹

**æ£€æµ‹ç›®æ ‡**: `backend_storage` ä¸­çš„ `webui_initialized` æ ‡è®°

**é€»è¾‘**:
```python
if backend_storage.get("webui_initialized") == True:
    # å·²å®Œæˆåˆå§‹åŒ–ï¼Œè·³è½¬åˆ°ä»ªè¡¨ç›˜
    redirect_to_dashboard()
else:
    # æœªåˆå§‹åŒ–ï¼Œè¿›å…¥åˆå§‹åŒ–æµç¨‹
    start_initialization_wizard()
```

**API**: `GET /api/initialization/status`

---

### 2. é…ç½®æ–‡ä»¶æ£€æµ‹

é’ˆå¯¹æ¯ä¸ªé…ç½®æ­¥éª¤ï¼Œæ£€æµ‹å¯¹åº”çš„é…ç½®æ˜¯å¦å·²å­˜åœ¨ã€‚

#### Step 1: æœºå™¨äººé…ç½®

**é…ç½®æ–‡ä»¶**: `config/bot_config.toml`

**åŠ è½½é€»è¾‘**:
```python
# å°è¯•è¯»å–ç°æœ‰é…ç½®
config = {}
if os.path.exists("config/bot_config.toml"):
    config = load_toml("config/bot_config.toml")
    
# è¿”å›é…ç½®æ•°æ®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¾›å‰ç«¯é¢„å¡«å……
return {
    "nickname": config.get("bot", {}).get("nickname", ""),
    "personality_core": config.get("personality", {}).get("personality_core", ""),
    "identity": config.get("personality", {}).get("identity", ""),
    "master_users": config.get("permission", {}).get("master_users", [])
}
```

**æ˜¾ç¤ºç»™ç”¨æˆ·**:
- å¦‚æœå­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œè‡ªåŠ¨é¢„å¡«å……è¡¨å•å­—æ®µ
- ç”¨æˆ·å¯ä»¥ä¿®æ”¹ä»»æ„å­—æ®µ
- é¡µé¢åº•éƒ¨æä¾›æ“ä½œæŒ‰é’®ï¼š`[ä¿å­˜é…ç½®] [è·³è¿‡æ­¤æ­¥éª¤]`

**è·³è¿‡é€»è¾‘**:
- ç‚¹å‡»"è·³è¿‡æ­¤æ­¥éª¤"ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥
- ä¸éªŒè¯å­—æ®µï¼Œä¸ä¿å­˜é…ç½®
- è·³è¿‡åæ ‡è®°è¯¥æ­¥éª¤çŠ¶æ€ä¸º `SKIPPED`

---

#### Step 2: æ¨¡å‹é…ç½®æ£€æµ‹

**æ£€æµ‹æ–‡ä»¶**: `config/model_config.toml`

**æ˜¾ç¤ºç»™ç”¨æˆ·**:
```
âœ… æ£€æµ‹åˆ°å·²é…ç½®çš„ SiliconFlow API
API Key: sk-****1234

[ä¿æŒåŸé…ç½®] [æ›´æ–°é…ç½®]
```

---

#### Step 3: Git é…ç½®æ£€æµ‹

**æ£€æµ‹æ¥æº**:
1. `backend_storage.git_custom_path` (è‡ªå®šä¹‰è·¯å¾„)
2. ç³»ç»Ÿ PATH ä¸­çš„ Git (è‡ªåŠ¨æ£€æµ‹)
3. ä¾¿æºå¼ Git (é¡¹ç›®å†…ç½®)

**æ£€æµ‹é€»è¾‘**:
```python
# 1. æ£€æŸ¥è‡ªå®šä¹‰è·¯å¾„
custom_path = backend_storage.get_git_path()
if custom_path and is_valid_git_executable(custom_path):
    return {
        "git_detected": True,
        "git_path": custom_path,
        "git_version": get_git_version(custom_path),
        "source": "custom"
    }

# 2. æ£€æŸ¥ç³»ç»Ÿ Git
system_git = find_system_git()
if system_git:
    return {
        "git_detected": True,
        "git_path": system_git,
        "git_version": get_git_version(system_git),
        "source": "system"
    }

# 3. æ£€æŸ¥ä¾¿æºå¼ Git
portable_git = find_portable_git()
if portable_git:
    return {
        "git_detected": True,
        "git_path": portable_git,
        "git_version": get_git_version(portable_git),
        "source": "portable"
    }

# æœªæ£€æµ‹åˆ° Git
return {
    "git_detected": False,
    "git_path": None,
    "git_version": None,
    "source": None
}
```

**æ˜¾ç¤ºç»™ç”¨æˆ·**:

- **æ£€æµ‹æˆåŠŸ**:
```
âœ… å·²æ£€æµ‹åˆ°ç³»ç»Ÿ Git (v2.43.0)
è·¯å¾„: C:\Program Files\Git\bin\git.exe

ğŸ’¡ æç¤ºï¼šå¦‚æœè‡ªåŠ¨æ£€æµ‹æˆåŠŸï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

[è·³è¿‡æ­¤æ­¥éª¤]
```

- **æ£€æµ‹å¤±è´¥**:
```
âŒ æœªæ£€æµ‹åˆ° Git

MoFox ä½¿ç”¨ Git è¿›è¡Œç³»ç»Ÿæ›´æ–°å’Œå›æ»šã€‚
è¯·ä¸‹è½½å¹¶å®‰è£… Gitï¼Œæˆ–æ‰‹åŠ¨æŒ‡å®š Git è·¯å¾„ã€‚

[ğŸ“¥ ä¸‹è½½ Git] [ğŸ“‚ æ‰‹åŠ¨é…ç½®]
```

---

## ğŸ¯ æ™ºèƒ½è·³è¿‡ç­–ç•¥

### ç­–ç•¥ 1: å…¨å±€æ™ºèƒ½è·³è¿‡

å¦‚æœæ‰€æœ‰é…ç½®æ­¥éª¤éƒ½å·²å®Œæˆï¼Œç›´æ¥è¿›å…¥ä»ªè¡¨ç›˜ï¼š

```python
if all_steps_completed:
    backend_storage.set("webui_initialized", True)
    redirect_to_dashboard()
```

---

### ç­–ç•¥ 2: é…ç½®é¢„å¡«å……ä¸è·³è¿‡

æ¯ä¸ªé…ç½®æ­¥éª¤éƒ½æä¾›è·³è¿‡åŠŸèƒ½ï¼š

**æœºå™¨äººé…ç½® (Step 1)**:
- å¦‚æœå­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œè‡ªåŠ¨é¢„å¡«å……è¡¨å•
- ç”¨æˆ·å¯ä»¥ä¿®æ”¹æˆ–ä¿æŒåŸæ ·
- åº•éƒ¨æä¾› `[ä¿å­˜é…ç½®]` å’Œ `[è·³è¿‡æ­¤æ­¥éª¤]` æŒ‰é’®

**æ¨¡å‹é…ç½® (Step 2)**:
- å¦‚æœå·²é…ç½®ï¼Œé¢„å¡«å…… API Keyï¼ˆè„±æ•æ˜¾ç¤ºï¼‰
- æä¾› `[ä¿å­˜é…ç½®]` å’Œ `[è·³è¿‡æ­¤æ­¥éª¤]` æŒ‰é’®

**Git é…ç½® (Step 3)**:
- è‡ªåŠ¨æ£€æµ‹ Git è·¯å¾„
- å¦‚æœæ£€æµ‹æˆåŠŸï¼Œæç¤ºç”¨æˆ·å¯ä»¥è·³è¿‡
- æä¾› `[ä¿å­˜é…ç½®]` å’Œ `[è·³è¿‡æ­¤æ­¥éª¤]` æŒ‰é’®

---

### é…ç½®è¡¨å• UI

```vue
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœºå™¨äººåŸºç¡€é…ç½®                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  æ˜µç§°: [å¢¨ç‹___________________]    â”‚
â”‚                                     â”‚
â”‚  æ ¸å¿ƒäººæ ¼:                          â”‚
â”‚  [æ˜¯ä¸€ä¸ªç§¯æå‘ä¸Šçš„å¥³å¤§å­¦ç”Ÿ_______]  â”‚
â”‚                                     â”‚
â”‚  Master ç”¨æˆ·:                       â”‚
â”‚  [12345 â–¼] [+ æ·»åŠ ]                â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ æç¤ºï¼šå¦‚æœå·²æœ‰é…ç½®ï¼Œè¿™é‡Œä¼šè‡ªåŠ¨    â”‚
â”‚  é¢„å¡«å……ã€‚æ‚¨å¯ä»¥ä¿®æ”¹æˆ–ç›´æ¥è·³è¿‡ã€‚      â”‚
â”‚                                     â”‚
â”‚  [ä¿å­˜é…ç½®]       [è·³è¿‡æ­¤æ­¥éª¤]      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ­¥éª¤å¯¼èˆªé€»è¾‘

### å‰è¿›åˆ°ä¸‹ä¸€æ­¥

**æ¡ä»¶æ£€æŸ¥**:
```typescript
function canProceedToNextStep(): boolean {
  // å½“å‰æ­¥éª¤å¿…é¡»é€šè¿‡éªŒè¯
  if (!currentStepIsValid()) {
    showValidationErrors()
    return false
  }
  
  // å¦‚æœç”¨æˆ·é€‰æ‹©"è·³è¿‡"ï¼Œç›´æ¥å…è®¸
  if (userChoseToSkip()) {
    return true
  }
  
  // å¦‚æœç”¨æˆ·ä¿®æ”¹äº†é…ç½®ï¼Œå¿…é¡»ä¿å­˜æˆåŠŸ
  if (configWasModified() && !saveSuccessful()) {
    showSaveError()
    return false
  }
  
  return true
}
```

---

### è¿”å›ä¸Šä¸€æ­¥

**å…è®¸æ¡ä»¶**:
- å½“å‰ä¸æ˜¯ç¬¬ä¸€æ­¥ï¼ˆæ¬¢è¿é¡µé¢ï¼‰
- æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„ä¿å­˜æ“ä½œ

**è¡Œä¸º**:
- ä¸ä¸¢å¤±ç”¨æˆ·åœ¨å½“å‰æ­¥éª¤çš„è¾“å…¥
- è¿”å›åé‡æ–°åŠ è½½ä¸Šä¸€æ­¥çš„çŠ¶æ€

---

### æ­¥éª¤è·³è½¬é™åˆ¶

**è§„åˆ™**:
1. ç”¨æˆ·ä¸èƒ½ç›´æ¥è·³è½¬åˆ°æœªè§£é”çš„æ­¥éª¤
2. åªæœ‰å½“å‰æ­¥éª¤å®Œæˆåï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€æ­¥
3. å¯ä»¥éšæ—¶è¿”å›å·²å®Œæˆçš„æ­¥éª¤ä¿®æ”¹é…ç½®

**çŠ¶æ€æ ‡è¯†**:
```typescript
enum StepStatus {
  LOCKED = 'locked',        // æœªè§£é”
  CURRENT = 'current',      // å½“å‰æ­¥éª¤
  COMPLETED = 'completed',  // å·²å®Œæˆ
  SKIPPED = 'skipped'       // å·²è·³è¿‡
}
```

---

## ğŸ’¾ é…ç½®ä¿å­˜ç­–ç•¥

### è‡ªåŠ¨å¤‡ä»½

**è§¦å‘æ—¶æœº**: ä¿å­˜é…ç½®å‰

---

### åŸå­æ€§ä¿å­˜

**ç­–ç•¥**: å…ˆå†™ä¸´æ—¶æ–‡ä»¶ï¼Œå†åŸå­æ€§æ›¿æ¢


---

## âœ… åˆå§‹åŒ–å®Œæˆæ ‡è®°

### å®Œæˆæ¡ä»¶

**æ‰€æœ‰æ­¥éª¤å¿…é¡»æ»¡è¶³**:
1. Step 1: æœºå™¨äººé…ç½®å·²ä¿å­˜
2. Step 2: æ¨¡å‹é…ç½®å·²ä¿å­˜ï¼ˆæˆ–è·³è¿‡ï¼‰
3. Step 3: Git é…ç½®å·²ä¿å­˜ï¼ˆæˆ–è·³è¿‡ï¼‰

### æ ‡è®°é€»è¾‘

```python
def mark_initialization_complete():
    backend_storage.set("webui_initialized", True)
    backend_storage.set("webui_initialized_at", datetime.now().isoformat())
    logger.info("åˆå§‹åŒ–å·²å®Œæˆ")
```

### å®Œæˆåè¡Œä¸º

1. **æ˜¾ç¤ºå®Œæˆé¡µé¢** (3ç§’)
   - åº†ç¥åŠ¨ç”»
   - é…ç½®æ‘˜è¦
   - å°è´´å£«

2. **è‡ªåŠ¨è·³è½¬ä»ªè¡¨ç›˜**
   - æ’­æ”¾æ¬¢è¿åŠ¨ç”»
   - æ˜¾ç¤ºå¿«é€Ÿå…¥é—¨æç¤º


---

## ğŸ“ æµç¨‹ç¤ºä¾‹

### åœºæ™¯ 1: å…¨æ–°ç”¨æˆ·

```
ç”¨æˆ·é¦–æ¬¡ç™»å½•
  â†’ æ£€æµ‹: webui_initialized = False
  â†’ æ˜¾ç¤ºæ¬¢è¿é¡µé¢
  â†’ Step 1: é…ç½®æœºå™¨äºº (è¡¨å•ä¸ºç©ºï¼Œå¯å¡«å†™æˆ–è·³è¿‡)
  â†’ Step 2: é…ç½®æ¨¡å‹ (è¡¨å•ä¸ºç©ºï¼Œå¯å¡«å†™æˆ–è·³è¿‡)
  â†’ Step 3: æ£€æµ‹åˆ°ç³»ç»Ÿ Gitï¼Œæç¤ºè·³è¿‡
  â†’ å®Œæˆé¡µé¢
  â†’ è®¾ç½® webui_initialized = True
  â†’ è·³è½¬ä»ªè¡¨ç›˜
```

---

### åœºæ™¯ 2: é…ç½®äº†æœºå™¨äººä½†æœªå®Œæˆåˆå§‹åŒ–

```
ç”¨æˆ·é‡æ–°ç™»å½•
  â†’ æ£€æµ‹: webui_initialized = False
  â†’ æ˜¾ç¤ºæ¬¢è¿é¡µé¢
  â†’ Step 1: è¯»å–å·²æœ‰é…ç½®ï¼Œé¢„å¡«å……è¡¨å•
  â†’ ç”¨æˆ·é€‰æ‹©è·³è¿‡æ­¤æ­¥éª¤
  â†’ Step 2: é…ç½®æ¨¡å‹
  â†’ Step 3: é…ç½® Git
  â†’ å®Œæˆ
```

---

### åœºæ™¯ 3: å·²å®Œæˆåˆå§‹åŒ–

```
ç”¨æˆ·ç™»å½•
  â†’ æ£€æµ‹: webui_initialized = True
  â†’ ç›´æ¥è·³è½¬ä»ªè¡¨ç›˜
```

---

## ğŸ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|--------|
| é…ç½®æ£€æµ‹è€—æ—¶ | < 500ms |
| æ­¥éª¤åˆ‡æ¢åŠ¨ç”» | 300ms |
| é…ç½®ä¿å­˜å“åº” | < 2s |
| åˆå§‹åŒ–å®Œæˆæ€»æ—¶é•¿ | < 5min (ç”¨æˆ·æ“ä½œæ—¶é—´) |

---

**è¿”å›**: [README](./README.md) | **ä¸‹ä¸€ç¯‡**: [UI ç•Œé¢è®¾è®¡](./ui-design.md)
